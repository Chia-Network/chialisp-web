<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<title data-react-helmet="true">10 - Optimization | Chialisp</title><meta data-react-helmet="true" property="og:url" content="https://chialisp.com/docs/optimization"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="10 - Optimization | Chialisp"><meta data-react-helmet="true" name="description" content="Before you deploy a smart contract to the network, you should closely examine the code to find ways to optimize its execution.  Remember, the code you write is going to be deployed on millions of nodes; if it is slow, you slow down the whole network. This is why the block constraint on the Chia Network is dependent on the program execution cost of Chialisp that has to be run in that block.  If you want to write a bigger, slow running contract, you&#x27;re going to need to pay more fees every time you want to spend it.  Let&#x27;s go over some techniques you can use to optimize your puzzles."><meta data-react-helmet="true" property="og:description" content="Before you deploy a smart contract to the network, you should closely examine the code to find ways to optimize its execution.  Remember, the code you write is going to be deployed on millions of nodes; if it is slow, you slow down the whole network. This is why the block constraint on the Chia Network is dependent on the program execution cost of Chialisp that has to be run in that block.  If you want to write a bigger, slow running contract, you&#x27;re going to need to pay more fees every time you want to spend it.  Let&#x27;s go over some techniques you can use to optimize your puzzles."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chialisp.com/docs/optimization"><link data-react-helmet="true" rel="alternate" href="https://chialisp.com/docs/optimization" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://chialisp.com/docs/optimization" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2de08f14.css">
<link rel="preload" href="/assets/js/runtime~main.3c894092.js" as="script">
<link rel="preload" href="/assets/js/main.1e8417ec.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Chialisp</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://chialisp.com/training" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Training<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Chia.net<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Chia-Network/chialisp-web" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Chialisp</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://chialisp.com/training" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Training<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Chia.net<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://github.com/Chia-Network/chialisp-web" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Chialisp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">1 - CLVM Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coins_spends_and_wallets">2 - Coins, Spends and Wallets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deeper_into_clvm">3 - Deeper into CLVM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/high_level_lang">4 - The High Level Language, Compiler, and Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/common_functions">5 - Common Functions in Chialisp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/standard_transaction">6 - The Standard Transaction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coin_lifecycle">7 - Lifecycle of a Coin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/security">8 - Security</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/debugging">9 - Debugging</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/optimization">10 - Optimization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/glossary">The Great Chia Glossary</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CLVM</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ref/clvm">CLVM Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ref/serialization">Serialization</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Puzzles</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puzzles/singletons">Singletons</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/puzzles/pooling">Pooling</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/custom_puzzle_lock">Lock a coin with a custom puzzle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorials/coin_spend_rpc">Spend a coin using RPC</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">FAQ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/faq">ChiaLisp and CLVM FAQ</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">10 - Optimization</h1></header><p>Before you deploy a smart contract to the network, you should closely examine the code to find ways to optimize its execution.  Remember, the code you write is going to be deployed on millions of nodes; if it is slow, you slow down the whole network. This is why the block constraint on the Chia Network is dependent on the <a href="https://chialisp.com/docs/ref/clvm/#costs" target="_blank" rel="noopener noreferrer">program execution cost</a> of Chialisp that has to be run in that block.  If you want to write a bigger, slow running contract, you&#x27;re going to need to pay more fees every time you want to spend it.  Let&#x27;s go over some techniques you can use to optimize your puzzles.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="minimize-the-number-spends"></a>Minimize the number spends<a class="hash-link" href="#minimize-the-number-spends" title="Direct link to heading">#</a></h2><p>At the end of the day, one of the biggest drains on cost is going to be how often you have to spend the coin.  Quite commonly, you will find ways to build contracts where participants are required to spend the coin in order to interact with it.  The coin may traverse through multiple states as they do so.  Every time the coin has to be spent, it acts as a multiplier for your base program cost.  Even if you are not traversing an expensive path through the code, the full puzzle must still be revealed and there will most likely be <code>CREATE_COIN</code> and <code>AGG_SIG_ME</code> conditions which often represent a large chunk of the cost.</p><p>It is also important that you have as few signatures and signature operations as possible.  It is usually best practice to collect everything in your program that needs signing, hash it all together and ask for a single signature on that hash.  You can also sometimes be clever with announcements where an unsigned coin can assert its relevant information from a signed coin.  Be creative, but always remember to double check that every piece of important information is signed or asserted.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defun-vs-defun-inline"></a><code>defun</code> vs <code>defun-inline</code><a class="hash-link" href="#defun-vs-defun-inline" title="Direct link to heading">#</a></h2><p>In most instances, it is better to use inline functions rather than regular functions.  Inline functions get inserted where they are called at compile time which will eliminate the function call overhead and will not store the function separately in the code.</p><p>There is a potential scenario where this is not true.  If you are using an inline function with an argument that has been calculated, you will end up paying for that calculation every time the argument is referenced:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(defun-inline add_to_self (x) (+ x x))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(add_to_self (* 200 200))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The above code snippet will result in the following expansion:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(+ (* 200 200) (* 200 200))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As you can see, the expensive multiplication operation has now been performed twice!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="familiarize-yourself-with-all-of-the-operators"></a>Familiarize yourself with all of the operators<a class="hash-link" href="#familiarize-yourself-with-all-of-the-operators" title="Direct link to heading">#</a></h2><p>Make sure to check out the <a href="https://chialisp.com/docs/ref/clvm" target="_blank" rel="noopener noreferrer">reference section</a> to find out every operator that you can use and what they cost.  A lot of common operators that you might be tempted to use have a surprisingly high cost and are best to steer clear of.</p><p>For example, you may want to evaluate differently based on whether a number is even or odd:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(if (r (divmod value 2))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ; do odd things</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ; do even things</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><em>Note that the if takes advantage of the fact that 0 == (). This technique is handy when recursing through lists too.  The last item in a list is always () which evaluates to false, so in that case you can break the recursion.</em></p><p>However, <code>divmod</code> is a pretty expensive operation, and we have to add an <code>r</code> to access the remainder once the operation has completed.  Instead, we can just use <code>logand</code> to evaluate just the last bit:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(if (logand value 1)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ; do odd things</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ; do even things</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We have now saved ourselves at least 50% of the cost of this code block!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="keep-argument-numbers-small"></a>Keep argument numbers small<a class="hash-link" href="#keep-argument-numbers-small" title="Direct link to heading">#</a></h2><p>This tip is both good for optimization and readability.  As the program is running, it needs to pay cost to look up a value from the environment.  It is not a large cost, but it gets larger the deeper it has to go into the environment tree to search for the value.  If you can keep the argument numbers small, you can trim off cost every time your program uses an argument in its evaluation.</p><p>One way to do this is to batch arguments that always end up in the same place together.  Here&#x27;s an example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      CURRIED_PUBKEY</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      some_data</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      some_other_data</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      some_more_data</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      even_more_data</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      pubkey</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      my_amount</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      my_id</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (import &quot;condition_codes.clvm&quot;)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (import &quot;sha256tree.clvm&quot;)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (defun-inline agg_sig (CURRIED_PUBKEY some_data some_other_data some_more_data even_more_data)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (AGG_SIG_ME CURRIED_PUBKEY (sha256tree (list some_data some_other_data some_more_data even_more_data)))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (defun-inline assert_amount_and_sig (CURRIED_PUBKEY some_data some_other_data some_more_data even_more_data my_amount)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c (ASSERT_MY_AMOUNT my_amount) (agg_sig CURRIED_PUBKEY some_data some_other_data some_more_data even_more_data))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (defun-inline assert_id_and_amount_and_sig (CURRIED_PUBKEY some_data some_other_data some_more_data even_more_data my_amount my_id)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c ASSERT_MY_ID my_id (assert_amount_and_sig CURRIED_PUBKEY some_data some_other_data some_more_data even_more_data my_amount))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (assert_id_and_amount_and_sig CURRIED_PUBKEY some_data some_other_data some_more_data even_more_data my_amount my_id)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can see the code is a little bit out of control from a readability standpoint, and when accessing <code>my_amount</code> and <code>my_id</code> we have to go deep into the environment tree to read their values.  Instead, we should just batch all of our data into a list to start with.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_23N8 thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      CURRIED_PUBKEY</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      all_data</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      pubkey</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      my_amount</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      my_id</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (import &quot;condition_codes.clvm&quot;)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (import &quot;sha256tree.clvm&quot;)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (defun-inline agg_sig (CURRIED_PUBKEY all_data)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (AGG_SIG_ME CURRIED_PUBKEY (sha256tree all_data))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (defun-inline assert_amount_and_sig (CURRIED_PUBKEY all_data my_amount)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c (ASSERT_MY_AMOUNT my_amount) (agg_sig CURRIED_PUBKEY all_data))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (defun-inline assert_id_and_amount_and_sig (CURRIED_PUBKEY all_data my_amount my_id)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c ASSERT_MY_ID my_id (assert_amount_and_sig CURRIED_PUBKEY all_data my_amount))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (assert_id_and_amount_and_sig CURRIED_PUBKEY all_data my_amount my_id)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This is much more concise, and we can rely on the solver to put the relevant data in a list for us, so we can subtract that cost as well.  This is usually somewhat niche, but it becomes important when trying to pass data down through inner puzzles.  If the outermost puzzle wants to communicate with the innermost puzzle, it will have to pass all the data it needs through every step of the puzzles in between.  That is much easier if it is packaged into a single bundle.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dont-use-functions-by-reflex"></a>Don&#x27;t use functions by reflex<a class="hash-link" href="#dont-use-functions-by-reflex" title="Direct link to heading">#</a></h2><p>Oftentimes, using a common function can become a matter of habit and you can end up using it where it actually creates more complexity than is necessary.  A good example is <a href="/docs/common_functions#sha256tree1">sha256tree</a>.  Since the function works on either cons boxes or atoms, you may be tempted to use it on a single atom (maybe you&#x27;re currying it into a function).  The function needs to work this way because it recurses and will always run into atoms as it does so.  However, using it to hash only an atom actually adds unnecessary cost to the program.  Not only do you add the function call overhead, but you also add the check to see if it&#x27;s an atom or a list, even though you know its an atom!  A more cost effective method is to manually hash it like it would be hashed in a tree: <code>(sha256 1 some_atom)</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h2><p>A lot of optimizations that you can make may seem silly for the small amount of cost that they save.  However, if you expect your contract to become widely used, then there will be thousands of users paying for that in fees every day.  Over time it can add up to a lot of money wasted.  It&#x27;s important to take the time to review your code and make sure that you can save as much cost as possible before you deploy it to the network.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/Chia-Network/chialisp-web/edit/main/docs/optimization.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/debugging"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« 9 - Debugging</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/glossary"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">The Great Chia Glossary Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#minimize-the-number-spends" class="table-of-contents__link">Minimize the number spends</a></li><li><a href="#defun-vs-defun-inline" class="table-of-contents__link"><code>defun</code> vs <code>defun-inline</code></a></li><li><a href="#familiarize-yourself-with-all-of-the-operators" class="table-of-contents__link">Familiarize yourself with all of the operators</a></li><li><a href="#keep-argument-numbers-small" class="table-of-contents__link">Keep argument numbers small</a></li><li><a href="#dont-use-functions-by-reflex" class="table-of-contents__link">Don&#39;t use functions by reflex</a></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">CLVM Basics</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/coins_spends_and_wallets/">Coins, Spends and Wallets</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://keybase.io/team/chia_network.public" target="_blank" rel="noopener noreferrer" class="footer__link-item">Keybase</a></li><li class="footer__item"><a href="https://twitter.com/chia_project" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/Chia-Network/clvm" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Chia Network Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3c894092.js"></script>
<script src="/assets/js/main.1e8417ec.js"></script>
</body>
</html>