<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">CLVM Language Reference | Chialisp</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://chialisp.com/docs/clvm/lang_reference"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="CLVM Language Reference | Chialisp"><meta data-react-helmet="true" name="description" content="The clvm is a small, tightly defined VM that defines the semantics of CLVM programs run during Chia blockchain validation. It serves as a target language for higher level languages, especially Chialisp."><meta data-react-helmet="true" property="og:description" content="The clvm is a small, tightly defined VM that defines the semantics of CLVM programs run during Chia blockchain validation. It serves as a target language for higher level languages, especially Chialisp."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chialisp.com/docs/clvm/lang_reference"><link data-react-helmet="true" rel="alternate" href="https://chialisp.com/docs/clvm/lang_reference" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://chialisp.com/docs/clvm/lang_reference" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.35749df4.css">
<link rel="preload" href="/assets/js/runtime~main.5582d1e8.js" as="script">
<link rel="preload" href="/assets/js/main.4aa10653.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Chialisp</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Chia.net<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/Chia-Network/chialisp-web" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Chialisp</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorials</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">CLVM</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clvm/basics">CLVM Basics</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clvm/dive_into_clvm">Dive into CLVM</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/clvm/lang_reference">CLVM Language Reference</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clvm/serialization">CLVM Serialization</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/resources">Resources</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>CLVM Language Reference</h1></header><p>The clvm is a small, tightly defined VM that defines the semantics of CLVM programs run during Chia blockchain validation. It serves as a target language for higher level languages, especially Chialisp.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="terminology"></a>Terminology<a class="hash-link" href="#terminology" title="Direct link to heading">#</a></h2><ul><li><strong>CLVM Assembly</strong> - The textual representation of a CLVM program.</li><li><strong>Chialisp</strong> - A higher-level language, built on top of CLVM.</li><li><strong>CLVM Object</strong> - The underlying data type in the CLVM. An atom or a cons pair.</li><li><strong>Atom</strong> - The datatype for values in the CLVM. Atoms are immutable byte arrays. Atoms are untyped and are used to encode all strings, integers, and keys. The only things in the CLVM which are not atoms are cons pairs. Atom properties are length, and the bytes in the atom.</li><li><strong>cons pair</strong> - An immutable ordered pair of references to other CLVM objects. One of two data types in the CLVM. The syntax for a cons pair is a dotted pair. Also called <code>cons cell</code> or <code>cons box</code>.</li><li><strong>slot</strong> - One of the cells in a cons box. right or left. Accessed with <code>f</code> (first) or <code>r</code> (rest).</li><li><strong>nil</strong> - nil is the special value represented by the zero length byte array. This value represents zero, the empty string, false, and the empty list. Nil is represented in CLVM assembly as <code>()</code>, <code>0</code>, or <code>&#x27;&#x27;</code>.</li><li><strong>Value</strong> - We use value to mean an abstract value like <code>1</code> (an integer), <code>0xCAFE</code> (a byte string), <code>&quot;hello&quot;</code> (a string) or <code>(sha256 (q . &quot;hello&quot;))</code> (a program). Values are represented by CLVM Objects.</li><li><strong>List</strong> - CLVM lists follow the lisp convention of being a cons pair containing the first list element in the left slot and the rest of the list in the right slot.</li><li><strong>Proper List</strong> - A &quot;proper&quot; list is a chain of cons boxes, each containing a value in the left slot. Each right slot contains either another cons box, or nil, if it is the last pair.</li><li><strong>Function</strong> - A function in the CLVM is either a built-in opcode or a user-defined program.</li><li><strong>Operator</strong> - An opcode/string specifying a built-in function to use.</li><li><strong>Program</strong> - A CLVM object which can be executed.</li><li><strong>Opcodes</strong> - An atom corresponding to a reserved keyword. When a list is evaluated with a pre-defined opcode in the first position, the code for that opcode is run.</li><li><strong>Keyword</strong> - A reserved word in the CLVM assembly language syntax. The strings used for function lookup by the CLVM.</li><li><strong>Tree</strong> - A binary tree can be formed from cons pairs and atoms by allowing the right and left cells of a cons pair to hold either an atom, or a cons pair. Atoms are the leaves of the tree.</li><li><strong>Function Parameter</strong> - When a list is evaluated, the first argument is the function, and the other items are parameters. In the program <code>(+ (q . 1) (q . 2))</code>, the quoted atoms <code>1</code> and <code>2</code> are parameters to the operator <code>+</code></li><li><strong>Treearg</strong> - These are program arguments passed in from outside the program. They are referenced by integers that describe a path in the argument tree.</li><li><strong>Argument</strong> - Outside the context of the CLVM, the term &quot;argument&quot; can mean &quot;program argument&quot; (the &quot;argv&quot; of the C language, for example), or &quot;function argument&quot;, among other things. Because of this potential confusion, we avoid using the term &quot;argument&quot; in this document. The context is especially important considering the way in which CLVM programs look up their program arguments.</li></ul><p>A CLVM program must have an unambiguous definition and meaning, so that Chia block validation and consensus is deterministic. Programs are treated as Merkle trees, uniquely identified by the hash at their root. The program hash can be used to verify that two programs are identical.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="readable-assembly-format"></a>Readable assembly format<a class="hash-link" href="#readable-assembly-format" title="Direct link to heading">#</a></h2><p>The in-memory objects the CLVM operates on are atoms and cons pairs, but for programming convenience there is a human readable string format for input and output. This format is what is passed to the <code>brun</code> tool. This text representation of CLVM programs and data is not used anywhere in blockchain validation and has no impact on consensus. There are multiple ways of encoding the same CLVM object in the human readable serialization format, so going backwards to pretty print a CLVM object in this format requires guessing as to the best representation.</p><p>Atoms in the human readable representation can be represented as directly quoted strings. They can also be expressed as decimal integers (<code>100</code>), or hex literals (<code>0x64</code>).</p><p>Cons pairs can be represented using dot as an infix operator like so: <code>(3 . 4)</code>, which corresponds to a cons pair containing 3 and 4. A more common representation of data is lists, which are written as parentheses surrounding a space-delimited list of values.</p><p>Proper lists are built from linked cons pairs, and assume a nil terminator. For example <code>(3 4 5)</code> represents the same thing as <code>(3 . (4 . (5 . nil)))</code>.</p><p>Note that <code>0</code>, <code>&#x27;&#x27;</code>, and <code>()</code> all are parsed to the same value, but 0x0 is not.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="program-evaluation"></a>Program Evaluation<a class="hash-link" href="#program-evaluation" title="Direct link to heading">#</a></h2><p>The syntax of CLVM assembly is similar to Lisp. It is a parenthesized <a href="https://en.wikipedia.org/wiki/Polish_notation" target="_blank" rel="noopener noreferrer">prefix notation</a> that puts the operator before the arguments when reading left to right.</p><p>The semantics of the language implemented by the CLVM is similar to Lisp. A program is represented as a binary tree. The root of the tree is the least nested object in the program tree, with inner function calls embedded recursively inside of it. In the following example, the outer parentheses represent the cons box that is the root of the tree <code>(+ (q . 1) (q . 2))</code>.</p><p>Whenever a program is called it always has a context, or environment, which is a CLVM object. This object holds all the arguments passed into the program. This is the second command line argument to <code>run</code> and <code>brun</code>. The default environment is nil.</p><p>If the program is an atom then an argument lookup is performed, and the argument is returned. Please see <a href="#treeargs--program-arguments-and-argument-lookup">treeargs</a>, below.</p><p>If the the root of the program is a cons pair then all of the parameters (contained in the right slot of the cons box) are evaluated, then a function call is made and the result of that function call is returned. The object on the left determines the function to call and the object on the right determines what arguments it is passed.</p><p>If the object in the leftmost position of a list being executed is an operator in a list, the operator is called without first evaluating the parameters.</p><p>If the CLVM is running in &quot;strict mode&quot;, an unknown opcode will abort the program. This is the mode CLVM is run in during mempool checking and block validation. During developer testing, the CLVM may be run in &quot;non-strict&quot; mode, which allows for unknown opcodes to be used and treated as no-ops.</p><p>The quote opcode is special. When it is recognized by the interpreter, it causes whatever is on the right to be returned unevaluated. All other functions are passed the results of evaluating what&#x27;s on the right first.</p><p>A compiled CLVM program can be thought of as a binary tree.</p><p>Here is an example of a function invocation (or &quot;function call&quot;). <code>(+ (q . 1) (q . 2))</code>. The function is the opcode <code>+</code>, a function built-in to the clvm runtime.</p><p><code>(+ (q . 1) (q . 2))</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      [ ]</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     /   \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    +     [ ]</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         /   \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      [q, 1]  [ ]</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">             /   \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         [q, 2]  nil</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After First Reduction</p><p><code>(+ 1 2)</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      [ ]</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     /   \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    +     [ ]</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         /   \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        1     [ ]</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">             /   \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            2    nil</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After Second Reduction, and <code>+</code> function application</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">3</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Program trees are evaluated by first evaluating the leaf nodes, then their parents, recursively.
Arguments to functions are always evaluated before the function is called.
CLVM objects need not be evaluated in a specific order, but all child nodes must be evaluated before their parent.</p><p>If the item is a quoted value, the value is returned.</p><p>If the item is an atom, the atom is looked up as a Treearg.</p><p>If the item to be evaluated is a list, all of the parameters are evaluated and then the evaluated parameters are passed to the function</p><p>All arguments of a function are evaluated before being passed to that function.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="types"></a>Types<a class="hash-link" href="#types" title="Direct link to heading">#</a></h2><p>The two types of CLVM Object are <em>cons pair</em> and <em>atom</em>. They can be distinguished by the <strong>listp</strong> opcode. Atoms in the CLVM language do not carry other type information. However, similarly to the machine code instructions for a CPU, functions interpret atoms in specific predictable ways. Thus, each function imposes a type for each of its arguments.</p><p>The value of an atom - its length, and the values of its bytes - are always well defined and unambiguous. Because atoms have no type information, the meaning of an atom is determined when a function is applied to it. In the following example, an atom that was read in as a string is treated as an integer.</p><p><code>brun &#x27;(+ (q . &quot;helo&quot;) (q . 1))&#x27;</code> =&gt; <code>&quot;help&quot;</code></p><p>And in this example, an atom that was read in as an integer is appended to a string.</p><p><code>brun &#x27;(concat (q . &quot;hello&quot;) (q . 49))&#x27;</code> =&gt; <code>&quot;hello1&quot;</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="atoms-as-byte-arrays"></a>Atoms as Byte Arrays<a class="hash-link" href="#atoms-as-byte-arrays" title="Direct link to heading">#</a></h3><p>The atom is an array of bytes, with a length. No specific semantics are assumed, except as specified in the instruction.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="signed-integer"></a>Signed Integer<a class="hash-link" href="#signed-integer" title="Direct link to heading">#</a></h3><p>Arithmetic operations will interpret its operands as two&#x27;s complement, big endian, signed integers. The most significant bit denotes a negative number. In order to represent a positive integer where the most significant bit aligns with the most significant bit in the first byte need a 0-byte prefix in order to be interpreted as positive.</p><p>Said another way, if a positive integer&#x27;s first byte is &gt;= <code>0x80</code> then it will be prepended with a <code>0x00</code>. Without that prepended byte, a positive value would appear negative in the case that the high bit is set.</p><p>e.g. <code>0xFF</code> means -1 and <code>0x00FF</code> means 255.</p><p>You are likely to encounter this when using the output of an int operation as the input of a string operation.</p><p>The integer representation matters because there are operands that treats atoms as byte arrays, e.g. sha256hash.</p><p>Since atoms are of arbitrary length, the same value can be represented by many different atoms. For example, <code>0xFF</code> and <code>0xFFFF</code> both represent <code>-1</code>. Likewise, <code>0x01</code> and <code>0x0001</code> both represent <code>1</code>.</p><p>Arithmetic operations, returning integers, always return the shortest representation for numbers. eg. <code>0xFF</code> for <code>-1</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="bls-point"></a>BLS Point<a class="hash-link" href="#bls-point" title="Direct link to heading">#</a></h3><p>This type represents a point on an elliptic curve over finite field described <a href="https://electriccoin.co/blog/new-snark-curve/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>These values are opaque values, 48 bytes in length. The outputs of <code>pubkey_for_exp</code> are BLS points. The inputs and outputs of <code>point_add</code> are BLS points.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="treeargs--program-arguments-and-argument-lookup"></a>Treeargs : Program Arguments, and Argument Lookup<a class="hash-link" href="#treeargs--program-arguments-and-argument-lookup" title="Direct link to heading">#</a></h2><p>For a program running on a deterministic machine to have different behaviours, it must be able to have different starting states. The starting state for a CLVM program is the program argument list - the treearg.</p><p>When an unquoted integer is evaluated, it is replaced with the corresponding value/CLVM Object from the program Treearg. If the argument is not found, <code>nil</code> is returned.</p><p>As an improvement over walking the argument tree via calls to <strong>first</strong> and <strong>rest</strong>, arguments are referenced from the argument list by their argument number. This number is derived by translating a path of left and right cons slots followed from the root of the argument tree to that CLVM Object, into a series of ones and zeros. The number representing the path is read starting at the least significant bit. The number of the root of the argument tree is <code>1</code>. When the path is complete, a final <code>1</code> is appended to the msb of the number.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="illustration-of-argument-numbering"></a>Illustration of argument numbering<a class="hash-link" href="#illustration-of-argument-numbering" title="Direct link to heading">#</a></h3><p>We treat an s-expression as a binary tree, where leaf nodes are atoms, and cons pairs
are nodes with two children. We then number the paths as follows:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              1</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">             / \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            /   \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">           /     \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          /       \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         /         \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        /           \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">       2             3</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      / \           / \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     /   \         /   \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    4      6      5     7</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   / \    / \    / \   / \</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  8   12 10  14 9  13 11  15</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">etc.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This quirky numbering makes the implementation simple.</p><p>Numbering starts at the root of the tree. The path index is set to 1, which represents the entire argument tree.
Bits are appended to the right of the path index as we descend, 0 for left, and 1 for right.</p><p>See the implementation <a href="https://github.com/Chia-Network/clvm_tools/blob/main/clvm_tools/NodePath.py" target="_blank" rel="noopener noreferrer">here</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="quoting"></a>Quoting<a class="hash-link" href="#quoting" title="Direct link to heading">#</a></h2><p>In most programming languages, evaluating a literal returns the value itself.
In CLVM, the meaning of an atom at evaluation time (at any position of the list except the first), is a reference to a value in the argument tree.</p><p>Therefore, when you intend to write:</p><p><code>(+ 1 2)</code> =&gt; <code>3</code></p><p>You must instead write:
<code>(+ (q . 1) (q . 2))</code> =&gt; <code>3</code></p><p>nil is self-quoting.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="compilation-atom-syntax"></a>Compilation: Atom Syntax<a class="hash-link" href="#compilation-atom-syntax" title="Direct link to heading">#</a></h3><p>Although there is only one underlying representation of an atom, different syntaxes are recognized during compile time, and those atom syntaxes are interpreted differently during the translation from program text to CLVM Objects.</p><p>Nil, decimal zero and the empty string all evaluate to the same atom.</p><p><code>(q . ())</code> =&gt; <code>()</code></p><p><code>(q . 0)</code> =&gt; <code>()</code></p><p><code>(q . &quot;&quot;)</code> =&gt; <code>()</code></p><p>which is not the same as a single zero byte.</p><p><code>(q . 0x0)</code> =&gt; <code>0x00</code></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="equivalence-of-strings-symbols-hex-strings-and-numbers"></a>Equivalence of Strings, symbols, hex strings, and numbers<a class="hash-link" href="#equivalence-of-strings-symbols-hex-strings-and-numbers" title="Direct link to heading">#</a></h4><p><code>&quot;A&quot;</code> is the same atom as <code>A</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(q . &quot;A&quot;) =&gt; 65</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(q . A) =&gt; 65</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(q . 65) =&gt; 65</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(q . 0x41) =&gt; 65</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>However, the same is not true for Built-ins.
<code>&quot;q&quot;</code> is not the same as <code>q</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(q . q) =&gt; 1</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(q . &quot;q&quot;) =&gt; 113</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="operators-are-atoms-too"></a>Operators are atoms too..<a class="hash-link" href="#operators-are-atoms-too" title="Direct link to heading">#</a></h2><p>When you write a program, the first argument in the list is interpreted as an operator.
However, this operator is also stored as an unsigned int.
This can lead to ambiguity and confusing outputs:</p><p><code>(r (q . (1 2 3)))</code> =&gt; <code>(a 3)</code></p><p>Since <code>2</code> is at the beginning of the list, <code>brun</code> assumes it is the operator and looks up its corresponding representation, which in this case is <code>a</code>.
It is the correct output of the program, it is just displayed in an unexpected way.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="errors"></a>Errors<a class="hash-link" href="#errors" title="Direct link to heading">#</a></h2><p>While running a clvm program, checks are made to ensure the CLVM does not enter an undefined state. When a program violates one of these runtime checks, it is said to have caused an error.</p><ul><li>First element in an evaluated list is not a valid function. Example: <code>(&quot;hello&quot; (q . 1))</code> =&gt; <code>FAIL: unimplemented operator &quot;hello&quot;</code></li><li>Wrong number of arguments. Example: <code>(lognot (q . 1) (q . 2))</code> =&gt; <code>FAIL: lognot requires 1 arg</code></li><li>Program evaluation exceeds max cost see <a href="/docs/ref/clvm#costs">Costs</a></li><li>Too many allocations have been performed</li><li>Argument checking e.g. negative index <code>run &#x27;(substr &quot;abc&quot; -1 -)&#x27;</code> FAIL: invalid indices for substr (&quot;abc&quot; -1 17)</li></ul><p>An error will cause the program to abort.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="operator-summary"></a>Operator Summary<a class="hash-link" href="#operator-summary" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="the-built-in-opcodes"></a>The built-in opcodes<a class="hash-link" href="#the-built-in-opcodes" title="Direct link to heading">#</a></h3><p>Opcodes are functions built in to the CLVM. They are available to any running program.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="list-operators"></a>List Operators<a class="hash-link" href="#list-operators" title="Direct link to heading">#</a></h3><p><strong>c</strong> <em>cons</em> <code>(c A B)</code> takes exactly two operands and returns a cons pair with the two objects in it (A in the left, B in the right)</p><p>Example: <code>&#x27;(c (q . &quot;A&quot;) (q . ()))&#x27;</code> =&gt; <code>(65)</code></p><p><strong>f</strong> <em>first</em> <code>(f X)</code> takes exactly one operand which must be a cons pair, and returns the left half</p><p><strong>r</strong> <em>rest</em> <code>(r X)</code> takes exactly one operand which must be a cons pair, and returns the right half</p><p><strong>l</strong> <em>listp</em> <code>(l X)</code> takes exactly one operand and returns <code>()</code> if it is an atom or <code>1</code> if it is a cons pair. In contrast to most other lisps, nil is not a list in CLVM.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="control-flow"></a>Control Flow<a class="hash-link" href="#control-flow" title="Direct link to heading">#</a></h2><p><strong>a</strong> <em>apply</em> <code>(a P A)</code> run the program P with the arguments A. Note that this executes P in a new environment. Using integers to reference values in the solution will reference values in A.</p><p><strong>i</strong> <em>if</em> <code>(i A B C)</code> takes exactly three operands <code>A</code>, <code>B</code>, <code>C</code>. If <code>A</code> is <code>()</code>, return <code>C</code>. Otherwise, return <code>B</code>. Both B and C are evaluated before <em>if</em> is evaluated.</p><p><strong>x</strong> <em>raise exception</em> <code>(x X Y ...)</code> takes an arbitrary number of arguments (even zero). Immediately fail, with the argument list passed up into the (python) exception. No other CLVM instructions are run after this instruction is evaluated.</p><p><strong>=</strong> <em>equal</em> <code>(= A B)</code> returns 1 if <code>A</code> and <code>B</code> are both atoms and both equal. Otherwise <code>()</code>. Do not use this to test if two programs are identical. That is determined by their tree hash. Nil tests equal to zero, but nil is not equal to a single zero byte.</p><p><strong>&gt;</strong> <em>greater than</em> <code>(&gt; A B)</code> returns 1 if <code>A</code> and <code>B</code> are both atoms and A is greater than B, interpreting both as two&#x27;s complement signed integers. Otherwise <code>()</code>. <code>(&gt; A B)</code> means <code>A &gt; B</code> in infix syntax.</p><p><strong>&gt;s</strong> <em>greater than bytes</em> <code>(&gt;s A B)</code> returns 1 if <code>A</code> and <code>B</code> are both atoms and A is greater than B, interpreting both as an array of unsigned bytes. Otherwise <code>()</code>. Compare to strcmp.
<code>(&gt;s &quot;a&quot; &quot;b&quot;)</code> =&gt; <code>()</code></p><p><strong>not</strong> <code>(not A)</code> returns 1 if <code>A</code> evaluates to <code>()</code>. Otherwise, returns <code>()</code>.</p><p><strong>all</strong> <code>(all A B ...)</code> takes an arbitrary number of arguments (even zero). Returns <code>()</code> if any of the arguments evaluate to <code>()</code>. Otherwise, returns 1.</p><p><strong>any</strong> <code>(any A B ...)</code> takes an arbitrary number of arguments (even zero). Returns 1 if any of the arguments evaluate to something other than <code>()</code>. Otherwise, returns <code>()</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="constants"></a>Constants<a class="hash-link" href="#constants" title="Direct link to heading">#</a></h2><p><strong>q</strong> <em>quote</em> The form <code>(q . X)</code> when evaluated returns X, which is <em>not</em> evaluated.
Example: <code>(q . &quot;A&quot;)</code> =&gt; <code>65</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="integer-operators"></a>Integer Operators<a class="hash-link" href="#integer-operators" title="Direct link to heading">#</a></h2><p>The arithmetic operators <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code> and <code>divmod</code> treat their arguments as signed integers.</p><p><strong><code>+</code></strong> <code>(+ a0 a1 ...)</code> takes any number of integer operands and sums them. If given no arguments, zero is returned.</p><p><strong><code>-</code></strong> <code>(- a0 a1 ...)</code> takes one or more integer operands and adds a0 to the negative of the rest. Giving zero arguments returns 0.</p><p><strong><code>*</code></strong> <code>(* a0 a1 ...)</code> takes any number of integer operands and returns the product.</p><p><strong><code>/</code></strong> <code>(/ A B)</code> divides two integers and returns the floored quotient</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="rounding"></a>Rounding<a class="hash-link" href="#rounding" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(/ 1  2) =&gt; ()</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(/ 2  2) =&gt; 1</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(/ 4  2) =&gt; 2</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="division-of-negative-numbers"></a>Division of negative numbers<a class="hash-link" href="#division-of-negative-numbers" title="Direct link to heading">#</a></h3><p>The treatment of negative dividend and divisors is as follows:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(/ -1 1) =&gt; -1</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(/ 1 -1) =&gt; -1</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(/ -1 -1) =&gt;  1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="flooring-of-negative-numbers"></a>Flooring of negative numbers<a class="hash-link" href="#flooring-of-negative-numbers" title="Direct link to heading">#</a></h3><p>Note that a division with a remainder always rounds towards negative infinity, not toward zero.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(/ -3 2) =&gt; -2</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(/ 3 2) =&gt; 1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This means that <code>-a / b</code> is not always equal to <code>-(a / b)</code></p><p><strong>divmod</strong> <code>(divmod A B)</code> takes two integers and returns a cons-box containing the floored quotient and the remainder.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(divmod 10 3)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; (3 . 1)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="bit-operations"></a>Bit Operations<a class="hash-link" href="#bit-operations" title="Direct link to heading">#</a></h2><p><code>logand</code>, <code>logior</code> and <code>logxor</code> operate on any number of arguments
nil as an argument to these functions is treated as a zero.
Fail if either A or B is not an atom.
The shorter atom is sign-extended to equal length as the longer atom.</p><p>The <code>logand</code>, <code>logior</code> and <code>logxor</code> accept 0 or more parameters.
There is an implicit <em>identity</em> argument, which is the value all parameters will apply to.
The identity will just be returned in case 0 arguments are given.</p><p><strong>logand</strong> <code>(logand A B ...)</code> bitwise <strong>AND</strong> of one or more atoms. Identity is <code>-1</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(logand -128 0x7fffff)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 0x7fff80</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The first argument is <code>0x80</code> (since it&#x27;s Two&#x27;s complement). It is negative, it will be sign-extended with ones.
Once sign-extended, the computation becomes <code>0xffff80</code> AND <code>0x7fffff</code> = <code>0x7fff80</code>.</p><p><strong>logior</strong> <code>(logior A B ...)</code> bitwise logical <strong>OR</strong> of one or more atoms. Identity is <code>0</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(logior -128 0x7fffff)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; -1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Sign extending the first argument becomes <code>0xffff80</code>, ORing that with <code>0x7fffff</code> becomes <code>0xffffff</code> which is -1 in Two&#x27;s complement.
Note that the resulting atom will use the minimal encoding of <code>-1</code>, i.e. <code>0xff</code>.</p><p><strong>logxor</strong> <code>(logxor A B ...)</code> bitwise <strong>XOR</strong> of any number of atoms. Identity is <code>0</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(logxor -128 0x7fffff)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 0x80007f</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Sign extending the first argument becomes <code>0xffff80</code>, XORing that with <code>0x7fffff</code> becomes <code>0x80007f</code>.
This is a negative number (in Two&#x27;s complement) and it&#x27;s also the minimal representation of it.</p><p><strong>lognot</strong> <code>(lognot A)</code> bitwise <strong>NOT</strong> of A. All bits are inverted.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(lognot ()) =&gt; -1</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(lognot 1) =&gt; -2</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(lognot (lognot 17)) =&gt; 17</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="shifts"></a>Shifts<a class="hash-link" href="#shifts" title="Direct link to heading">#</a></h2><p>There are two variants of bit shift operators.
Arithmetic shift (<code>ash</code>) and Logical shift (<code>lsh</code>). Both can be used to shift both left and right, the direction is determined by the sign of the <em>count</em> argument.
A positive <em>count</em> shifts left, a negative <em>count</em> shifts right.
For both <strong>ash</strong> and <strong>lsh</strong>, if |<em>count</em>| exceeds 65535, the operation fails.
The resulting value is treated as a signed integer, and any redundant leading zero-bytes or <code>0xff</code> bytes are stripped.</p><p><strong>ash</strong> <code>(ash A count)</code> if <em>count</em> is positive, return <em>A</em> shifted left <em>count</em> bits, else returns <em>A</em> shifted right by |<em>count</em>| bits, sign extended.</p><p>Arithmetic shift treats the value to be shifted (<em>A</em>) as a signed integer, and sign extends the left-most bits when when shifting right.</p><p>When shifting left, any new bytes added to the left side of the value are also filled with the sign-extended bit. For example:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(ash -1 8) ; -1 = . . . 11111111</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; -256 ; -256 = . . 1111111100000000</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A arithmetic left shift will only extend the atom length when more bits are needed</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen (ash -1 7))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 1</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen (ash -1 8))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 2</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen (ash 255 1))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  =&gt; 2</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen (ash 128 1))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  =&gt; 2</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen (ash 127 1))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  =&gt; 2</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Consecutive right shifts of negative numbers will result in a terminal value of -1.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(ash -7 -1) ; -7 = . . . 11111001</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; -4</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(ash -4 -1) ; -4 = . . . 11111100</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; -2</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(ash -2 -1) ; -2 = . . . 11111110</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; -1</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(ash -1 -1) ; -1 = . . . 11111111</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; -1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A right shift of <code>-1</code> by any amount is still <code>-1</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(ash -1 -99)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; -1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>lsh</strong> <code>(lsh A count)</code> if <em>count</em> is positive, return <em>A</em> shifted left <em>count</em> bits, else returns <em>A</em> shifted right |<em>count</em>| bits, adding zero bits on the left.</p><p>Logical shift treats the value to be shifted as an unsigned integer, and does not sign extend on right shift.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(lsh -7 -1) ; -7 = . . . 11111001</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 124   ;    = . . . 01111100</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(lsh -5 -2) ; -5 = . . . 11111011</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 62    ;    = . . . 00111110</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A left shift of an atom with the high bit set will extend the atom left, and result in an allocation.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(lsh -1 1) ; -1 = . . . 11111111</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 510  ;    = . . . 0000000111111110</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen (lsh -1 1))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 2</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen (lsh 255 1))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  =&gt; 2</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen (lsh 128 1))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  =&gt; 2</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen (lsh 127 1))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  =&gt; 2</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="strings"></a>Strings<a class="hash-link" href="#strings" title="Direct link to heading">#</a></h2><p><strong>substr</strong> <code>(substr S I1 I2)</code> return an atom containing the bytes in range [<code>I1</code>, <code>I2</code>). Index 0 refers to the first byte of the string <code>S</code>. <code>I2</code> must be greater than or equal to <code>I1</code>. Both <code>I1</code> and <code>I2</code> must be greater than or equal to 0, and less than or equal to one past the end of the string <code>S</code>.</p><p>The third parameter to <code>substr</code> is optional. If omitted, the range [<code>I1</code>, <code>(strlen S)</code>) is returned.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(substr &quot;clvm&quot; 0 4) =&gt; &quot;clvm&quot;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(substr &quot;clvm&quot; 2 4) =&gt; 30317 ; = &quot;vm&quot;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(substr &quot;clvm&quot; 4 4) =&gt; ()</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(substr &quot;clvm&quot; 1) =&gt; &quot;lvm&quot;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(substr &quot;clvm&quot; 4 5) =&gt; FAIL</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(substr &quot;clvm&quot; 1 0) =&gt; FAIL</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(substr &quot;clvm&quot; -1 4) =&gt; FAIL</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>strlen</strong> <code>(strlen S)</code> return the number of bytes in <code>S</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen &quot;clvm&quot;) =&gt; 4</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen &quot;0x0&quot;) =&gt; 3</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen 0x0) =&gt; 1</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen &quot;&quot;) =&gt; ()</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen 0) =&gt; ()</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen ()) =&gt; ()</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen ()) =&gt; ()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>concat</strong> <code>(concat A ...)</code> return the concatenation of any number of atoms.</p><p>Example:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(concat &quot;Hello&quot; &quot; &quot; &quot;world&quot;)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; &quot;Hello world&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="streaming-operators"></a>Streaming Operators<a class="hash-link" href="#streaming-operators" title="Direct link to heading">#</a></h2><p><strong>sha256</strong>
<code>(sha256 A ...)</code> returns the sha256 hash (as a 32-byte blob) of the bytes of its parameters.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(sha256 &quot;clvm&quot;)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 0xcf3eafb281c0e0e49e19c18b06939a6f7f128595289b08f60c68cef7c0e00b81</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(sha256 &quot;cl&quot; &quot;vm&quot;)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 0xcf3eafb281c0e0e49e19c18b06939a6f7f128595289b08f60c68cef7c0e00b81</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="bls12-381-operators"></a>BLS12-381 operators<a class="hash-link" href="#bls12-381-operators" title="Direct link to heading">#</a></h2><p><code>point_add</code> and <code>pubkey_for_exp</code> operate on G1 points of the BLS12-381 curve. These are represented as 48 bytes == 384 bits.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(strlen (pubkey_for_exp 1))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 48</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>point_add</strong>
<code>(point_add a0 a1 ...)</code> takes an arbitrary number of <a href="https://electriccoin.co/blog/new-snark-curve/" target="_blank" rel="noopener noreferrer">BLS12-381</a> G1 points and adds them.</p><p>Example:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(point_add (pubkey_for_exp 1) (pubkey_for_exp 2))</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 0x89ece308f9d1f0131765212deca99697b112d61f9be9a5f1f3780a51335b3ff981747a0b2ca2179b96d2c0c9024e5224</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>pubkey_for_exp</strong>
<code>(pubkey_for_exp A)</code> turns the integer A into a BLS12-381 point on G1.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(pubkey_for_exp 1)</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   =&gt; 0x97f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="softfork"></a>softfork<a class="hash-link" href="#softfork" title="Direct link to heading">#</a></h2><p>The <code>softfork</code> operator takes at least one parameter cost. So <code>(softfork cost arg_1 ... arg_n)</code>.</p><p>At the moment, <code>softfork</code> always returns <code>0</code> (aka <code>()</code> or nil), and takes <code>cost</code> amount of cost.</p><p>At first glance, it seems pretty useless since it doesn&#x27;t do anything, and just wastes cost doing it.</p><p>The idea is, after a soft fork, the meaning of the arguments may change. In fact, we can hide completely new dialects of Chialisp inside here, that has new operators that calculate new things.</p><p>For example, suppose we want to add secp256k1 operators like <code>+s</code> for adding two points on this ECDSA curve for bitcoin compatibility. We can&#x27;t just do this in vanilla clvm because that would make a program <code>(+s p1 p2)</code> return different values before and after the soft fork. So instead we hide it under <code>softfork</code>.</p><p><code>(mod (cost p1 p2 p3 p4) (softfork cost 1 (assert (= (+s p1 p2) (+s p3 p4)))))</code></p><p>Pre-softfork, this always passes and returns <code>()</code> at a cost of <code>COST</code> (plus a bit of overhead).</p><p>Post-softfork, this also returns <code>()</code> at a cost of <code>COST</code>... but may also fail if <code>p1 + p2 â‰  p3 + p4</code>! We can&#x27;t export the sum outside the <code>softfork</code> boundary, but we can calculate the sum and compare it to another thing inside.</p><p>One more thing -- we take the cost of running the program inside the <code>softfork</code> boundary and ensure it exactly matches <code>COST</code>, and raise an exception if it&#x27;s wrong. That way, the program really does have the same cost pre and post-softfork (or it fails post-softfork).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="arithmetic-and-bitwise-identities"></a>Arithmetic and Bitwise Identities<a class="hash-link" href="#arithmetic-and-bitwise-identities" title="Direct link to heading">#</a></h2><p>Some operators have a special value that is returned when they are called with zero arguments. This value is the identity of that function. For example, calling the operator <code>+</code> with zero arguments will return <code>0</code>:</p><p><code>(+)</code> =&gt; <code>0</code></p><table><thead><tr><th>Operator</th><th>Identity</th></tr></thead><tbody><tr><td><code>+</code></td><td>0</td></tr><tr><td><code>-</code></td><td>0</td></tr><tr><td><code>*</code></td><td>1</td></tr><tr><td>logand</td><td>all 1&#x27;s</td></tr><tr><td>logior</td><td>all zeros</td></tr><tr><td>logxor</td><td>all zeros</td></tr></tbody></table><p>Note that <code>/</code>, <code>divmod</code>, and <code>lognot</code> do not have an identity value. Calling them with zero arguments is an error.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="arithmetic"></a>Arithmetic<a class="hash-link" href="#arithmetic" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="behaviour-of-nil-when-used-as-an-integer"></a>Behaviour of nil when used as an integer<a class="hash-link" href="#behaviour-of-nil-when-used-as-an-integer" title="Direct link to heading">#</a></h3><p>When used in an integer context, nil behaves as zero.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="behaviour-of-zero-when-used-as-a-value-that-may-be-checked-for-nil"></a>Behaviour of zero when used as a value that may be checked for nil<a class="hash-link" href="#behaviour-of-zero-when-used-as-a-value-that-may-be-checked-for-nil" title="Direct link to heading">#</a></h3><p>When used as a parameter that may be checked for nil, zero is interpreted as nil.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="costs"></a>Costs<a class="hash-link" href="#costs" title="Direct link to heading">#</a></h2><p>When a CLVM program is run, a cost is attributed to it. The minimum program cost is 40. The maximum cost per block is 11 000 000 000 (11 billion). If the cost of an individual program exceeds this threshold, the program will fail. The maximum realistic size of a block is around 400 KB.</p><p>To determine the total cost of a clvm program, you can run <code>brun -c &lt;clvm&gt;</code>, but this doesn&#x27;t include the cost of the program&#x27;s size or its conditions. All of these costs will be explained in detail below.</p><p>This section begins with a breakdown of the specific cost for each operator and how to calculate costs by hand.</p><ul><li><a href="#cost-tables">Cost tables</a></li><li><a href="#evaluating-cost-for-a-sample-brun-program">Evaluating cost for a sample brun program</a></li><li><a href="#evaluating-cost-for-a-typical-transaction">Evaluating cost for a typical transaction</a></li></ul><p>Later, we&#x27;ll discuss our rationale for having costs in the first place. We&#x27;ll also detail the theoretical and realistic maximum cost and size per block. </p><ul><li><a href="#minimum-spec-machine-for-farming">Minimum spec machine for farming</a></li><li><a href="#maximum-cost-per-block">Maximum cost per block</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="cost-tables"></a>Cost tables<a class="hash-link" href="#cost-tables" title="Direct link to heading">#</a></h3><p>The costs used in Chia&#x27;s consensus come from the Rust implementation of CLVM, specifically from these locations:</p><ul><li><a href="https://github.com/Chia-Network/clvm_rs/blob/main/src/more_ops.rs#L24" target="_blank" rel="noopener noreferrer">more_ops.rs#L24</a></li><li><a href="https://github.com/Chia-Network/clvm_rs/blob/main/src/core_ops.rs#L7" target="_blank" rel="noopener noreferrer">core_ops.rs#L7</a></li><li><a href="https://github.com/Chia-Network/clvm_rs/blob/main/src/run_program.rs#L11" target="_blank" rel="noopener noreferrer">run_program.rs#L11</a></li></ul><p>We&#x27;ll start with a table showing the two base costs, namely a mandatory cost and a cost per byte of memory.</p><table><thead><tr><th>type</th><th>base cost</th><th>cost per byte</th></tr></thead><tbody><tr><td>mandatory cost</td><td>1</td><td>-</td></tr><tr><td><code>MALLOC_COST_PER_BYTE</code></td><td>-</td><td>10</td></tr></tbody></table><ul><li>The &quot;mandatory cost&quot; is charged for all operators to process data</li><li><code>MALLOC_COST_PER_BYTE</code> is charged for allocating new atoms, as the return value(s) from operators. Atoms 0 and 1 don&#x27;t count, they are free. E.g. <code>(&gt; A B)</code>, which returns <code>true</code> or <code>false</code>, is not charged the <code>MALLOC_COST_PER_BYTE</code>.</li></ul><p>Next we&#x27;ll show the cost of each CLVM operator, as well as the cost of the outputted conditions.</p><table><thead><tr><th>operator</th><th>base cost</th><th>cost per arg</th><th>cost per byte</th></tr></thead><tbody><tr><td><code>f</code> <em>first</em></td><td>30</td><td>-</td><td>-</td></tr><tr><td><code>i</code> <em>if</em></td><td>33</td><td>-</td><td>-</td></tr><tr><td><code>c</code> <em>cons</em></td><td>50</td><td>-</td><td>-</td></tr><tr><td><code>r</code> <em>rest</em></td><td>30</td><td>-</td><td>-</td></tr><tr><td><code>l</code> <em>listp</em></td><td>19</td><td>-</td><td>-</td></tr><tr><td><code>q</code> <em>quote</em></td><td>20</td><td>-</td><td>-</td></tr><tr><td><code>a</code> <em>apply</em></td><td>90</td><td>-</td><td>-</td></tr><tr><td><code>=</code></td><td>117</td><td>-</td><td>1</td></tr><tr><td><code>+</code></td><td>99</td><td>320</td><td>3</td></tr><tr><td><code>/</code></td><td>988</td><td>-</td><td>4</td></tr><tr><td><code>*</code></td><td>92</td><td>885</td><td><a href="https://github.com/Chia-Network/clvm_tools/blob/main/costs/README.md#multiplication" target="_blank" rel="noopener noreferrer">see here</a></td></tr><tr><td><code>logand</code>, <code>logior</code>, <code>logxor</code></td><td>100</td><td>264</td><td>3</td></tr><tr><td><code>lognot</code></td><td>331</td><td>-</td><td>3</td></tr><tr><td><code>&gt;</code></td><td>498</td><td>-</td><td>2</td></tr><tr><td><code>&gt;s</code></td><td>117</td><td>-</td><td>1</td></tr><tr><td><code>strlen</code></td><td>173</td><td>-</td><td>1</td></tr><tr><td><code>concat</code></td><td>142</td><td>135</td><td>3</td></tr><tr><td><code>divmod</code></td><td>1116</td><td>-</td><td>6</td></tr><tr><td><code>sha256</code></td><td>87</td><td>134</td><td>2</td></tr><tr><td><code>ash</code></td><td>596</td><td>-</td><td>3</td></tr><tr><td><code>lsh</code></td><td>277</td><td>-</td><td>3</td></tr><tr><td><code>not</code>, <code>any</code>, <code>all</code></td><td>200</td><td>300</td><td>-</td></tr><tr><td><code>point_add</code></td><td>101094</td><td>1343980</td><td>-</td></tr><tr><td><code>pubkey_for_exp</code></td><td>1325730</td><td>-</td><td>38</td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><p>Next, three of CLVM&#x27;s conditions also have an associated cost:</p><table><thead><tr><th>operator</th><th>cost</th></tr></thead><tbody><tr><td><code>CREATE_COIN</code></td><td>1800000</td></tr><tr><td><code>AGG_SIG_UNSAFE</code></td><td>1200000</td></tr><tr><td><code>AGG_SIG_ME</code></td><td>1200000</td></tr></tbody></table><p>Finally, each byte of data that gets added to the blockchain has a cost of 12 000. Spendbundles are created using a serialized format of CLVM programs, calculated by running <a href="https://chialisp.com/docs/debugging#opd-and-opc" target="_blank" rel="noopener noreferrer">opc</a> on the original CLVM code. Each two-digit pair of this format is equivalent to one byte on the blockchain, with a cost of 12 000.</p><p>Aside from cost, the maximum number of atoms or pairs (counted separately) in a CLVM program is 2^31 apiece. If this threshold is exceeded, the program will fail. However, this is likely a moot point because it&#x27;s probably not possible to write a program with this many atoms or pairs without exceeding the maximum cost per block.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="evaluating-cost-for-a-sample-brun-program"></a>Evaluating cost for a sample brun program<a class="hash-link" href="#evaluating-cost-for-a-sample-brun-program" title="Direct link to heading">#</a></h3><p>In this section, we&#x27;ll show you how to calculate the cost of a simple CLVM program by hand. The program we&#x27;ll use is</p><p>brun &quot;(concat (q . <code>gu</code>) (q . <code>ide</code>))&quot;</p><p>Where &quot;gu&quot; and &quot;ide&quot; are quoted, so that they are interpreted as values rather than programs.</p><p>The <code>brun</code> command takes two arguments, a program and its &quot;environment&quot;. If no environment is specified on the command line (as is the case in this example), we use an empty environment, &quot;()&quot;.</p><p>At the lowest level of the interpreter, we interpret an atom as one of three things:</p><ol><li>A quote (cost 20)</li><li>A path lookup into the environment (base cost of 44 + 4 for each bit)<blockquote><p>Note that there might be a penalty cost. See the <a href="#penalty-cost">Penalty cost</a> section for more info</p></blockquote></li><li>An operator (mandatory cost of 1 + the cost of executing the operator)</li></ol><p>Next we can calculate the cost of the program, &quot;(concat (q . <code>gu</code>) (q . <code>ide</code>))&quot;:</p><ul><li><code>concat</code> eval (mandatory cost):   1</li><li><code>q . gu</code> (cost of a quote):      20 </li><li><code>q . ide</code> (cost of a quote):     20 </li><li><code>concat</code> (execution cost):      142</li><li><code>concat</code> arg cost (&quot;gu&quot;):       135 </li><li><code>concat</code> arg cost (&quot;ide&quot;):      135</li><li><code>concat</code> two bytes (&quot;gu&quot;):        6 (2 bytes * 3 cost per byte)</li><li><code>concat</code> three bytes (&quot;ide&quot;):     9 (3 bytes * 3 cost per byte)</li><li><code>malloc</code> five bytes (&quot;guide&quot;):   50 (5 bytes * 10 malloc cost per byte)</li></ul><p>Program cost = 518</p><p>This is confirmed by running <code>brun</code> from the command line:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI powershell"><pre tabindex="0" class="prism-code language-powershell codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">PS C:\Users\User&gt; brun -c --quiet &#x27;(concat (q . gu) (q . ide))&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">cost = 518</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="penalty-cost"></a>Penalty cost<a class="hash-link" href="#penalty-cost" title="Direct link to heading">#</a></h3><p>At first glance, it might appear that the following two programs should have the same cost. However, the cost of the second program is 10 higher than that of the first:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun -c &#x27;(+ (q . 126) (q . 1))&#x27; </span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">cost = 796</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">127</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun -c &#x27;(+ (q . 127) (q . 1))&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">cost = 806</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">128</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The reason these programs cost different is that the latter needs a leading zero in its result. When dumping the hexadecimal representation of the output, this becomes clearer:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun -d -c &#x27;(+ (q . 126) (q . 1))&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">cost = 796</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">7f</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun -d -c &#x27;(+ (q . 127) (q . 1))&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">cost = 806</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">820080</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="evaluating-cost-for-a-typical-transaction"></a>Evaluating cost for a typical transaction<a class="hash-link" href="#evaluating-cost-for-a-typical-transaction" title="Direct link to heading">#</a></h3><p>Now let&#x27;s look at a real-world example of calculating cost. The <em>standard</em> transaction is one that adds and removes one or more vanilla XCH coins from the coin set. While it is possible to both add and remove exactly one coin in a standard transaction, a more <em>typical</em> transaction would involve adding and removing two coins, giving the transaction two inputs and two outputs.</p><p>This would happen if Alice spent two coins to send money to Bob, and received one coin back as change. We&#x27;ll detail two techniques to calculate the cost of this transaction.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="obtaining-transaction-info-from-a-wallet"></a>Obtaining transaction info from a wallet<a class="hash-link" href="#obtaining-transaction-info-from-a-wallet" title="Direct link to heading">#</a></h3><p>This technique is straightforward, but it will only give a rough estimate of cost. We&#x27;ll look at a more accurate technique in the next section.</p><p>The example we&#x27;ll use is a transaction where Alice sent money to Bob and received change. The commands will be performed on Alice&#x27;s computer. First, we&#x27;ll run <code>get_transactions</code> to obtain the transaction ID:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ chia wallet get_transactions</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">Transaction cd4e915dc8fd6eb932b5e1be67088eb9af48a560a6ddbc55c53ee44eaf191ee0</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">Status: Confirmed</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">Amount sent: </span><span class="token number" style="color:#B35C00;font-weight:normal">1.01</span><span class="token plain"> XCH</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">To address: xch1989s7f4dn43963gsdqus7z6ydm7upuqzfae4ftts7rm80k4848csewg085</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">Created at: </span><span class="token number" style="color:#B35C00;font-weight:normal">2022</span><span class="token plain">-03-20 06:03:09</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Next, we&#x27;ll get more info by running <code>get_transaction</code>, entering the ID we just obtained:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ chia wallet get_transaction -tx</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">cd4e915dc8fd6eb932b5e1be67088eb9af48a560a6ddbc55c53ee44eaf191ee0 -v</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">{</span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;additions&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">[</span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;amount&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1010000000000</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                 </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;parent_coin_info&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0x484ed352cd7e7e396bdbee72302e40653c2d880bd134d29f75f07ffffe4c7a0f&#x27;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                 </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;puzzle_hash&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0x29cb0f26ad9d625d451068390f0b446efdc0f0024f7354ad70f0f677daa7a9f1&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;amount&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">936839958396</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                 </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;parent_coin_info&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0x484ed352cd7e7e396bdbee72302e40653c2d880bd134d29f75f07ffffe4c7a0f&#x27;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                 </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;puzzle_hash&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0xf56f5af041272572fe528e794c364fbe2be444ab77de62a1796772804a4c9fef&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;amount&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1010000000000</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;confirmed&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> True,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;confirmed_at_height&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1720943</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;created_at_time&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1647781389</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;fee_amount&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">0</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;memos&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">[</span><span class="token punctuation" style="color:#383a42">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;name&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0xcd4e915dc8fd6eb932b5e1be67088eb9af48a560a6ddbc55c53ee44eaf191ee0&#x27;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;removals&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain">   </span><span class="token punctuation" style="color:#383a42">[</span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;amount&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">946839958396</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                 </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;parent_coin_info&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0x98706c3a489574a9f32f339662f339b7ba3c9dce1da4feb301432aa60216635e&#x27;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                 </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;puzzle_hash&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0xe415c314693b27c0cb949c27cb244a8ed9def528346f37491393fdd49e24bcd5&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;amount&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1000000000000</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                 </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;parent_coin_info&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0x98706c3a489574a9f32f339662f339b7ba3c9dce1da4feb301432aa60216635e&#x27;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;puzzle_hash&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0xd8af3cb1130f6d7e4011c6fa85779c0cfddb1a594cdd170d1dfc8aeb5f3c93fe&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               </span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;spend_bundle&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;aggregated_signature&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0xa35c58c6687e79a91e2c409451e620dc26f286637be916910d02253fa0fb401a77d0f3c2b0ff72565fae5c9e66affbe70833f7bbae6b2c3508404f6058ec82d94f9738d23a4b23748d97d71e532a7d7c6390f21fe82dc5f1c0c75d90150d952f&#x27;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                  </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;coin_spends&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">[</span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                     </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;coin&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;amount&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">946839958396</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;parent_coin_info&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0x98706c3a489574a9f32f339662f339b7ba3c9dce1da4feb301432aa60216635e&#x27;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;puzzle_hash&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0xe415c314693b27c0cb949c27cb244a8ed9def528346f37491393fdd49e24bcd5&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                     </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;puzzle_reveal&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0xff02ffff01ff02ffff01ff02ffff03ff0bffff01ff02ffff03ffff09ff05ffff1dff0bffff1effff0bff0bffff02ff06ffff04ff02ffff04ff17ff8080808080808080ffff01ff02ff17ff2f80ffff01ff088080ff0180ffff01ff04ffff04ff04ffff04ff05ffff04ffff02ff06ffff04ff02ffff04ff17ff80808080ff80808080ffff02ff17ff2f808080ff0180ffff04ffff01ff32ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff06ffff04ff02ffff04ff09ff80808080ffff02ff06ffff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b09496e8abd4a5b09f10b71e43b779f7ed8d5c1c92e3c5a6b70cd78bc2fb32347cc5fdca3f6acafb143f185029cd422010ff018080&#x27;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;solution&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0xff80ffff01ffff33ffa029cb0f26ad9d625d451068390f0b446efdc0f0024f7354ad70f0f677daa7a9f1ff8600eb28b0f40080ffff33ffa0f56f5af041272572fe528e794c364fbe2be444ab77de62a1796772804a4c9fefff8600da20034f7c80ffff3cffa048c2db108c24bf3192913b6cd5bca66688a9b2fc0e1821e306f7b01848a7b24d8080ff8080&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                  </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                  </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                     </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;coin&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;amount&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1000000000000</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;parent_coin_info&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0x98706c3a489574a9f32f339662f339b7ba3c9dce1da4feb301432aa60216635e&#x27;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;puzzle_hash&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0xd8af3cb1130f6d7e4011c6fa85779c0cfddb1a594cdd170d1dfc8aeb5f3c93fe&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                     </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;puzzle_reveal&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0xff02ffff01ff02ffff01ff02ffff03ff0bffff01ff02ffff03ffff09ff05ffff1dff0bffff1effff0bff0bffff02ff06ffff04ff02ffff04ff17ff8080808080808080ffff01ff02ff17ff2f80ffff01ff088080ff0180ffff01ff04ffff04ff04ffff04ff05ffff04ffff02ff06ffff04ff02ffff04ff17ff80808080ff80808080ffff02ff17ff2f808080ff0180ffff04ffff01ff32ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff06ffff04ff02ffff04ff09ff80808080ffff02ff06ffff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b0848f09f98800442737684dd76071f25a0bd100b51e727aabafeddb062dbc3d2b3ac64bc87f084a6d16e4e89e1417de14ff018080&#x27;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;solution&#x27;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;0xff80ffff01ffff3dffa023f61666150d2a467ee7b81a77954c93255d65c0c43108f1bb14ac420fd59c428080ff8080&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                  </span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>additions</code> and <code>removals</code> sections contain two coins apiece. Before the transaction, Alice had two coins in her wallet, one worth 1 XCH, and one worth 0.946839958396 XCH. The amount sent was 1.01 XCH, which was greater than the value of either of Alice&#x27;s coins. The wallet therefore automatically selected both coins to be sent, for a total of 1.946839958396 XCH. A new coin worth 0.936839958396 XCH was created in Alice&#x27;s wallet as &quot;change&quot;. </p><p>To recap, before the transaction:</p><ul><li>Alice had two coins, worth 1 XCH and 0.946839958396 XCH</li><li>Bob had zero coins</li><li>The total value was 1.946839958396 XCH</li></ul><p>After the transaction:</p><ul><li>Alice had one coin worth 0.936839958396 XCH</li><li>Bob had one coin worth 1.01 XCH</li><li>The total value was 1.946839958396 XCH (same as before the transaction)</li></ul><p>Back to the original question: what was the CLVM cost of this transaction? One way to find out is by creating a spend bundle based on the output of the <code>get_transaction</code> command, and inspecting it using <code>cdv</code>.</p><blockquote><p>NOTE: You&#x27;ll need to run <code>pip install chia-dev-tools</code> in order to use the <code>cdv</code> command.</p></blockquote><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ cdv inspect spendbundles spend.json -ec</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">Cost: </span><span class="token number" style="color:#B35C00;font-weight:normal">17187295</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The cost was 17 187 295. Note that this command is simulating a small block that contains only the single spendbundle. In reality, this spendbundle would be aggregated into a larger block, possibly with 999 similar transactions. Therefore, this cost is only an estimation. However, for many applications, this simple technique will be sufficient.</p><p>As for fee calculations, if your transaction makes it into the mempool, then it will be prioritized (using mojos per cost as a metric) against all other transactions in the mempool. If the mempool is full, however, your transaction&#x27;s fee will need to be at least 5 mojos per cost in order to kick another transaction out of the mempool. Therefore, in order to increase the likelihood of your transaction making it into the mempool right away, we recommend that you include a fee of at least five mojos per cost with every transaction.</p><p>In this case, the fee to reach the 5 mojos per cost threshold is <code>5 * 17 187 295 = 85 936 475 mojos</code>. However, because the cost is just an estimate, and generally speaking, you might not want to calculate the cost of every transaction before it is run, it&#x27;s a good idea to round the fee up to 100 million mojos.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="obtaining-transaction-info-using-rpc-and-brun"></a>Obtaining transaction info using RPC and brun<a class="hash-link" href="#obtaining-transaction-info-using-rpc-and-brun" title="Direct link to heading">#</a></h3><p><code>brun -c</code> will give the actual cost of a program, but it is still necessary to calculate some costs manually, as we&#x27;ll explain in this section.</p><p>First, obtain the same info as before, this time using RPC commands to get the record of the coin you want to examine:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ cdv rpc coinrecords --by </span><span class="token function" style="color:#0045DB">id</span><span class="token plain"> 0x484ed352cd7e7e396bdbee72302e40653c2d880bd134d29f75f07ffffe4c7a0f</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;coin&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;amount&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">946839958396</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;parent_coin_info&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0x98706c3a489574a9f32f339662f339b7ba3c9dce1da4feb301432aa60216635e&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;puzzle_hash&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0xe415c314693b27c0cb949c27cb244a8ed9def528346f37491393fdd49e24bcd5&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;coinbase&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> false,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;confirmed_block_index&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1720835</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;spent&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> true,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;spent_block_index&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1720943</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;timestamp&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1647780998</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This coin was spent in block 1720943. Using this info, we can get the original puzzle and solution used in the coin spend, in serialized form:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ cdv rpc blockspends -id 484ed352cd7e7e396bdbee72302e40653c2d880bd134d29f75f07ffffe4c7a0f -h </span><span class="token number" style="color:#B35C00;font-weight:normal">1720943</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;coin&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;amount&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">946839958396</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;parent_coin_info&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0x98706c3a489574a9f32f339662f339b7ba3c9dce1da4feb301432aa60216635e&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;puzzle_hash&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0xe415c314693b27c0cb949c27cb244a8ed9def528346f37491393fdd49e24bcd5&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;puzzle_reveal&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0xff02ffff01ff02ffff01ff02ffff03ff0bffff01ff02ffff03ffff09ff05ffff1dff0bffff1effff0bff0bffff02ff06ffff04ff02ffff04ff17ff8080808080808080ffff01ff02ff17ff2f80ffff01ff088080ff0180ffff01ff04ffff04ff04ffff04ff05ffff04ffff02ff06ffff04ff02ffff04ff17ff80808080ff80808080ffff02ff17ff2f808080ff0180ffff04ffff01ff32ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff06ffff04ff02ffff04ff09ff80808080ffff02ff06ffff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b09496e8abd4a5b09f10b71e43b779f7ed8d5c1c92e3c5a6b70cd78bc2fb32347cc5fdca3f6acafb143f185029cd422010ff018080&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;solution&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0xff80ffff01ffff33ffa029cb0f26ad9d625d451068390f0b446efdc0f0024f7354ad70f0f677daa7a9f1ff8600eb28b0f40080ffff33ffa0f56f5af041272572fe528e794c364fbe2be444ab77de62a1796772804a4c9fefff8600da20034f7c80ffff3cffa048c2db108c24bf3192913b6cd5bca66688a9b2fc0e1821e306f7b01848a7b24d8080ff8080&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Next, use the <code>opd</code> command to deserialize the puzzle and solution to human-readable clvm:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ opd ff02ffff01ff02ffff01ff02ffff03ff0bffff01ff02ffff03ffff09ff05ffff1dff0bffff1effff0bff0bffff02ff06ffff04ff02ffff04ff17ff8080808080808080ffff01ff02ff17ff2f80ffff01ff088080ff0180ffff01ff04ffff04ff04ffff04ff05ffff04ffff02ff06ffff04ff02ffff04ff17ff80808080ff80808080ffff02ff17ff2f808080ff0180ffff04ffff01ff32ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff06ffff04ff02ffff04ff09ff80808080ffff02ff06ffff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b09496e8abd4a5b09f10b71e43b779f7ed8d5c1c92e3c5a6b70cd78bc2fb32347cc5fdca3f6acafb143f185029cd422010ff018080</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">i </span><span class="token number" style="color:#B35C00;font-weight:normal">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">i </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">=</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">5</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">point_add </span><span class="token number" style="color:#B35C00;font-weight:normal">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">pubkey_for_exp </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">sha256 </span><span class="token number" style="color:#B35C00;font-weight:normal">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token number" style="color:#B35C00;font-weight:normal">6</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">23</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">23</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">47</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">8</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">5</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token number" style="color:#B35C00;font-weight:normal">6</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">23</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token number" style="color:#B35C00;font-weight:normal">23</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">47</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">50</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">i </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">l </span><span class="token number" style="color:#B35C00;font-weight:normal">5</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token builtin class-name" style="color:#006100">.</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token number" style="color:#B35C00;font-weight:normal">6</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">9</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token number" style="color:#B35C00;font-weight:normal">6</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">13</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token builtin class-name" style="color:#006100">.</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">5</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token builtin class-name" style="color:#006100">.</span><span class="token plain"> 0x9496e8abd4a5b09f10b71e43b779f7ed8d5c1c92e3c5a6b70cd78bc2fb32347cc5fdca3f6acafb143f185029cd422010</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ opd ff80ffff01ffff33ffa029cb0f26ad9d625d451068390f0b446efdc0f0024f7354ad70f0f677daa7a9f1ff8600eb28b0f40080ffff33ffa0f56f5af041272572fe528e794c364fbe2be444ab77de62a1796772804a4c9fefff8600da20034f7c80ffff3cffa048c2db108c24bf3192913b6cd5bca66688a9b2fc0e1821e306f7b01848a7b24d8080ff8080</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token variable punctuation" style="font-style:italic;color:#383a42">((</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">)</span><span class="token variable" style="font-style:italic"> </span><span class="token variable punctuation" style="font-style:italic;color:#383a42">(</span><span class="token variable" style="font-style:italic">q </span><span class="token variable punctuation" style="font-style:italic;color:#383a42">(</span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">51</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x29cb0f26ad9d625d451068390f0b446efdc0f0024f7354ad70f0f677daa7a9f1</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x00eb28b0f400</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">)</span><span class="token variable" style="font-style:italic"> </span><span class="token variable punctuation" style="font-style:italic;color:#383a42">(</span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">51</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0xf56f5af041272572fe528e794c364fbe2be444ab77de62a1796772804a4c9fef</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x00da20034f7c</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">)</span><span class="token variable" style="font-style:italic"> </span><span class="token variable punctuation" style="font-style:italic;color:#383a42">(</span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">60</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x48c2db108c24bf3192913b6cd5bca66688a9b2fc0e1821e306f7b01848a7b24d</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To obtain the cost of this program, use <code>brun -c</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ brun -c </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;(a (q 2 (q 2 (i 11 (q 2 (i (= 5 (point_add 11 (pubkey_for_exp (sha256 11 (a 6 (c 2 (c 23 ()))))))) (q 2 23 47) (q 8)) 1) (q 4 (c 4 (c 5 (c (a 6 (c 2 (c 23 ()))) ()))) (a 23 47))) 1) (c (q 50 2 (i (l 5) (q 11 (q . 2) (a 6 (c 2 (c 9 ()))) (a 6 (c 2 (c 13 ())))) (q 11 (q . 1) 5)) 1) 1)) (c (q . 0x9496e8abd4a5b09f10b71e43b779f7ed8d5c1c92e3c5a6b70cd78bc2fb32347cc5fdca3f6acafb143f185029cd422010) 1))&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;(() (q (51 0x29cb0f26ad9d625d451068390f0b446efdc0f0024f7354ad70f0f677daa7a9f1 0x00eb28b0f400) (51 0xf56f5af041272572fe528e794c364fbe2be444ab77de62a1796772804a4c9fef 0x00da20034f7c) (60 0x48c2db108c24bf3192913b6cd5bca66688a9b2fc0e1821e306f7b01848a7b24d)) ())&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">cost </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">39652</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token variable punctuation" style="font-style:italic;color:#383a42">((</span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">50</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x9496e8abd4a5b09f10b71e43b779f7ed8d5c1c92e3c5a6b70cd78bc2fb32347cc5fdca3f6acafb143f185029cd422010</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x87f20f182aa0b488027d678fd1cdb63f9fb583347cbf2744d2e7f5ae5ab49102</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">)</span><span class="token variable" style="font-style:italic"> </span><span class="token variable punctuation" style="font-style:italic;color:#383a42">(</span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">51</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x29cb0f26ad9d625d451068390f0b446efdc0f0024f7354ad70f0f677daa7a9f1</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x00eb28b0f400</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">)</span><span class="token variable" style="font-style:italic"> </span><span class="token variable punctuation" style="font-style:italic;color:#383a42">(</span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">51</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0xf56f5af041272572fe528e794c364fbe2be444ab77de62a1796772804a4c9fef</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x00da20034f7c</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">)</span><span class="token variable" style="font-style:italic"> </span><span class="token variable punctuation" style="font-style:italic;color:#383a42">(</span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">60</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x48c2db108c24bf3192913b6cd5bca66688a9b2fc0e1821e306f7b01848a7b24d</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The cost of this program was 39 652. However, there are three important things to note here:</p><ol><li>This only gives the program cost of executing the CLVM code. It does not include the per-byte cost of 12 000. Let&#x27;s calculate that cost now.</li></ol><ul><li>The serialized puzzle (before running <code>opd</code>) is 582 hexadecimal digits, or 291 bytes (2 digits per byte)</li><li>The serialized solution is 278 digits, or 139 bytes</li><li>The sum of these two is 430 bytes. With a cost of 12 000 per byte, the program&#x27;s size cost is 5 160 000</li></ul><ol start="2"><li>This cost does not include the CLVM conditions, specifically condition 50 (AGG_SIG_ME) and 51 (CREATE_COIN)</li></ol><ul><li>AGG_SIG_ME cost is 1 200 000</li><li>CREATE_COIN cost is 1 800 000 per coin, and there were two coins</li><li>The total condition cost is 4 800 000</li></ul><ol start="3"><li>Another coin was spent in the same transaction, which is not included here</li></ol><p>Let&#x27;s run the same commands to figure out the cost of the other coin spend:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ cdv rpc coinrecords --by </span><span class="token function" style="color:#0045DB">id</span><span class="token plain"> 0x45174eedbd162f2baeb37d7360c14727782d8f58519f878665efcdaef62a407a</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;coin&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;amount&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1000000000000</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;parent_coin_info&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0x98706c3a489574a9f32f339662f339b7ba3c9dce1da4feb301432aa60216635e&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;puzzle_hash&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0xd8af3cb1130f6d7e4011c6fa85779c0cfddb1a594cdd170d1dfc8aeb5f3c93fe&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;coinbase&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> false,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;confirmed_block_index&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1720835</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;spent&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> true,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;spent_block_index&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1720943</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;timestamp&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1647780998</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ cdv rpc blockspends -id 45174eedbd162f2baeb37d7360c14727782d8f58519f878665efcdaef62a407a -h </span><span class="token number" style="color:#B35C00;font-weight:normal">1720943</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;coin&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;amount&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1000000000000</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;parent_coin_info&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0x98706c3a489574a9f32f339662f339b7ba3c9dce1da4feb301432aa60216635e&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;puzzle_hash&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0xd8af3cb1130f6d7e4011c6fa85779c0cfddb1a594cdd170d1dfc8aeb5f3c93fe&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;puzzle_reveal&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0xff02ffff01ff02ffff01ff02ffff03ff0bffff01ff02ffff03ffff09ff05ffff1dff0bffff1effff0bff0bffff02ff06ffff04ff02ffff04ff17ff8080808080808080ffff01ff02ff17ff2f80ffff01ff088080ff0180ffff01ff04ffff04ff04ffff04ff05ffff04ffff02ff06ffff04ff02ffff04ff17ff80808080ff80808080ffff02ff17ff2f808080ff0180ffff04ffff01ff32ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff06ffff04ff02ffff04ff09ff80808080ffff02ff06ffff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b0848f09f98800442737684dd76071f25a0bd100b51e727aabafeddb062dbc3d2b3ac64bc87f084a6d16e4e89e1417de14ff018080&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;solution&quot;</span><span class="token builtin class-name" style="color:#006100">:</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&quot;0xff80ffff01ffff3dffa023f61666150d2a467ee7b81a77954c93255d65c0c43108f1bb14ac420fd59c428080ff8080&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ opd ff02ffff01ff02ffff01ff02ffff03ff0bffff01ff02ffff03ffff09ff05ffff1dff0bffff1effff0bff0bffff02ff06ffff04ff02ffff04ff17ff8080808080808080ffff01ff02ff17ff2f80ffff01ff088080ff0180ffff01ff04ffff04ff04ffff04ff05ffff04ffff02ff06ffff04ff02ffff04ff17ff80808080ff80808080ffff02ff17ff2f808080ff0180ffff04ffff01ff32ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff06ffff04ff02ffff04ff09ff80808080ffff02ff06ffff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b0848f09f98800442737684dd76071f25a0bd100b51e727aabafeddb062dbc3d2b3ac64bc87f084a6d16e4e89e1417de14ff018080</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">i </span><span class="token number" style="color:#B35C00;font-weight:normal">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">i </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">=</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">5</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">point_add </span><span class="token number" style="color:#B35C00;font-weight:normal">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">pubkey_for_exp </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">sha256 </span><span class="token number" style="color:#B35C00;font-weight:normal">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token number" style="color:#B35C00;font-weight:normal">6</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">23</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">23</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">47</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">8</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">4</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">5</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token number" style="color:#B35C00;font-weight:normal">6</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">23</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token number" style="color:#B35C00;font-weight:normal">23</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">47</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">50</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">i </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">l </span><span class="token number" style="color:#B35C00;font-weight:normal">5</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token builtin class-name" style="color:#006100">.</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token number" style="color:#B35C00;font-weight:normal">6</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">9</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">a </span><span class="token number" style="color:#B35C00;font-weight:normal">6</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token number" style="color:#B35C00;font-weight:normal">13</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">))</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token number" style="color:#B35C00;font-weight:normal">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token builtin class-name" style="color:#006100">.</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">5</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">c </span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">q </span><span class="token builtin class-name" style="color:#006100">.</span><span class="token plain"> 0x848f09f98800442737684dd76071f25a0bd100b51e727aabafeddb062dbc3d2b3ac64bc87f084a6d16e4e89e1417de14</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ opd ff80ffff01ffff3dffa023f61666150d2a467ee7b81a77954c93255d65c0c43108f1bb14ac420fd59c428080ff8080</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token variable punctuation" style="font-style:italic;color:#383a42">((</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">)</span><span class="token variable" style="font-style:italic"> </span><span class="token variable punctuation" style="font-style:italic;color:#383a42">(</span><span class="token variable" style="font-style:italic">q </span><span class="token variable punctuation" style="font-style:italic;color:#383a42">(</span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">61</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x23f61666150d2a467ee7b81a77954c93255d65c0c43108f1bb14ac420fd59c42</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">))</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">venv</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> chia-blockchain $ brun -c </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;(a (q 2 (q 2 (i 11 (q 2 (i (= 5 (point_add 11 (pubkey_for_exp (sha256 11 (a 6 (c 2 (c 23 ()))))))) (q 2 23 47) (q 8)) 1) (q 4 (c 4 (c 5 (c (a 6 (c 2 (c 23 ()))) ()))) (a 23 47))) 1) (c (q 50 2 (i (l 5) (q 11 (q . 2) (a 6 (c 2 (c 9 ()))) (a 6 (c 2 (c 13 ())))) (q 11 (q . 1) 5)) 1) 1)) (c (q . 0x848f09f98800442737684dd76071f25a0bd100b51e727aabafeddb062dbc3d2b3ac64bc87f084a6d16e4e89e1417de14) 1))&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;(() (q (61 0x23f61666150d2a467ee7b81a77954c93255d65c0c43108f1bb14ac420fd59c42)) ())&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">cost </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">15032</span><span class="token plain"></span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token variable punctuation" style="font-style:italic;color:#383a42">((</span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">50</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x848f09f98800442737684dd76071f25a0bd100b51e727aabafeddb062dbc3d2b3ac64bc87f084a6d16e4e89e1417de14</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x03db13c4e422e5eea98463c02b2c15994b620e0a45aa2db6f7785d3ba28f46cf</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">)</span><span class="token variable" style="font-style:italic"> </span><span class="token variable punctuation" style="font-style:italic;color:#383a42">(</span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">61</span><span class="token variable" style="font-style:italic"> </span><span class="token variable number" style="font-style:italic;color:#B35C00;font-weight:normal">0x23f61666150d2a467ee7b81a77954c93255d65c0c43108f1bb14ac420fd59c42</span><span class="token variable punctuation" style="font-style:italic;color:#383a42">))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The CLVM cost for this coin spend was 15 032.</p><p>We still need to calculate this program&#x27;s size cost.</p><ul><li>The serialized puzzle is 582 hexadecimal digits, or 291 bytes</li><li>The serialized solution is 94 digits, or 47 bytes</li><li>The sum of these two is 338 bytes. With a cost of 12 000 per byte, the program&#x27;s size cost is 4 056 000</li></ul><p>Let&#x27;s add up the costs to get the total cost for this transaction:</p><ul><li>First coin<ul><li>CLVM:             39 652</li><li>AGG_SIG_ME:    1 200 000</li><li>CREATE_COIN 1: 1 800 000</li><li>CREATE_COIN 2: 1 800 000 </li><li>Program size:  5 160 000</li></ul></li><li>Second coin<ul><li>CLVM:             15 032</li><li>AGG_SIG_ME:    1 200 000</li><li>Program size:  4 056 000</li></ul></li><li>Total:            15 270 684</li></ul><p>This is an accurate assessment of the cost for this particular transaction.</p><p>Just like before, we have to multiply the cost by five to obtain the minimum fee. In this case, the result is <code>5 * 15 270 684 = 76 353 420 mojos</code>. If this specific transaction had included a fee of at least that many mojos, it would&#x27;ve kicked a transaction with a lower fee out of the mempool in order to be included.</p><p>Now that you know <em>what</em> the cost of each CLVM operator is, as well as <em>how</em> to calculate costs, we&#x27;ll discuss <em>why</em> we decided to structure costs in this manner. It all begins with the minimum spec machine for farming, the humble Raspberry Pi 4.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="minimum-spec-machine-for-farming"></a>Minimum spec machine for farming<a class="hash-link" href="#minimum-spec-machine-for-farming" title="Direct link to heading">#</a></h2><p>The minimum spec machine to run a full node is the Raspberry Pi 4. How do we know if this machine can stay synced? The worst case scenario occurs when multiple full transaction blocks are created with the minimum amount of time between them. This will temporarily put maximum load on the system. If the Pi can stay synced in this scenario, then it easily should be able to stay synced under normal load.</p><p>The first question we must answer is how much time elapses between transaction blocks. Chia&#x27;s consensus mandates that at least three signage points must be reached before infusion_iterations may occur, so the minimum time between blocks is</p><p><code>3 signage points * signage point time</code>, which equals</p><p><code>3 signage points * (600 seconds per sub-slot / 64 signage points per sub-slot)</code>, which equals</p><p><code>3 signage points * 9.375 seconds per signage point</code>, which equals</p><p><code>28.125 seconds</code></p><blockquote><p>Note: The <strong>average</strong> time between transaction blocks is <a href="https://docs.chia.net/docs/03consensus/foliage#transaction-block-time" target="_blank" rel="noopener noreferrer">51.95 seconds</a>. The lower a given time interval between transaction blocks (down to 28.125 seconds), the lower the probability of a transaction block being created in that time interval.</p></blockquote><p>A transaction block is considered &quot;full&quot; when it contains 2000 outputs. For this document, we&#x27;ll assume this translates to 1000 vanilla transactions, each with two inputs and two outputs. This would give the network an average of 19.25 (1000/51.95) transactions per second.</p><blockquote><p>Note: A transaction with only one input and one output is also possible. In theory, a block could therefore hold up to 2000 transactions, in which case the network would process an average of 38.5 (2000/51.95) transactions per second.</p></blockquote><p>With this goal in mind, Chia has created a <strong>generator program</strong> that processes 2000 compressed inputs and outputs. This program simulates a &quot;full block&quot;.</p><p>To calculate the total amount of time for a Raspberry Pi 4 to process a full block, we must take into account three factors:</p><ul><li>The time required to run the generator program (2000 inputs and outputs)<ul><li>The Raspberry Pi 4 accomplishes this in 5.2 seconds</li></ul></li><li>The time required to validate 2000 public keys<ul><li>2.2 seconds</li></ul></li><li>The time required to validate 2000 aggregate signatures<ul><li>10.63 seconds</li></ul></li></ul><p>Therefore, the total amount of time required for a Raspberry Pi 4 to process a full block is 5.2 + 2.2 + 10.63 = 18.03 seconds. This is 10.095 seconds faster than the minimum time between blocks, and 33.92 seconds faster than the average. When considering other factors such as network latency and time required to fetch a full proof (<a href="https://docs.chia.net/docs/03consensus/proof-of-space#farming" target="_blank" rel="noopener noreferrer">640 ms on a slow HDD</a>), this still allows plenty of leeway for a Raspberry Pi 4 to stay synced and collect farming rewards.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="minimum-spec-machine-for-syncing"></a>Minimum spec machine for syncing<a class="hash-link" href="#minimum-spec-machine-for-syncing" title="Direct link to heading">#</a></h2><p>As a benchmark, we use the Raspberry Pi 4, Chia&#x27;s minimum spec machine for farming. A Raspberry Pi 4 has four cores, so it can validate a pre-existing block in 18.03 / 4 = 4.5075 seconds, which is around 11.5 times the average real-time rate of 51.95 seconds. Even in the worst-case scenario where every transaction block is full, the Pi can sync faster than the chain is being created.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="maximum-cost-per-block"></a>Maximum cost per block<a class="hash-link" href="#maximum-cost-per-block" title="Direct link to heading">#</a></h2><p>Now that we&#x27;ve established that a Raspberry Pi 4 can, indeed, sync and farm, even when every transaction block is full, we&#x27;ll calculate the maximum cost per block. </p><p>There are three categories that go into determining a block&#x27;s maximum cost:</p><ol><li>Generator program cost, which is split into two parts<ul><li>Execution cost</li><li>Signature validation cost</li></ul></li><li>Generator program size (each byte has a cost)</li><li>Generator program coins (each new coin has a cost)</li></ol><p>In the case of calculating the maximum cost, these three categories are to be given equal weight. We&#x27;ll go through each of the categories individually.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="generator-program-execution-cost"></a>Generator program execution cost<a class="hash-link" href="#generator-program-execution-cost" title="Direct link to heading">#</a></h4><p>(This is the first half of 1, above.)</p><p>An Intel Macbook Pro was used as a reference platform to determine baseline costs based on CPU usage. The costs were then hand-tweaked for various reasons:</p><ul><li>To ascribe additional cost to operations that allocate memory, i.e. the operand per-byte cost was inflated. This additional cost is called <code>MALLOC_PER_BYTE_COST</code> and amounts to 10 cost per byte.</li><li>The especially CPU intensive BLS operations (<code>point_add</code> and <code>pubkey_for_exp</code>) had their cost inflated to not differ too much from the Raspberry Pi 4.</li><li>Some operations that do not allocate memory and end up being common in relatively simple programs had their cost deflated. Specifically, <code>if</code>, <code>cons</code>, <code>listp</code>, <code>first</code>, and <code>rest</code>.</li></ul><p>The result is that the generator program has an execution cost of 1 317 054 957.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="generator-program-signature-validation-cost"></a>Generator program signature validation cost<a class="hash-link" href="#generator-program-signature-validation-cost" title="Direct link to heading">#</a></h4><p>(This is the second half of 1, above.)</p><p>The signature validation cost is based on computation time. BLS operations involve public key and aggregate signature validation, which are multiplied by the number of outputs.</p><ul><li>Time per public key validation: 0.179370 ms</li><li>Time per aggregate signature validation: 0.972140 ms</li><li>Total time for 2000 key and signature validations: (0.179370 + 0.972140) * 2000 = 2303.02 ms</li></ul><p>Each 1 cost is designed to require 1 nanosecond, so we need to multiply the result by 1 million (ns/ms).</p><ul><li>Cost for the generator program&#x27;s BLS operations: <code>2303.02 * 1 000 000 = 2 303 020 000</code>.</li></ul><p>Using this info, we can also calculate the cost of each <code>AGG_SIG_UNSAFE</code> and <code>AGG_SIG_ME</code> condition in all CLVM programs:</p><ul><li>Cost per BLS condition: <code>(0.179370 + 0.972140) * 1 000 000 = 1 151 510</code>. We round this number up to 1 200 000.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="generator-program-cost"></a>Generator program cost<a class="hash-link" href="#generator-program-cost" title="Direct link to heading">#</a></h3><p>(This is the total cost of 1, above.)</p><p>Taking the previous two calculations into account, the total cost to execute and run the BLS operations of the generator program is: <code>1 317 054 957 + 2 303 020 000 = 3 620 074 957</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="generator-program-size"></a>Generator program size<a class="hash-link" href="#generator-program-size" title="Direct link to heading">#</a></h3><p>(This is the cost of 2, above.)</p><p>We know that 1, 2, and 3 all will be assigned equal maximum costs, which we&#x27;ve already established is 3 620 074 957. This is the size-based cost of the generator program.</p><p>The generator program itself is 298 249 bytes. Each byte, therefore has a cost of <code>3 620 074 957 / 298 249 = 12 137.76</code>. We round this number to 12 000 per byte. This is the cost per bye of all CLVM programs.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="generator-program-coins"></a>Generator program coins<a class="hash-link" href="#generator-program-coins" title="Direct link to heading">#</a></h3><p>(This is the cost of 3, above.)</p><p>Just like the previous calculation, the total cost of the generator program&#x27;s coins is 3 620 074 957. The generator program creates 2000 coins, so the cost per <code>CREATE_COIN</code> in all CLVM programs is <code>3 620 074 957 / 2000 = 1 810 037.4785</code>. We round this number to 1 800 000.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="maximum-cost-per-block-1"></a>Maximum cost per block<a class="hash-link" href="#maximum-cost-per-block-1" title="Direct link to heading">#</a></h3><p>To calculate the maximum cost per block, we simply add the generator program&#x27;s execution, size, and coin costs:</p><p>Theoretical maximum cost per block: <code>3 620 074 957 + 3 620 074 957 + 3 620 074 957 = 10 860 224 871</code> We round this number to 11 000 000 000.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="maximum-block-size"></a>Maximum block size<a class="hash-link" href="#maximum-block-size" title="Direct link to heading">#</a></h3><p>The theoretical maximum size of a single block is <code>maximum cost per block / cost per byte</code>, or <code>11 000 000 000 / 12 000 = 916 667 bytes</code>. However, this number ignores the costs of all operators. If you want a CLVM program to do anything useful, the maximum size would be closer to 400 KB.</p><p>Even this number is not realistic because it assumes that a single program will take up an entire block. The maximum number of vanilla transactions (with two outputs) per block is 1000. Therefore, if there is fee pressure on Chia&#x27;s blockchain, a 400 KB program would need to include a larger fee than the top 1000 vanilla transactions in the mempool -- combined -- in order for a farmer to include it.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Chia-Network/chialisp-web/edit/main/docs/clvm/lang_reference.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/clvm/dive_into_clvm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Dive into CLVM</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/clvm/serialization"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CLVM Serialization Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#terminology" class="table-of-contents__link">Terminology</a></li><li><a href="#readable-assembly-format" class="table-of-contents__link">Readable assembly format</a></li><li><a href="#program-evaluation" class="table-of-contents__link">Program Evaluation</a></li><li><a href="#types" class="table-of-contents__link">Types</a><ul><li><a href="#atoms-as-byte-arrays" class="table-of-contents__link">Atoms as Byte Arrays</a></li><li><a href="#signed-integer" class="table-of-contents__link">Signed Integer</a></li><li><a href="#bls-point" class="table-of-contents__link">BLS Point</a></li></ul></li><li><a href="#treeargs--program-arguments-and-argument-lookup" class="table-of-contents__link">Treeargs : Program Arguments, and Argument Lookup</a><ul><li><a href="#illustration-of-argument-numbering" class="table-of-contents__link">Illustration of argument numbering</a></li></ul></li><li><a href="#quoting" class="table-of-contents__link">Quoting</a><ul><li><a href="#compilation-atom-syntax" class="table-of-contents__link">Compilation: Atom Syntax</a></li></ul></li><li><a href="#operators-are-atoms-too" class="table-of-contents__link">Operators are atoms too..</a></li><li><a href="#errors" class="table-of-contents__link">Errors</a></li><li><a href="#operator-summary" class="table-of-contents__link">Operator Summary</a><ul><li><a href="#the-built-in-opcodes" class="table-of-contents__link">The built-in opcodes</a></li><li><a href="#list-operators" class="table-of-contents__link">List Operators</a></li></ul></li><li><a href="#control-flow" class="table-of-contents__link">Control Flow</a></li><li><a href="#constants" class="table-of-contents__link">Constants</a></li><li><a href="#integer-operators" class="table-of-contents__link">Integer Operators</a><ul><li><a href="#rounding" class="table-of-contents__link">Rounding</a></li><li><a href="#division-of-negative-numbers" class="table-of-contents__link">Division of negative numbers</a></li><li><a href="#flooring-of-negative-numbers" class="table-of-contents__link">Flooring of negative numbers</a></li></ul></li><li><a href="#bit-operations" class="table-of-contents__link">Bit Operations</a></li><li><a href="#shifts" class="table-of-contents__link">Shifts</a></li><li><a href="#strings" class="table-of-contents__link">Strings</a></li><li><a href="#streaming-operators" class="table-of-contents__link">Streaming Operators</a></li><li><a href="#bls12-381-operators" class="table-of-contents__link">BLS12-381 operators</a></li><li><a href="#softfork" class="table-of-contents__link">softfork</a></li><li><a href="#arithmetic-and-bitwise-identities" class="table-of-contents__link">Arithmetic and Bitwise Identities</a></li><li><a href="#arithmetic" class="table-of-contents__link">Arithmetic</a><ul><li><a href="#behaviour-of-nil-when-used-as-an-integer" class="table-of-contents__link">Behaviour of nil when used as an integer</a></li><li><a href="#behaviour-of-zero-when-used-as-a-value-that-may-be-checked-for-nil" class="table-of-contents__link">Behaviour of zero when used as a value that may be checked for nil</a></li></ul></li><li><a href="#costs" class="table-of-contents__link">Costs</a><ul><li><a href="#cost-tables" class="table-of-contents__link">Cost tables</a></li><li><a href="#evaluating-cost-for-a-sample-brun-program" class="table-of-contents__link">Evaluating cost for a sample brun program</a></li><li><a href="#penalty-cost" class="table-of-contents__link">Penalty cost</a></li><li><a href="#evaluating-cost-for-a-typical-transaction" class="table-of-contents__link">Evaluating cost for a typical transaction</a></li><li><a href="#obtaining-transaction-info-from-a-wallet" class="table-of-contents__link">Obtaining transaction info from a wallet</a></li><li><a href="#obtaining-transaction-info-using-rpc-and-brun" class="table-of-contents__link">Obtaining transaction info using RPC and brun</a></li></ul></li><li><a href="#minimum-spec-machine-for-farming" class="table-of-contents__link">Minimum spec machine for farming</a></li><li><a href="#minimum-spec-machine-for-syncing" class="table-of-contents__link">Minimum spec machine for syncing</a></li><li><a href="#maximum-cost-per-block" class="table-of-contents__link">Maximum cost per block</a><ul><li><a href="#generator-program-cost" class="table-of-contents__link">Generator program cost</a></li><li><a href="#generator-program-size" class="table-of-contents__link">Generator program size</a></li><li><a href="#generator-program-coins" class="table-of-contents__link">Generator program coins</a></li><li><a href="#maximum-cost-per-block-1" class="table-of-contents__link">Maximum cost per block</a></li><li><a href="#maximum-block-size" class="table-of-contents__link">Maximum block size</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ref/clvm">CLVM Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://developers.chia.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Chia Developers Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://keybase.io/team/chia_network.public" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Keybase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/chia_project" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/Chia-Network/clvm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_SRtH" href="/"><img src="/img/full_logo_white.svg" alt="Chialisp full logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/full_logo_white.svg" alt="Chialisp full logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Â© 2022 Chia Network Inc., Licensed under the <a href="https://github.com/Chia-Network/chialisp-web/blob/main/LICENSE" target="_blank">Apache License, Version 2.0</a> | <a href="https://www.chia.net/terms">Terms</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.5582d1e8.js"></script>
<script src="/assets/js/main.4aa10653.js"></script>
</body>
</html>