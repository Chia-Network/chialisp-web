<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Dive into CLVM | Chialisp</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://chialisp.com/docs/clvm/dive_into_clvm"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Dive into CLVM | Chialisp"><meta data-react-helmet="true" name="description" content="This guide assumes knowledge of the basics of CLVM so if you haven&#x27;t read that, please do so before reading this."><meta data-react-helmet="true" property="og:description" content="This guide assumes knowledge of the basics of CLVM so if you haven&#x27;t read that, please do so before reading this."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chialisp.com/docs/clvm/dive_into_clvm"><link data-react-helmet="true" rel="alternate" href="https://chialisp.com/docs/clvm/dive_into_clvm" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://chialisp.com/docs/clvm/dive_into_clvm" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.35749df4.css">
<link rel="preload" href="/assets/js/runtime~main.5582d1e8.js" as="script">
<link rel="preload" href="/assets/js/main.3d802437.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Chialisp</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Chia.net<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/Chia-Network/chialisp-web" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Chialisp</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorials</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">CLVM</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clvm/basics">CLVM Basics</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/clvm/dive_into_clvm">Dive into CLVM</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clvm/lang_reference">CLVM Language Reference</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/clvm/serialization">CLVM Serialization</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/docs/resources">Resources</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Dive into CLVM</h1></header><p>This guide assumes knowledge of <a href="/docs/clvm/basics">the basics of CLVM</a> so if you haven&#x27;t read that, please do so before reading this.</p><p>This section of the guide will cover how Chialisp relates to transactions and coins on the Chia network.
If there are any terms that you aren&#x27;t sure of, be sure to check the <a href="/docs/glossary">glossary</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="lazy-evaluation-in-clvm"></a>Lazy Evaluation in CLVM<a class="hash-link" href="#lazy-evaluation-in-clvm" title="Direct link to heading">#</a></h2><p>As we&#x27;ve seen in earlier sections, programs are often structured around <code>(i A B C)</code> to control flow.
Chialisp evaluates programs as trees, where the leaves are evaluated first.
This can cause unexpected problems if you are not aware of it.
Consider the following program which uses <code>x</code> which immediately halts and throws an error if it is evaluated.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun &#x27;(i (q . 1) (q . 100) (x (q . &quot;still being evaluated&quot;)))&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">FAIL: clvm raise (0x7374696c6c206265696e67206576616c7561746564)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This is because Chialisp evaluates both of the leaves even though it will only follow the path of one.</p><p>To get around this we can use the following design pattern to replace (i A B C).</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(a (i (A) (q . B) (q . C)) 1)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Applying this to our above example looks like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun &#x27;(a (i (q . 1) (q . (q . 100)) (q . (x (q . &quot;still being evaluated&quot;)))) 1)&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">100</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>It is worth keeping this in mind whenever you write an <code>(i A B C)</code>.</p><p>If you&#x27;re wondering how this works (and how the <a href="/docs/coins_spends_and_wallets#example-signature-locked-coin">signature locked coin</a> from before worked), then allow me to introduce Evaluate.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="introduction-to-evaluate"></a>Introduction to Evaluate<a class="hash-link" href="#introduction-to-evaluate" title="Direct link to heading">#</a></h2><p>In <a href="/docs/">the introduction to CLVM</a> we mentioned that a program is usually a list where the first element is an operator, and every subsequent element is a valid program.
We can also run programs with new arguments inside a program.</p><p>This looks like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(a *puzzle* *solution*)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Let&#x27;s put this into practice.</p><p>Here is a program that evaluates the program <code>(+ 2 (q . 5)))</code> and uses the list <code>(70 80 90)</code> or <code>(80 90 100)</code> as the solution.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun &#x27;(a (q . (+ 2 (q . 5))) (q . (70 80 90)))&#x27; &#x27;(20 30 40)&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">75</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun &#x27;(a (q . (+ 2 (q . 5))) (q . (80 90 100)))&#x27; &#x27;(20 30 40)&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">85</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Notice how the original solution <code>(20 30 40)</code> does not matter for the new evaluation environment.
In this example we use <code>q . </code> to quote both the new puzzle and the new solution to prevent them from being prematurely evaluated.</p><p>A neat trick that we can pull is that we can define the new solution in terms of the outer solution.
In this next example we will add the first element of the old solution to our new solution.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun &#x27;(a (q . (+ 2 (q . 5))) (c 2 (q . (70 80 90))))&#x27; &#x27;(20 30 40)&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">25</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>However it&#x27;s not just the new solution that we can affect using this, we can also pass programs as parameters.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="programs-as-parameters"></a>Programs as Parameters<a class="hash-link" href="#programs-as-parameters" title="Direct link to heading">#</a></h2><p>The core CLVM does not have an operator for creating user defined functions.
It does, however, allow programs to be passed as parameters, which can be used for similar results.</p><p>Here is a puzzle that executes the program contained in <code>2</code> (the first solution argument) with the solution <code>(12)</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun &#x27;(a 2 (q . (12)))&#x27; &#x27;((* 2 (q . 2)))&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">24</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Taking this further we can make the puzzle run a new evaluation that only uses parameters from its old solution:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI chialisp"><pre tabindex="0" class="prism-code language-chialisp codeBlock_rtdJ thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun &#x27;(a 2 1)&#x27; &#x27;((* 5 (q . 2)) 10)&#x27;</span></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">20</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>We can use this technique to implement recursive programs.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Chia-Network/chialisp-web/edit/main/docs/clvm/dive_into_clvm.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/clvm/basics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« CLVM Basics</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/clvm/lang_reference"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CLVM Language Reference Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lazy-evaluation-in-clvm" class="table-of-contents__link">Lazy Evaluation in CLVM</a></li><li><a href="#introduction-to-evaluate" class="table-of-contents__link">Introduction to Evaluate</a></li><li><a href="#programs-as-parameters" class="table-of-contents__link">Programs as Parameters</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ref/clvm">CLVM Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://developers.chia.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Chia Developers Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://keybase.io/team/chia_network.public" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Keybase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/chia_project" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/Chia-Network/clvm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_SRtH" href="/"><img src="/img/full_logo_white.svg" alt="Chialisp full logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/full_logo_white.svg" alt="Chialisp full logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Â© 2022 Chia Network Inc., Licensed under the <a href="https://github.com/Chia-Network/chialisp-web/blob/main/LICENSE" target="_blank">Apache License, Version 2.0</a> | <a href="https://www.chia.net/terms">Terms</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.5582d1e8.js"></script>
<script src="/assets/js/main.3d802437.js"></script>
</body>
</html>