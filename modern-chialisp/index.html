<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-modern-chialisp" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Modern Chialisp | Chialisp</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://chialisp.com/modern-chialisp/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Modern Chialisp | Chialisp"><meta data-rh="true" name="description" content="Chialisp can evolve over time and still serve its role in preserving the"><meta data-rh="true" property="og:description" content="Chialisp can evolve over time and still serve its role in preserving the"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://chialisp.com/modern-chialisp/"><link data-rh="true" rel="alternate" href="https://chialisp.com/modern-chialisp/" hreflang="en"><link data-rh="true" rel="alternate" href="https://chialisp.com/modern-chialisp/" hreflang="x-default"><script src="/js/matomo.js" async defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.69584788.css">
<script src="/assets/js/runtime~main.02399fb9.js" defer="defer"></script>
<script src="/assets/js/main.eb31d298.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Chialisp</b></a><a href="https://docs.chia.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://docs.chia.net/academy-home/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia Academy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia.net<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/Chia-Network/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/chialisp-primer/">Chialisp Primer</a><button aria-label="Expand sidebar category &#x27;Chialisp Primer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/chialisp-concepts/">Chialisp Concepts</a><button aria-label="Expand sidebar category &#x27;Chialisp Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/commands/">Commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/syntax/">Syntax</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/modern-chialisp/">Modern Chialisp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operators/">Operators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/examples/">Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/costs/">Costs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/conditions/">Conditions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/optimization/">Optimization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/common_issues/">Common Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/debugging/">Debugging</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/standard-transactions/">Primitives</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/clvm/">CLVM</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Modern Chialisp</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Modern chialisp</h1></header>
<p>Chialisp can evolve over time and still serve its role in preserving the
representation of older programs in previous iterations of the language by using
a sigil to indicate what tooling version the program was finalized in. The
current sigil is <code>*standard-cl-23*</code>. Use an &#x27;include&#x27; form to set the
tooling version. Chialisp has a lot of new features which make programs easier
to understand, read and write. The speed of its optimizer has been improved to
allow faster iteration and several features make chialisp safer. Undefined
variables are no longer treated as values, and return diagnostics instead. Let
bindings and related assign forms allow programs to be structured more logically
and preprocessing is now a separate pass that can be inspected on its own.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="description-of-the-new-language">Description of the new language<a href="#description-of-the-new-language" class="hash-link" aria-label="Direct link to Description of the new language" title="Direct link to Description of the new language">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="an-example-of-modern-chialisp-exercising-many-of-the-new-features">An example of modern chialisp exercising many of the new features:<a href="#an-example-of-modern-chialisp-exercising-many-of-the-new-features" class="hash-link" aria-label="Direct link to An example of modern chialisp exercising many of the new features:" title="Direct link to An example of modern chialisp exercising many of the new features:">​</a></h3>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; Specify that this program is compiled with *standard-cl-23*.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; After release, the chialisp compiler guarantees that programs</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; with a specific sigil (including no sigil) compile to the</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; same representation forever (it is a bug that must be fixed</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; if a program changes representation in a future compiler</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; release).  In this way, program source code can also provide</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; enough information to re-produce a puzzle hash from source</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; code.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; Normal functions are now allowed to be called from macros.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; When run in macro space, they can used special forms to detect</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; what language level tokens are given (to differentiate identifiers</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; and constants and the like).  Functions can be used both by the</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; deployed program and macros or just either.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun n-additions-inner (n value idx)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if (&gt; idx n)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (qq (c (+ (unquote idx) (unquote value)) (unquote (n-additions-inner n value (+ 1 idx)))))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; The new &#x27;defmac&#x27; keyword defines a modern macro.  They&#x27;re like</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; the prior macro system but can&#x27;t rely on their own definition</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; or anything lexically after themselves (like in the C preprocessor).</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; You can view the preprocessor expansion of a program before it&#x27;s</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; handed to the compiler proper using the -E switch.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defmac n-additions (n value) (n-additions-inner n value 1))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun F (X) (n-additions 3 X))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun odd (X) (logand X 1))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; Usual higher order functions work like you might hope.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; This filter function takes a predicate, &quot;pred&quot;, which</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; returns a truthy value to include the result or nil.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; (@ lst (first . rest)) is similar to a similar </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; destructuring form in haskell.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; (@ lst (first . rest))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; generates the same bindings as simultaneously having</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; (pred lst)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; and</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; (pred (first . rest))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; as an argument list.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun filter (pred (@ lst (first . rest)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if lst</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if (a pred (list first))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c first (filter pred rest))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (filter pred rest)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; @ destructuring here takes the place of the</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; whole argument list.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun sum (@ the-list (first . rest))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if the-list</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (+ first (a sum rest))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      0</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; We can destructure the result based on its shape.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; Assign reorders and groups assignments based on their dependencies.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (A B C) result-list</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; The bindings can be in any order, like the let forms in elm, haskell</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; and others.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    result-list (F X)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    summed (a sum result-list)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; We can name &#x27;sum&#x27; as a predicate.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    odds (filter odd result-list)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; Result of this form.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (list summed odds)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="complete-list-of-new-features">Complete list of new features<a href="#complete-list-of-new-features" class="hash-link" aria-label="Direct link to Complete list of new features" title="Direct link to Complete list of new features">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="defconst-constants">defconst constants<a href="#defconst-constants" class="hash-link" aria-label="Direct link to defconst constants" title="Direct link to defconst constants">​</a></h3>
<p>The new defconst form has access to the program surrounding it at compile time.
The value that results is computed at compile time (and causes an error if that
isn&#x27;t possible for some reason, such as it depends on its own constant, causes
a clvm exception or some other problem) and the compiler chooses the smaller
representation of inlining it or placing it in the environment.</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ; takes a lisp tree and returns the hash of it</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun sha256tree1 (TREE)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if (l TREE)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (sha256 2 (sha256tree1 (f TREE)) (sha256tree1 (r TREE)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (sha256 1 TREE)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconst HELLO_HASH (sha256tree1 (c &quot;hello&quot; &quot;world&quot;)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (sha256 HELLO_HASH Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun defconsthash.clvm &#x27;(3)&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">0xf60efb25b9e6e3587acd9cf01c332707bb771801bdb5e4f50ea957a29c8dde89</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ opc -H &#x27;(hello . world)&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">9d1890eef772e63013f481b4313eeaae7de4b0601268f380124ad1d74d694d15</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun &#x27;(sha256 (q . 0x9d1890eef772e63013f481b4313eeaae7de4b0601268f380124ad1d74d694d15) (q . 3))&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">0xf60efb25b9e6e3587acd9cf01c332707bb771801bdb5e4f50ea957a29c8dde89</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="let-let-and-assign-forms"><code>let</code>, <code>let*</code> and <code>assign</code> forms<a href="#let-let-and-assign-forms" class="hash-link" aria-label="Direct link to let-let-and-assign-forms" title="Direct link to let-let-and-assign-forms">​</a></h3>
<p>Chialisp now has local bindings that allow code to be more organized, to use the
same computation more than once without having to explicitly write and call a
separate function to capture the value into a CLVM environment that can be
extracted via variable reference. The bound variables can be referenced in the
body. let and let* forms are classic lisp and scheme, and allow just a name to
be bound from an expression. <code>let</code> performs all bindings at the same time
(they don&#x27;t have access to each other) and the other form of let allows each
one to access the values bound before it.  <code>assign</code> can handle any arrangement
of bindings as long as they don&#x27;t form a cycle.</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (let ((X (+ Z 1))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (Y (- Z 1)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (* X Y)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun simple-let.clvm &#x27;(5)&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">24</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="at-capture">at capture<a href="#at-capture" class="hash-link" aria-label="Direct link to at capture" title="Direct link to at capture">​</a></h3>
<p>Chialisp supports overlapping variable bindings in which one gives a name to a
collection of further destructuring.</p>
<p>In haskell, it&#x27;s possible to bind both a container and its contents:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">data Pt = Pt Int Int deriving Show</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">f p@(Pt x y) = if x == 0 then p else Pt (x - 1) y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Scheme and lisp argument destructuring can stand in for destructuring objects.
In the above case, we can refer to the object&#x27;s fields separately and the object
itself if we just want to pass it on whole or return it.</p>
<p>You can also use this to simulate Maybe or Options type in a convenient way.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">&gt; f p = fromMaybe 0 $ (\(Pt x y) -&gt; x + y) &lt;$&gt; p</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">&gt; f (Just (Pt 3 5))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">8</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">&gt; f Nothing</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In chialisp:</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (p) </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*) </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun F ((@ p (x y))) (if p (+ x y) 0)) </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (F p)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun maybe.clvm &#x27;((3 5))&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">8</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun maybe.clvm &#x27;(())&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can also do this with a higher order functions similarly.  In this
implementation, maybe is always a list so that (Just 0) is distinct from
Nothing.  This is longer but more general.  If used to construct fully
generic algorithms, it might be needed.</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (p)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun fromMaybe (v (@ m (content))) (if m content v))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun mapMaybe (f (@ m (content))) (if m (list (a f (list content))) ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (fromMaybe 0 (mapMaybe (lambda ((@ pt (x y))) (+ x y)) p))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun maybe.clvm &#x27;(((3 5)))&#x27; # Note: ((3 5)) is like (Some (Pt 3 5))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">8</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun maybe.clvm &#x27;(())&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="function-closures">Function closures<a href="#function-closures" class="hash-link" aria-label="Direct link to Function closures" title="Direct link to Function closures">​</a></h3>
<p>Chialisp allows function names to be treated as closures when used as values.
The resulting function is callable with the &#x27;a&#x27; operator in the way other
foreign code would be when passed into your program or as a result of a lambda
expression.</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">   </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun add-one (X) (+ X 1))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun map (F L)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if L</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (c (a F (list (f L))) (map F (r L)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (map add-one Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun map.clvm &#x27;((1 2 3))&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(a 3 4)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lambda-forms">lambda forms<a href="#lambda-forms" class="hash-link" aria-label="Direct link to lambda forms" title="Direct link to lambda forms">​</a></h3>
<p>Chialisp supports &#x27;lambda&#x27; in a similar way to scheme.  The resulting value is
callable with the &#x27;a&#x27; operator, has access to the program&#x27;s functions and constants
and is in general safe to use for higher-order functions.</p>
<p>The above program could be re-stated as:</p>
<p>(mod (Z)</p>
<p>(include <em>standard-cl-23</em>)</p>
<p>(defun map (F L)
(if L
(c (a F (list (f L))) (map F (r L)))
()
)
)</p>
<p>(map (lambda (Y) (+ Y 1)) Z)
)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="embed-and-compile-include-forms">embed and compile include forms<a href="#embed-and-compile-include-forms" class="hash-link" aria-label="Direct link to embed and compile include forms" title="Direct link to embed and compile include forms">​</a></h3>
<p>Chialisp programs often need to know the hashes or contents of other programs
and other data and it can be inconvenient to translate it into chialisp source
code (especially if, during development it changes).</p>
<p>Chialisp now gives the ability to embed foreign data, including compiling
programs and embedding their compiled representation.  Since chialisp programs
contain identification about how they should be compiled, it&#x27;s possible to
include programs from different versions of the language accurately.</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (embed-file hello-data bin &quot;hello.txt&quot;)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (sha256 hello-data Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ xxd hello.txt</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">00000000: 6865 6c6c 6f0a                           hello.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ ./target/debug/brun embedhello.clvm &#x27;(world)&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">0x26c60a61d01db5836ca70fefd44a6a016620413c8ef5f259a6c5612d4f79d3b8</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ ./target/debug/brun &#x27;(sha256 (q . 0x68656c6c6f0a) (q . world))&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">0x26c60a61d01db5836ca70fefd44a6a016620413c8ef5f259a6c5612d4f79d3b8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="trace-output-via-cldb">trace output via cldb<a href="#trace-output-via-cldb" class="hash-link" aria-label="Direct link to trace output via cldb" title="Direct link to trace output via cldb">​</a></h3>
<p>The cldb debugger now recognizes a specific clvm expression as indicating a
desire for diagnostic output.  One way to generate it is with a function like</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun print (l x) (i (all &quot;$print$&quot; l x) x x))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can use this in your programs to determine what values have been computed
without stopping execution while the program runs:</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun print (l x) (i (all &quot;$print$&quot; l x) x x))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun C (N X) (if (&gt; 2 (print (list &quot;collatz&quot; N) X)) N (let ((NP1 (+ N 1))) (if (logand 1 X) (C NP1 (+ 1 (* 3 X))) (C NP1 (/ X 2))))))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (C 0 X)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ ./target/debug/cldb -p c.clsp &#x27;(3)&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">---</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">- Print: ((collatz ()) 3)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">- Print: ((collatz 1) 10)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">- Print: ((collatz 2) 5)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">- Print: ((collatz 3) 16)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">- Print: ((collatz 4) 8)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">- Print: ((collatz 5) 4)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">- Print: ((collatz 6) 2)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">- Print: ((collatz 7) 1)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">- Final: &quot;7&quot;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  Final-Location: &quot;c.clsp(6):50&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="defmac-and-full-preprocessing">defmac and full preprocessing<a href="#defmac-and-full-preprocessing" class="hash-link" aria-label="Direct link to defmac and full preprocessing" title="Direct link to defmac and full preprocessing">​</a></h3>
<p>Preprocessing takes place separately from compilation in modern chialisp.  This
allows easier debugging of macros, allowing the user to view the preprocessor
output and check that generated code is correct, but also separating preprocessing
from CLVM and allowing a greater range of value distinction.  The preprocessor
is running code from the chialisp language, but it operates on values that include
programmer relevant distinctions such as &quot;symbol&quot;, &quot;string&quot; and &quot;number&quot; as in
scheme.  The preprocessor can therefore both act differently based on what
syntactic inputs its presented with and it can also preserve and pass on those
distinctions.  It&#x27;s necessary to move the preprocessor out of a pure CLVM to be
able to surface errors about misspelled and unbound identifiers.</p>
<p>Chialisp can do a lot with macros.  Just two are builtin because they&#x27;re useful
for building other macros, &#x27;if&#x27; and &#x27;list&#x27;.  I&#x27;ll discuss these later in context
because they require knowing a bit about CLVM.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-and-macro">Example: &#x27;and&#x27; macro<a href="#example-and-macro" class="hash-link" aria-label="Direct link to Example: &#x27;and&#x27; macro" title="Direct link to Example: &#x27;and&#x27; macro">​</a></h4>
<p>We can start with an example of a short-circuiting &#x27;and&#x27; operator.  In other
versions of lisp and scheme, this operator lets you line up conditions that
depend on each other to keep from having runtime errors.</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun and_ (CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if (r CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (qq (if (unquote (f CLAUSES)) (unquote (and_ (r CLAUSES))) ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (f CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defmac and CLAUSES (if CLAUSES (and_ CLAUSES) 1))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (and X (r X) (f (r X)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This works nicely:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ run strict-and.clsp &gt; strict-and.clvm</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun strict-and.clvm &#x27;((1))&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun strict-and.clvm &#x27;((1 2 3))&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can check what this macro unrolls to:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ run -E strict-and.clsp</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X) (include *standard-cl-23*) (a (i X (com (a (i (r X) (com (f (r X))) (com ())) @)) (com ())) @))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can format it nicely:</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (a (i X</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (com</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (a (i (r X)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (com (f (r X)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (com ())</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ) @)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (com ())</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ) @)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Below I&#x27;ll discuss what happened to &#x27;if&#x27; (it&#x27;s a macro itself in this language).
For now, you can think of (a (i X (com Y) (com Z)) @) as a weird way of saying
&#x27;(if X Y Z)&#x27;.</p>
<p>But what we can see here is:</p>
<ul>
<li>First the check of X<!-- -->
<ul>
<li>Then in the true case, a check of (r X)<!-- -->
<ul>
<li>Then in the true case, return (f (r X))</li>
<li>Else ()</li>
</ul>
</li>
<li>Else ()</li>
</ul>
</li>
</ul>
<p>Which is just what we want for short-circuiting &#x27;and&#x27; in a lisp like language.
Looking again at the central function of the &#x27;and&#x27; macro:</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun and_ (CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if (r CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (qq (if (unquote (f CLAUSES)) (unquote (and_ (r CLAUSES))) ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (f CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>One can see that the &#x27;if&#x27; it expands to is:</p>
<p><code>(if (unquote (f CLAUSES)) (unquote (and_ (r CLAUSES))) ())</code></p>
<p>Which will cause code for the remaining and_ clauses to run if the first one
was truthy.  and_ is recursive so it&#x27;ll make a left-heavy tree for any number
of checks we want to proceed the final result.  Each &#x27;if&#x27; form emitted by and_
returns nil if its check was false, protecting the remaining ones from running.</p>
<p>We can break down how to develop chialisp macros.  Let&#x27;s say we want to make &#x27;or&#x27;
which returns the first truthy item from a set of input arguments.</p>
<p>We can start with a simple check:</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X Y Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defmac or CLAUSES &quot;hi from or&quot;)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (or X Y Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ run -E or-test.clsp</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X Y Z) (include *standard-cl-23*) &quot;hi from or&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And expand on it:</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X Y Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun or_ (CLAUSES) &quot;hi from or&quot;)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defmac or CLAUSES (if CLAUSES (or_ CLAUSES) ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (c (or) (or X Y Z))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ run -E or-test.clsp</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X Y Z) (include *standard-cl-23*) (c () &quot;hi from or&quot;))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then decide how &#x27;or&#x27; should work:</p>
<ul>
<li>if there&#x27;s one item left, then just return it.</li>
<li>if the first item is truthy, return it.</li>
<li>otherwise return (or ...) of the rest.</li>
</ul>
<p>Note that CLAUSES is chialisp code the user put in the actual &#x27;or&#x27; form, not
the results themselves.</p>
<p>The <code>(qq ...)</code> form is useful for writing what you&#x27;d write in chialisp and
having your macro produce that.  It quotes the code you write so that identifiers
pass through and are interpreted by the compiler after the macro is expanded.
The special &#x27;unquote&#x27; form, causes whatever&#x27;s inside it to be pasted into the
quoted code.  It makes for fairly understandable macros.</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X Y Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun or_ (CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if (r CLAUSES) ;; There are more.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      ;; Mistake: qq is missing.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if (unquote (f CLAUSES)) (unquote (f CLAUSES)) (unquote (or_ (r CLAUSES))))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (f CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defmac or CLAUSES (if CLAUSES (or_ CLAUSES) ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (or X Y Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">or-test1.clsp(7):12-or-test1.clsp(7):19: no such callable &#x27;unquote&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So we fix that :-)</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X Y Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun or_ (CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if (r CLAUSES) ;; There are more.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (qq (if (unquote (f CLAUSES)) (unquote (f CLAUSES)) (unquote (or_ (r CLAUSES)))))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (f CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defmac or CLAUSES (if CLAUSES (or_ CLAUSES) ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (or X Y Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ run -E or-test.clsp</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X Y Z) (include *standard-cl-23*) (a (i X (com X) (com (a (i Y (com Y) (com Z)) @))) @))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So this output:</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (X Y Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (a (i X</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (com X)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (com (a (i Y</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (com Y)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (com Z)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      ) @))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ) @)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If X is true then return X, otherwise if Y is true then return Y, else Z.</p>
<p>We can try it:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ run or-test.clsp &gt; or-test.clvm</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ $ brun or-test.clvm &#x27;(1 0 0)&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">1</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun or-test.clvm &#x27;(0 3 7)&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">3</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun or-test.clvm &#x27;(0 0 7)&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">7</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">$ brun or-test.clvm &#x27;(0 0 0)&#x27;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These macros are used together in the ported rosetta code &#x27;ABC&#x27; example later.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="if-and-list-macros">&#x27;if&#x27; and &#x27;list&#x27; macros<a href="#if-and-list-macros" class="hash-link" aria-label="Direct link to &#x27;if&#x27; and &#x27;list&#x27; macros" title="Direct link to &#x27;if&#x27; and &#x27;list&#x27; macros">​</a></h4>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (defmac if (A B C)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              (qq (a (i (unquote A) (com (unquote B)) (com (unquote C))) @))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Which expands <code>(if X Y Z)</code> to</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(a (i X (com Y) (com Z)) @))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>&#x27;com&#x27; is a special form in the chialisp compiler that outputs the code that
does what its argument does, in the context where it&#x27;s expanded.  Because
chialisp&#x27;s &#x27;a&#x27; operator can run a CLVM value as code, this allows execution
to be passed down to one of two alternatives, based on whether X is truthy.
The &#x27;i&#x27; operator returns one of its second or third argument based on the
truthiness of its first.</p>
<p>So the &#x27;if&#x27; macro has turned a high level concept &#x27;if&#x27; into something that,
with some language support, outputs chialisp that&#x27;s completely made up of
primitive operators from CLVM.</p>
<p>The &#x27;list&#x27; macro is similar:</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (defun __chia__compile-list (args)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              (if args</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                (c 4 (c (f args) (c (__chia__compile-list (r args)) ())))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (defmac list ARGS (__chia__compile-list ARGS))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Which expands <code>(list X Y Z)</code> to</p>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(4 X (4 Y (4 Z ())))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Turning the list again into chialisp that uses CLVM operators in a more
primitive way.  This allows chialisp developers to turn high level ideas into
code that&#x27;s frugal at the CLVM level.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="complete-example-abc-problem">Complete example: ABC problem<a href="#complete-example-abc-problem" class="hash-link" aria-label="Direct link to Complete example: ABC problem" title="Direct link to Complete example: ABC problem">​</a></h2>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">;; Adapted from https://rosettacode.org/wiki/ABC_problem#Scheme</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (word)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconst *blocks*</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (list</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (c &quot;B&quot; &quot;O&quot;) (c &quot;X&quot; &quot;K&quot;) (c &quot;D&quot; &quot;Q&quot;) (c &quot;C&quot; &quot;P&quot;) (c &quot;N&quot; &quot;A&quot;)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (c &quot;G&quot; &quot;T&quot;) (c &quot;R&quot; &quot;E&quot;) (c &quot;T&quot; &quot;G&quot;) (c &quot;Q&quot; &quot;D&quot;) (c &quot;F&quot; &quot;S&quot;)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (c &quot;J&quot; &quot;W&quot;) (c &quot;H&quot; &quot;U&quot;) (c &quot;V&quot; &quot;I&quot;) (c &quot;A&quot; &quot;N&quot;) (c &quot;O&quot; &quot;B&quot;)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (c &quot;E&quot; &quot;R&quot;) (c &quot;F&quot; &quot;S&quot;) (c &quot;L&quot; &quot;Y&quot;) (c &quot;P&quot; &quot;C&quot;) (c &quot;Z&quot; &quot;M&quot;)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline block-member (e s)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (logior (= e (f s)) (= e (r s)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; Make short-circuiting and.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun and_ (CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if (r CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (qq (if (unquote (f CLAUSES)) (unquote (and_ (r CLAUSES))) ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (f CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; Chialisp doesn&#x27;t natively have &#x27;and&#x27; and &#x27;or&#x27;.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; These macros rewrite (and x y z) ... to (if x (if y (if z 1) ()) ())</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; ensuring that y and z execute only if x was true etc.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; &#x27;or&#x27; stops evaluating if it gets a true result, otherwise continuing.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defmac and CLAUSES (if CLAUSES (and_ CLAUSES) 1))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; Make short-circuiting or.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun or_ (CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if (r CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (qq (if (unquote (f CLAUSES)) 1 (unquote (or_ (r CLAUSES)))))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (f CLAUSES)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defmac or CLAUSES (if CLAUSES (or_ CLAUSES) ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; Demonstrates use of higher order functions at call sites.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; CLVM uses the apply operator with an argument list, so</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; when functions exist as values, they can be called</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; interoperably with foreign code this way.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; ;; p? is a function.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; (a p? (list (f li)) ;; the same as (p? (f li)) if</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;;                     ;; p? were a defun.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun exists (p? li)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (and li (or (a p? (list (f li))) (exists p? (r li))))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun remove-one (x li)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (or</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (not li)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if (and (= (f (f li)) (f x)) (= (r (f li)) (r x)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (r li)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c (f li) (remove-one x (r li)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun can-make-list? (li blocks)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (or</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (not li)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (exists</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ;; Lambdas now work as one would expect.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ;; The capture spec (the (&amp; ...) part is similar to</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ;; C++&#x27; lambda syntax and it should intuitively reflect</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ;; the cost of the environment capture that the lambda</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ;; carries off.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (lambda ((&amp; li blocks) block)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (and</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (block-member (f li) block)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (can-make-list? (r li) (remove-one block blocks))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        blocks</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun can-make-word? (word) (can-make-list? word *blocks*))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun wordify (W)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if W</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (c (substr W 0 1) (wordify (substr W 1)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (can-make-word? (wordify word))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="complete-example-babbage-problem">Complete example: Babbage problem<a href="#complete-example-babbage-problem" class="hash-link" aria-label="Direct link to Complete example: Babbage problem" title="Direct link to Complete example: Babbage problem">​</a></h2>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">;; Adapted from: https://rosettacode.org/wiki/Babbage_problem#Scheme</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (N)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun digits_ (result n)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; The new assign form allows destructuring assignment.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; the clvm divmod instruction returns a pair of (dividend . remainder)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; we can use &#x27;assign&#x27; to provide &#x27;d&#x27; and &#x27;r&#x27; bindings for the two halves</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; of the result expression.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; Assign can have any number of assignments (they&#x27;re given as pairs of</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; a binding form and an expression).  The assign form is finished with</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; a body expression which gives the result.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (d . r) (divmod n 10)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if d</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (digits_ (c r result) d)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c r result)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun digits (n) (if n (digits_ () n) ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun reverse_ (result lst)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if lst</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (reverse_ (c (f lst) result) (r lst))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      result</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun reverse (lst) (reverse_ () lst))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun starts-with (lst prefix)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if prefix</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if lst</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (if (= (f prefix) (f lst))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (starts-with (r lst) (r prefix))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      1</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun ends-with (lst tail)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; does list end with tail?</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (starts-with (reverse lst) (reverse tail))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun loop (start fun)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; We can use a let binding to give a name to the result.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (let ((res (a fun (list start))))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if res</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (f res)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (loop (+ 1 start) fun)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (loop 1</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; The loop function calls this inner function to return either a</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; wrapped result or nil.  N is captured from the environment where</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    ;; the lambda originates from.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (lambda ((&amp; N) idx)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if (ends-with (digits (* idx idx)) (digits N))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (list idx)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="complete-example-avl-tree">Complete Example: AVL Tree<a href="#complete-example-avl-tree" class="hash-link" aria-label="Direct link to Complete Example: AVL Tree" title="Direct link to Complete Example: AVL Tree">​</a></h2>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">;; Port of a verified AVL tree in haskell and agda from:</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">;; https://doisinkidney.com/posts/2018-07-30-verified-avl.html</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">;;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">;; Given an AVL tree representation and a key and value to add, return</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">;; the new tree.</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (tree k v)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant LB 0)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant IB 1)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant UB 2)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant LT -1)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant EQ 0)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant GT 1)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline new_Key (k) k)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline new_Bound (bound key) (c bound key))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconst lb (new_Bound LB ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun ib (k) (new_Bound IB k))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconst ub (new_Bound UB ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant BalanceL -1)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant BalanceO 0)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant BalanceR 1)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline max (a b) (if (&gt; a b) a b))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline new_Balance (bt) bt)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_Balance_bt (b) b)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline balr (b)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (new_Balance</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (= (get_Balance_bt b) BalanceR)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          BalanceL</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          BalanceO</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline ball (b)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (new_Balance</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (= (get_Balance_bt b) BalanceL)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        BalanceL</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        BalanceO</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant Stay 0)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant Incr 1)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline new_Rebalance (rt tree) (c rt tree))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_Rebalance_rt ((@ r (rt . tree))) rt)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_Rebalance_tree ((@ r (rt . tree))) tree)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline new_Node (key value balance left right) (list key value balance left right))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_Node_key ((@ n (key value balance left right))) key)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_Node_value ((@ n (key value balance left right))) value)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_Node_balance ((@ n (key value balance left right))) balance)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_Node_left ((@ n (key value balance left right))) left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_Node_right ((@ n (key value balance left right))) right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline rotr-l (x xv left cnode)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      y (get_Node_key left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      yv (get_Node_value left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      anode (get_Node_left left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      bnode (get_Node_right left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (new_Rebalance Stay (new_Node y yv (new_Balance BalanceO) anode (new_Node x xv (new_Balance BalanceO) bnode cnode)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline rotr-o (x xv left c)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      y (get_Node_key left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      yv (get_Node_value left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      a (get_Node_left left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      b (get_Node_right left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (new_Rebalance Incr (new_Node y yv (new_Balance BalanceR) a (new_Node x xv (new_Balance BalanceL) b c)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline rotr-r (x xv left d)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      y (get_Node_key left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      yv (get_Node_value left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      a (get_Node_left left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      left_right (get_Node_right left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      z (get_Node_key left_right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      zv (get_Node_value left_right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      bl (get_Node_balance left_right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      b (get_Node_left left_right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      c (get_Node_right left_right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (new_Rebalance Stay</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (new_Node z zv</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (new_Balance BalanceO)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (new_Node z zv (balr bl) a b)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (new_Node x xv (ball bl) c d)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun rotr (x xv left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      balance (get_Node_balance left)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      bt (get_Balance_bt balance)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if (= bt BalanceO)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (rotr-o x xv left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (if (= bt BalanceL)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (rotr-l x xv left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (rotr-r x xv left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline rotl-o (x xv left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      y (get_Node_key right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      yv (get_Node_value right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      b (get_Node_left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      a (get_Node_right right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (new_Rebalance Incr (new_Node y yv (new_Balance BalanceL) (new_Node x xv (new_Balance BalanceR) left b) a))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline rotl-r (x xv left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      y (get_Node_key right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      yv (get_Node_value right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      b (get_Node_left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      a (get_Node_right right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (new_Rebalance Stay (new_Node y yv (new_Balance BalanceO) (new_Node x xv (new_Balance BalanceO) left b) a))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline rotl-l (x xv left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      y (get_Node_key right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      yv (get_Node_value right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      left_right (get_Node_left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      a (get_Node_right right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      z (get_Node_key left_right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      zv (get_Node_value left_right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      bl (get_Node_balance left_right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      c (get_Node_left left_right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      b (get_Node_right left_right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (new_Rebalance Stay (new_Node z zv (new_Balance BalanceO) (new_Node x xv (balr bl) left c) (new_Node y yv (ball bl) b a)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun rotl (x xv left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      balance (get_Node_balance right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      bt (get_Balance_bt balance)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if (= bt BalanceO)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (rotl-o x xv left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (if (= bt BalanceR)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (rotl-r x xv left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (rotl-l x xv left right)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun insert-with-leaf (k v)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (new_Rebalance Incr (new_Node k v (new_Balance BalanceO) () ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun insert-with-node-lt (k kc bl bt tr iw)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign-lambda</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      rt (get_Rebalance_rt iw)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      tl_prime (get_Rebalance_tree iw)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if (= rt Stay)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (new_Rebalance Stay (new_Node k kc bl tl_prime tr))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (if (= bt BalanceL)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (rotr k kc tl_prime tr)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (if (= bt BalanceO)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (new_Rebalance Incr (new_Node k kc (new_Balance BalanceL) tl_prime tr))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (new_Rebalance Stay (new_Node k kc (new_Balance BalanceO) tl_prime tr))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun insert-with-node-gt (k kc bl bt tl iw)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      rt (get_Rebalance_rt iw)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      tr_prime (get_Rebalance_tree iw)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if (= rt Stay)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (new_Rebalance Stay (new_Node k kc bl tl tr_prime))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (if (= bt BalanceR)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (rotl k kc tl tr_prime)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (if (= bt BalanceO)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (new_Rebalance Incr (new_Node k kc (new_Balance BalanceR) tl tr_prime))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (new_Rebalance Stay (new_Node k kc (new_Balance BalanceO) tl tr_prime))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun insert-with-node (cmp f v vc node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      tl (get_Node_left node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      tr (get_Node_right node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      k (get_Node_key node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      kc (get_Node_value node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      bl (get_Node_balance node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      bt (get_Balance_bt bl)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      compare_result (a cmp (list v k))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if (= LT compare_result)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (insert-with-node-lt k kc bl bt tr (insert-with cmp f v vc tl))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (if (= EQ compare_result)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (new_Rebalance Stay (new_Node v (a f (list vc kc)) bl tl tr))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (insert-with-node-gt k kc bl bt tl (insert-with cmp f v vc tr))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun insert-with (cmp f v vc tree)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if tree</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (insert-with-node cmp f v vc tree)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (insert-with-leaf v vc)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun key-less (A B) (if (&gt; A B) GT (if (&gt; B A) LT EQ)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun replace-value (A B) B)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (get_Rebalance_tree (insert-with key-less replace-value k v tree))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="complete-example-hash-array-mapped-trie-hamt">Complete Example: Hash Array Mapped Trie (HAMT)<a href="#complete-example-hash-array-mapped-trie-hamt" class="hash-link" aria-label="Direct link to Complete Example: Hash Array Mapped Trie (HAMT)" title="Direct link to Complete Example: Hash Array Mapped Trie (HAMT)">​</a></h2>
<div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar" style="color:#383a42;background-color:#fafafa;font-weight:bold"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">;; HAMT ported from https://github.com/tomjkidd/simple-hamt/blob/master/src/simple_hamt/impl/core.clj</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (h idx . rest)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (include *standard-cl-23*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant number-of-segments 4)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant number-of-children 4)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defconstant bits-per-segment 2)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun hash* (key)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (r (divmod key (lsh 1 (+ number-of-children number-of-segments))))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline new_HAMT (type bitmap hash-table) (list type bitmap hash-table))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_HAMT_type ((@ h (type bitmap hash-table))) type)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_HAMT_bitmap ((@ h (type bitmap hash-table))) bitmap)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_HAMT_hash-table ((@ h (type bitmap hash-table))) hash-table)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  </span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline new_HNode (type key value) (list type key value))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_HNode_type ((@ n (type key value))) type)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_HNode_key ((@ n (type key value))) key)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_HNode_value ((@ n (type key value))) value)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline htype (obj) (f obj))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline empty-hash-map* () (new_HAMT &quot;root&quot; 0x00 ()))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get-hash-segment (hash-value segment)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (let ((mask 3)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (shifted (lsh hash-value (* segment -2))))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (logand mask shifted)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun list-nth (lst n)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if n</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (list-nth (r lst) (- n 1))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (f lst)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun list-replace-nth (lst idx new-item)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if idx</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c (f lst) (list-replace-nth (r lst) (- idx 1) new-item))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c new-item (r lst))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun range (n e)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if (&gt; e n)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c (- (- e n) 1) (range (+ 1 n) e))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun map (fun l)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if l</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c (a fun (list (f l))) (map fun (r l)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun reduce (fun acc lst)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if lst</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (reduce fun (a fun (list acc (f lst))) (r lst))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        acc</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun drop (idx lst)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if idx</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c (f lst) (drop (- idx 1) (r lst)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (r lst)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun segment-seq (hash-value)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (map</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (lambda ((&amp; hash-value) v) (get-hash-segment hash-value v))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (range 0 number-of-segments)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline in-bitmap? (bitmap position)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (logand bitmap (lsh 1 position))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun get-hash-table-index (bitmap position)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (reduce</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (lambda ((&amp; bitmap) acc cur)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">       (if (logand bitmap (lsh 1 cur))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">           (+ 1 acc)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">           acc</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">           )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">       )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     0</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (range 0 position)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun update-bitmap (bitmap child-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (logior bitmap (lsh 1 child-index))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun update-hash-table (hash-table bitmap child-index k v)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     in-bitmap-seq</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (map</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (lambda ((&amp; hash-table bitmap child-index k v) idx)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (let</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            ((node</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              (if (= idx child-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                  (new_HNode &quot;node&quot; k v)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                  (if (in-bitmap? bitmap idx)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      (let ((htidx (get-hash-table-index bitmap idx)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        (list-nth hash-table htidx)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                  )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               ))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (list idx node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (range 0 number-of-children)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (reduce</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (lambda (acc (index node))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (if node</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (c node acc)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            acc</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      in-bitmap-seq</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun get* (hm hash-val seg-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     bitmap (get_HAMT_bitmap hm)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     hash-table (get_HAMT_hash-table hm)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     index (get-hash-segment hash-val seg-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     empty? (not (in-bitmap? bitmap index))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (if empty?</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          hash-table-index (get-hash-table-index bitmap index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          node (list-nth hash-table hash-table-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          type (htype node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          key (get_HNode_key node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          value (get_HNode_value node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (if (= type &quot;node&quot;)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              (if (= key hash-val)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                  value</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                  ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                  )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              (get* node hash-val (+ 1 seg-index))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline new_SubhashBuilder (colliding-segs finished subhash-node) (list colliding-segs finished subhash-node))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_SubhashBuilder_colliding-segs ((@ n (colliding-segs finished subhash-node))) colliding-segs)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_SubhashBuilder_finished ((@ n (colliding-segs finished subhash-node))) finished)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun-inline get_SubhashBuilder_subhash-node ((@ n (colliding-segs finished subhash-node))) subhash-node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun insert (hm child-index k v)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     bitmap (get_HAMT_bitmap hm)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     hash-table (get_HAMT_hash-table hm)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     new-bitmap (update-bitmap bitmap child-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     new-hash-table (update-hash-table hash-table bitmap child-index k v)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (new_HAMT (get_HAMT_type hm) new-bitmap new-hash-table)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun recur-subhash-node (acc rem sh)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if (not (f rem))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        sh</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (recur-subhash-node</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         acc</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         (r rem)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         (new_HAMT</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          &quot;subh&quot;</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (update-bitmap 0 (f rem))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (list sh)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun enumerate-inner (n lst)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if lst</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c (c n (f lst)) (enumerate-inner (+ n 1) (r lst)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun enumerate (lst) (enumerate-inner 0 lst))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun has-nonempty-sublist (items)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if items</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (l (f items))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun slices (items)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (if (has-nonempty-sublist items)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (c (map (lambda (L) (f L)) items) (slices (map (lambda (L) (r L)) items)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun build-subhash (old-node new-node seg-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     old-segs (drop seg-index (segment-seq (hash* (get_HNode_key old-node))))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     new-segs (drop seg-index (segment-seq (hash* (get_HNode_key new-node))))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     segs (enumerate (slices (list old-segs new-segs)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     sh (reduce</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         (lambda ((&amp; old-node new-node) acc (i o n))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">           (let ((finished (get_SubhashBuilder_finished acc))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                 (new-shb (get_SubhashBuilder_colliding-segs acc)))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">             (if finished</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                 acc</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                 (if (= o n)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                     (new_SubhashBuilder</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      (c o new-shb)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      ()</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      (get_SubhashBuilder_subhash-node acc)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                     (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      subhash (new_HAMT &quot;subh&quot; 0x00 ())</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      old-hnode (get_HNode_value old-node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      subhash-with-old</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      (insert subhash o (get_HNode_key old-node) old-hnode)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      new-hnode (get_HNode_value new-node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      subhash-with-old-and-new</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      (insert subhash-with-old n (get_HNode_key new-node) new-hnode)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      new-subhash-node</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      (recur-subhash-node</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                       acc</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                       new-shb</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                       subhash-with-old-and-new</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                       )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      (new_SubhashBuilder</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                       new-shb</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                       1</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                       new-subhash-node</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                       )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                     )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">                 )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">             )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">           )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         (new_SubhashBuilder () () ())</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         segs</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (get_SubhashBuilder_subhash-node sh)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun assoc-collision (hm k v hash-val seg-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     bitmap (get_HAMT_bitmap hm)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     hash-table (get_HAMT_hash-table hm)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     child-index (get-hash-segment hash-val seg-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     hash-table-index (get-hash-table-index bitmap child-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     collision-node (list-nth hash-table hash-table-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     type (get_HNode_type collision-node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     key (get_HNode_key collision-node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     value (get_HNode_value collision-node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     hm-type (get_HAMT_type hm)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     hm-bitmap (get_HAMT_bitmap hm)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     old-node collision-node</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (if (= type &quot;node&quot;)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          hm-table (get_HAMT_hash-table hm)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (if (= k key)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               new-node (new_HNode type key v)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               new-hash-table (list-replace-nth hash-table hash-table-index new-node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               (new_HAMT hm-type hm-bitmap new-hash-table)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               new-node (new_HNode type k v)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               new-subhash-node (build-subhash old-node new-node (+ 1 seg-index))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               new-hash-table (list-replace-nth hash-table hash-table-index new-subhash-node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               (new_HAMT hm-type hm-bitmap new-hash-table)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">               )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">              )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          new-subhash-node (assoc* collision-node k v hash-val (+ 1 seg-index))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          new-hash-table (list-replace-nth hash-table hash-table-index new-subhash-node)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (new_HAMT hm-type hm-bitmap new-hash-table)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun assoc* (hm k v hash-val seg-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assign</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     bitmap (get_HAMT_bitmap hm)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     hash-table (get_HAMT_hash-table hm)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     child-index (get-hash-segment hash-val seg-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     collision-detected? (in-bitmap? bitmap child-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     (if (not collision-detected?)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         (insert hm child-index k v)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         (assoc-collision hm k v hash-val seg-index)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">         )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">     )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  ;; External interface</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun empty-hash-map () empty-hash-map*)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun get (hm k)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (get* hm (hash* k) 0)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (defun assoc (hm k v)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (assoc* hm k v (hash* k) 0)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  (if (not h)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (new_HAMT () () ())</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      (if rest</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (assoc h idx (f rest))</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          (get h idx)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">  )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Chia-Network/chialisp-web/blob/main/docs/modern-chialisp.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/syntax/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Syntax</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/operators/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Operators</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#description-of-the-new-language" class="table-of-contents__link toc-highlight">Description of the new language</a><ul><li><a href="#an-example-of-modern-chialisp-exercising-many-of-the-new-features" class="table-of-contents__link toc-highlight">An example of modern chialisp exercising many of the new features:</a></li></ul></li><li><a href="#complete-list-of-new-features" class="table-of-contents__link toc-highlight">Complete list of new features</a><ul><li><a href="#defconst-constants" class="table-of-contents__link toc-highlight">defconst constants</a></li><li><a href="#let-let-and-assign-forms" class="table-of-contents__link toc-highlight"><code>let</code>, <code>let*</code> and <code>assign</code> forms</a></li><li><a href="#at-capture" class="table-of-contents__link toc-highlight">at capture</a></li><li><a href="#function-closures" class="table-of-contents__link toc-highlight">Function closures</a></li><li><a href="#lambda-forms" class="table-of-contents__link toc-highlight">lambda forms</a></li><li><a href="#embed-and-compile-include-forms" class="table-of-contents__link toc-highlight">embed and compile include forms</a></li><li><a href="#trace-output-via-cldb" class="table-of-contents__link toc-highlight">trace output via cldb</a></li><li><a href="#defmac-and-full-preprocessing" class="table-of-contents__link toc-highlight">defmac and full preprocessing</a></li></ul></li><li><a href="#complete-example-abc-problem" class="table-of-contents__link toc-highlight">Complete example: ABC problem</a></li><li><a href="#complete-example-babbage-problem" class="table-of-contents__link toc-highlight">Complete example: Babbage problem</a></li><li><a href="#complete-example-avl-tree" class="table-of-contents__link toc-highlight">Complete Example: AVL Tree</a></li><li><a href="#complete-example-hash-array-mapped-trie-hamt" class="table-of-contents__link toc-highlight">Complete Example: Hash Array Mapped Trie (HAMT)</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/operators/">Operators</a></li><li class="footer__item"><a class="footer__link-item" href="/clvm/">CLVM</a></li><li class="footer__item"><a href="https://docs.chia.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chia Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/chia" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/chia_project" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.chia.net/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/Chia-Network/clvm" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_BH7S" href="/"><img src="/img/full_logo_white.svg" alt="Chialisp full logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/full_logo_white.svg" alt="Chialisp full logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">© 2024 Chia Network Inc., Licensed under the <a href="https://github.com/Chia-Network/chialisp-web/blob/main/LICENSE" target="_blank">Apache License, Version 2.0</a> | <a href="https://www.chia.net/terms">Terms</a></div></div></div></footer></div>
</body>
</html>