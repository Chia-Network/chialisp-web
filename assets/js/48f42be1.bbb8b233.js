"use strict";(self.webpackChunkchialisp_web=self.webpackChunkchialisp_web||[]).push([[517],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return d}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),f=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=f(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),h=f(a),d=r,m=h["".concat(s,".").concat(d)]||h[d]||p[d]||l;return a?n.createElement(m,i(i({ref:t},c),{},{components:a})):n.createElement(m,i({ref:t},c))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=h;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var f=2;f<l;f++)i[f]=a[f];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},3558:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return f},toc:function(){return c},default:function(){return h}});var n=a(7462),r=a(3366),l=(a(7294),a(3905)),i=["components"],o={id:"offers",title:"Offers"},s="Chia Offers",f={unversionedId:"puzzles/offers",id:"puzzles/offers",isDocsHomePage:!1,title:"Offers",description:"Contents:",source:"@site/docs/puzzles/offers.md",sourceDirName:"puzzles",slug:"/puzzles/offers",permalink:"/docs/puzzles/offers",editUrl:"https://github.com/Chia-Network/chialisp-web/edit/main/docs/puzzles/offers.md",version:"current",frontMatter:{id:"offers",title:"Offers"},sidebar:"someSidebar",previous:{title:"Chia Asset Tokens (CATs)",permalink:"/docs/puzzles/cats"},next:{title:"Why Chia is Great",permalink:"/docs/tutorials/why_chia_is_great"}},c=[{value:"Introduction",id:"introduction",children:[{value:"Hypothetical example",id:"hypothetical-example",children:[]}]},{value:"Advantages",id:"advantages",children:[]},{value:"Technical details",id:"technical-details",children:[{value:"Offer States",id:"offer-states",children:[]},{value:"Creating an offer file",id:"creating-an-offer-file",children:[]},{value:"settlement_payments.clvm",id:"settlement_paymentsclvm",children:[]},{value:"Accepting an offer",id:"accepting-an-offer",children:[]}]},{value:"Market makers",id:"market-makers",children:[{value:"Offer aggregation",id:"offer-aggregation",children:[]},{value:"Oracles and arbitrage",id:"oracles-and-arbitrage",children:[]}]},{value:"Offer file quirks",id:"offer-file-quirks",children:[{value:"On-chain vs off-chain",id:"on-chain-vs-off-chain",children:[]},{value:"Cancellation",id:"cancellation",children:[]},{value:"Coin set (UTXO)",id:"coin-set-utxo",children:[]}]},{value:"CLI Usage",id:"cli-usage",children:[{value:"Commands",id:"commands",children:[]},{value:"Reference",id:"reference",children:[]},{value:"<code>make_offer</code>",id:"make_offer",children:[]},{value:"<strong><code>take_offer</code></strong>",id:"take_offer",children:[]},{value:"<strong><code>cancel_offer</code></strong>",id:"cancel_offer",children:[]},{value:"<strong><code>get_offers</code></strong>",id:"get_offers",children:[]},{value:"CLI examples",id:"cli-examples",children:[]}]},{value:"RPCs",id:"rpcs",children:[{value:"create_offer_for_ids",id:"create_offer_for_ids",children:[]},{value:"get_offer_summary",id:"get_offer_summary",children:[]},{value:"check_offer_validity",id:"check_offer_validity",children:[]},{value:"take_offer",id:"take_offer-1",children:[]},{value:"get_offer",id:"get_offer",children:[]},{value:"get_all_offers",id:"get_all_offers",children:[]},{value:"cancel_offer",id:"cancel_offer-1",children:[]}]},{value:"Glossary of terms",id:"glossary-of-terms",children:[]}],p={toc:c};function h(e){var t=e.components,a=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"chia-offers"},"Chia Offers"),(0,l.kt)("p",null,"Contents:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#introduction"},"Introduction")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#advantages"},"Advantages")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#technical-details"},"Technical details")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#market-makers"},"Market makers")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#offer-file-quirks"},"Offer file quirks")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#cli-usage"},"CLI Usage")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#rpcs"},"RPCs")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#glossary-of-terms"},"Glossary of terms"))),(0,l.kt)("h2",{id:"introduction"},"Introduction"),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"Offers")," enable peer-to-peer asset exchange in Chia's ecosystem. In other words, you can swap tokens that run on Chia's blockchain without needing to go through an exchange. Only two parties are required -- the ",(0,l.kt)("em",{parentName:"p"},"Maker"),", who creates the offer, and the ",(0,l.kt)("em",{parentName:"p"},"Taker"),", who accepts it."),(0,l.kt)("p",null,"The Maker and Taker don't need to trust each other. Any attempts to modify the offer will invalidate it."),(0,l.kt)("h3",{id:"hypothetical-example"},"Hypothetical example"),(0,l.kt)("p",null,'A clique of classical jazz enthusiasts creates a new token in Chia\'s ecosystem called "CAT King Cole" (CKC). Alice has 1 XCH in her wallet, and she wants to join the CKC club. The current exchange rate is 251 CKC per XCH.'),(0,l.kt)("figure",null,(0,l.kt)("img",{src:"/img/offers_img/offers/1_alice_1_xch.png",alt:"Alice wallet before offer"}),(0,l.kt)("figcaption",null,(0,l.kt)("em",null,"Alice's wallet before creating the offer."))),(0,l.kt)("p",null,"Alice likes those numbers, so she uses her Chia wallet to generate an ",(0,l.kt)("em",{parentName:"p"},"offer file")," with the following conditions, to be enacted upon the offer's acceptance:"),(0,l.kt)("figure",null,(0,l.kt)("img",{src:"/img/offers_img/offers/2_offer_1_xch_251_ckc.png",alt:"offer details"}),(0,l.kt)("figcaption",null,(0,l.kt)("em",null,"Alice's offer: 1 XCH for 251 CKC."))),(0,l.kt)("p",null,"So far, this is not a valid transaction. She hasn't actually spent her XCH, and she can't create CKC out of thin air -- this isn't a jazz improv show. She needs someone to take the other side of this offer."),(0,l.kt)("p",null,"Alice scours the internet and finds a message board where fans of CKC like to share their latest riffs. She posts her offer file and waits, not knowing who will agree to face the music. However, she ",(0,l.kt)("em",{parentName:"p"},"does")," know that potential Takers cannot modify the offer -- they must take it or leave it. Additionally, acceptance of the offer is on a first come, first served basis. They better act quickly!"),(0,l.kt)("p",null,"The offer is not left dangling for long. After just a few seconds, Bob (who's more of a Cat Stevens fan) opens the offer file in his Chia wallet, which asks if he would like to exchange 251 CKC for 1 XCH. Bob accepts the offer, and his wallet automatically creates the other half of the transactions that Alice had started."),(0,l.kt)("figure",null,(0,l.kt)("img",{src:"/img/offers_img/offers/3_bob_view_xch_ckc_offer.png",alt:"offer Bob view"}),(0,l.kt)("figcaption",null,(0,l.kt)("em",null,"Bob's view of the offer."))),(0,l.kt)("p",null,"Alice posted her offer on a message board, ",(0,l.kt)("em",{parentName:"p"},"not")," on a decentralized exchange. She could've posted the offer on Reddit, Twitter, Facebook, or anywhere else online."),(0,l.kt)("p",null,"Alice didn't trust Bob, and Bob didn't trust Alice. They never had to meet or interact in any way. If either of them had attempted to change the conditions of the offer, it automatically would've been rendered invalid. And as soon as Bob accepted the offer, the transactions became valid and were automatically processed, no middlemen required."),(0,l.kt)("p",null,"That's music to Alice and Bob's ears."),(0,l.kt)("figure",null,(0,l.kt)("img",{src:"/img/offers_img/offers/4_alice_251_ckc.png",alt:"Alice post offer wallet"}),(0,l.kt)("figcaption",null,(0,l.kt)("em",null,"Alice's wallet after the offer has been accepted."))),(0,l.kt)("figure",null,(0,l.kt)("img",{src:"/img/offers_img/offers/5_bob_1_xch.png",alt:"Bob post offer wallet"}),(0,l.kt)("figcaption",null,(0,l.kt)("em",null,"Bob's wallet after the offer has been accepted."))),(0,l.kt)("p",null,"The rest of this document will go into the details of offers -- why they're valuable, how the offer files are created, design decisions, and some of the exciting possibilities that lie ahead."),(0,l.kt)("p",null,"If you want to start using offers right away, you can check out our tutorials:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/docs/tutorials/offers_gui_tutorial",title:"Offers GUI tutorial"},"GUI tutorial")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/docs/tutorials/offers_cli_tutorial",title:"Offers CLI tutorial"},"CLI tutorial"))),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"advantages"},"Advantages"),(0,l.kt)("p",null,"Offers have many properties that we think will make them a valuable tool for Chia's community:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Secure"),": When using Chia offers, Makers and Takers retain control of their private keys, as well as their assets. By contrast, centralized exchanges require users to transfer their funds to an account that the exchange controls. If the exchange is hacked or simply goes out of business, users can lose their funds. With Chia offers, self-custody of keys and funds is assured."),(0,l.kt)("blockquote",{parentName:"li"},(0,l.kt)("p",{parentName:"blockquote"},'Offer files do not contain private keys or any way to deduce them. If an offer file falls into a "hacker\'s" hands, they only have two options: ignore the offer or accept it.'))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Immutable"),": Once an offer file is created, any alterations to the file will invalidate it. The offer file only has three possible outcomes:"),(0,l.kt)("ol",{parentName:"li"},(0,l.kt)("li",{parentName:"ol"},"A Taker accepts the offer as-is. All transactions contained within it are automatically processed. (There also could be multiple Takers, ",(0,l.kt)("a",{parentName:"li",href:"#market-makers",title:"Market makers and multiple Takers"},"explained below"),".)"),(0,l.kt)("li",{parentName:"ol"},"The Maker ",(0,l.kt)("a",{parentName:"li",href:"#cancellation",title:"Offer cancellation"},"cancels the offer"),"."),(0,l.kt)("li",{parentName:"ol"},"The offer will be in a pending state until either 1. or 2. are fulfilled. It is possible that the offer never is completed or canceled.")),(0,l.kt)("blockquote",{parentName:"li"},(0,l.kt)("p",{parentName:"blockquote"},"Takers are free to propose a counter offer by creating their own offer file. In this case, the original Maker could cancel the original offer, and both parties' roles would be reversed."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Compliant"),": As offers are inherently peer-to-peer, they don't constitute an \u201cexchange\u201d or other regulated market activity.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Trustless"),": Offers are ",(0,l.kt)("em",{parentName:"p"},"not")," analogous to a handshake or a promise, where one party could renege on the trade. By using Chia offers, the Maker and Taker don't need to trust each other. They don't even need to ",(0,l.kt)("em",{parentName:"p"},"know")," each other. As long as a Taker matches the offer identically, the offer will be valid.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Simultaneous"),": The Maker's and Taker's transactions must happen in the same block. In Chia, all transactions conducted within a single block happen simultaneously. This eliminates one type of Maximum Extractable Value (MEV), where validators can increase their fees by re-ordering transactions.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Non-custodial"),": Neither Maker nor Taker are required to send their funds to a trusted intermediary, such as an escrow service or an exchange. This removes the need for Over The Counter (OTC) desks and other middlemen, who require their customers to submit funds before they allow transactions to complete.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Commission-free"),": Because offers don't use escrow services or other middlemen, there are also none of the typical fees associated with those intermediaries. (Offers ",(0,l.kt)("em",{parentName:"p"},"are")," subject to transaction fees, just like all transactions on Chia's network.)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Multi-asset"),": A Maker can create an offer for multiple assets on both ends of the offer. For example, they could offer 1 XCH and 1.75 CKC for 100,000 SBX and 3 MRMT."))),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"technical-details"},"Technical details"),(0,l.kt)("p",null,"In this section, we'll discuss the technical details of offers, including how they're created, accepted, canceled, etc."),(0,l.kt)("h3",{id:"offer-states"},"Offer States"),(0,l.kt)("p",null,"An offer has six potential states, as defined in ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Chia-Network/chia-blockchain/blob/main/chia/wallet/trading/trade_status.py",title:"trade_status.py"},"trade_status.py"),":"),(0,l.kt)("ol",{start:0},(0,l.kt)("li",{parentName:"ol"},"PENDING_ACCEPT -- The Maker has created the offer, but a Taker has not yet accepted it. The Maker's wallet has reserved the coin(s) to be spent. The spendbundle for the offer has not been sent to the mempool."),(0,l.kt)("li",{parentName:"ol"},"PENDING_CONFIRM -- The Taker has accepted the offer. The Taker's wallet has reserved the coin(s) to be spent. The completed spendbundle has been sent to the mempool."),(0,l.kt)("li",{parentName:"ol"},"PENDING_CANCEL -- The Maker has attempted to cancel the offer by spending the coins being offered. The completed spendbundle has been sent to the mempool."),(0,l.kt)("li",{parentName:"ol"},"CANCELLED -- Depending on which ",(0,l.kt)("a",{parentName:"li",href:"#cancellation",title:"Offer cancellation"},"type of cancellation")," has been used, either:",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"The Maker's wallet has released the coins it had been reserving for this offer, or"),(0,l.kt)("li",{parentName:"ul"},"The Maker's coins have been spent and new ones have been created in the Maker's wallet."))),(0,l.kt)("li",{parentName:"ol"},"CONFIRMED -- The Maker's and Taker's reserved coins have been spent in the same spendbundle. The offer has been completed successfully."),(0,l.kt)("li",{parentName:"ol"},"FAILED -- The Taker attempted, and failed to accept the offer. This could have happened either because the Maker canceled the offer, or because another Taker took the offer first.")),(0,l.kt)("h3",{id:"creating-an-offer-file"},"Creating an offer file"),(0,l.kt)("p",null,"Here's the basic workflow to create an offer file:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"The Maker uses either the wallet GUI or ",(0,l.kt)("a",{parentName:"p",href:"#cli-usage",title:"CLI usage for offers"},"CLI")," to create the terms for an offer. For example, the Maker might offer 1 XCH for 251 CKC. If the Maker doesn't have sufficient funds, an error is thrown.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"The Maker's wallet ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Chia-Network/chia-blockchain/blob/main/chia/wallet/wallet.py#L232",title:"Wallet code's select_coins method"},"selects the appropriate coin(s)")," to spend, starting with the largest coin available.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"For each coin the Maker wants to receive from the offer, the Maker's wallet ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Chia-Network/chia-blockchain/blob/b76b75f3175fc5b8fc904a4b07a7543fdde7dbf1/chia/wallet/trade_manager.py#L241",title:"trade_manager.py, _create_offer_for_ids method"},"creates a notarized coin payment"),". This is a list in the form of ",(0,l.kt)("inlineCode",{parentName:"p"},"(PH1 AMT1 ...)"),", where:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"PH1")," is the puzzle hash of the coin the Maker wants to acquire."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"AMT1")," is the value of the coin the Maker wants to acquire."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"...")," is an optional memo of arbitrary length. The trade manager adds a hint to itself in this memo."))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"The Maker's wallet creates a nonce ",(0,l.kt)("inlineCode",{parentName:"p"},"N"),", using the treehash of a sorted list of the coinIDs of each coin being offered."),(0,l.kt)("p",{parentName:"li"},"Every coinID needs to be included in the nonce to prevent the Maker from creating two offers that can both be completed with just one payment. (Note that even if two conflicting offers were created, the blockchain would correctly reject one of them as a double-spend.) Because each coinID must be unique, any attempts to change any of the coins being offered will cause the offer to become invalid."),(0,l.kt)("blockquote",{parentName:"li"},(0,l.kt)("p",{parentName:"blockquote"},"If you're unfamiliar with nonces, ",(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Cryptographic_nonce",title:"Cryptographic Nonce on Wikipedia"},"Wikipedia")," has a good explanation."))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"The Maker's wallet combines the nonce (Step 4) with the notarized coin payment(s) (Step 3) to ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Chia-Network/chia-blockchain/blob/4873ea53be168276a56a5a1797075bdd63c46ad9/chia/wallet/trading/offer.py#L49",title:"offer.py, notarize_payments method"},"create a list")," called ",(0,l.kt)("inlineCode",{parentName:"p"},"notarized_payments"),". For example, if three coins are included in the Maker's offer, ",(0,l.kt)("inlineCode",{parentName:"p"},"notarized_payments")," will be structured like this: ",(0,l.kt)("inlineCode",{parentName:"p"},"((N . ((PH1 AMT1 ...) (PH2 AMT2 ...) (PH3 AMT3 ...))) ...)"),".")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"The Offer driver ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Chia-Network/chia-blockchain/blob/127342f2ed516537f7398dd1672c89b2fa3c2b59/chia/wallet/trading/offer.py#L69",title:"Offer.py, calculate_announcements method"},"calculates the announcements")," that need to be asserted in order to get paid.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"The Maker's wallet creates a spendbundle paying the puzzlehash of settlement_payments.clvm (explained in the ",(0,l.kt)("a",{parentName:"p",href:"#settlement_paymentsclvm",title:"Discussion of settlement_payments.clvm"},"next section"),"). Finally, the offer file is created, using ",(0,l.kt)("inlineCode",{parentName:"p"},"notarized_payments")," and the spendbundle."))),(0,l.kt)("p",null,"The offer file is now complete. The Maker can send this file anywhere others might see it, including social media, message boards, or a website dedicated to maintaining a list of current offers."),(0,l.kt)("p",null,"The ",(0,l.kt)("em",{parentName:"p"},"offer"),"'s status is now PENDING_ACCEPT. In order for the offer to be completed, it still requires a ",(0,l.kt)("inlineCode",{parentName:"p"},"CREATE_PUZZLE_ANNOUNCEMENT")," condition for the whole puzzle, and a ",(0,l.kt)("inlineCode",{parentName:"p"},"CREATE_COIN")," condition for each type of asset to be received. The Maker's coin(s) can't be spent until a Taker creates these conditions."),(0,l.kt)("h3",{id:"settlement_paymentsclvm"},"settlement_payments.clvm"),(0,l.kt)("p",null,"Offers use a Chialisp puzzle called ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Chia-Network/chia-blockchain/tree/main/chia/wallet/puzzles/settlement_payments.clvm",title:"settlement_payments.clvm, the puzzle to create offer files."},"settlement_payments.clvm"),". This puzzle's solution is a list of ",(0,l.kt)("inlineCode",{parentName:"p"},"notarized_payments"),", which were calculated in the previous section."),(0,l.kt)("p",null,"Recall that ",(0,l.kt)("inlineCode",{parentName:"p"},"notarized_payments")," is structured like this: ",(0,l.kt)("inlineCode",{parentName:"p"},"((N . ((PH1 AMT1 ...) (PH2 AMT2 ...) (PH3 AMT3 ...))) ...)"),", where:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"N")," is the nonce."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"PH1")," is the puzzle hash of the first coin."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"AMT1")," is the amount (or value) of the coin being offered."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"...")," is an optional memo.")),(0,l.kt)("p",null,"For each set of notarized coin payments, this puzzle creates one ",(0,l.kt)("inlineCode",{parentName:"p"},"CREATE_PUZZLE_ANNOUNCEMENT")," condition. For each coin payment within this set, the puzzle creates one ",(0,l.kt)("inlineCode",{parentName:"p"},"CREATE_COIN")," condition."),(0,l.kt)("p",null,"The reason for creating these conditions is to match the announcements created in the offer file. The settlement_payments puzzle is quite versatile -- it can be used as an inner puzzle inside a CAT or NFT, as a puzzle to spend regular XCH, or in order to spend any other assets in Chia's ecosystem."),(0,l.kt)("h3",{id:"accepting-an-offer"},"Accepting an offer"),(0,l.kt)("p",null,"The offer file can be named anything, and it contains a bech32 address for an incomplete spendbundle. The Taker still must perform several steps before the offer can be confirmed:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"View the offer")," -- The Taker needs to validate the terms of the offer before choosing whether to accept it. This can be done using either Chia's wallet GUI or the CLI. In either case, the Taker can choose whether to load the offer file or paste its contents.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Validate the offer")," -- When the offer is loaded into the Taker's wallet, the wallet ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Chia-Network/chia-blockchain/blob/127342f2ed516537f7398dd1672c89b2fa3c2b59/chia/wallet/trade_manager.py#L334",title:"trade_manager.py, check_offer_validity method"},"verifies that the offer is valid")," by checking that the Maker's coins have not been spent. If any coins have been spent, the wallet will show an error that the offer is no longer valid. If the offer is still valid, the Taker's wallet displays the offer's terms and asks whether the Taker will accept it.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Create a spendbundle")," -- If the Taker accepts, then the Taker's wallet creates a new spendbundle with a combination of both the Maker's and Taker's ends of the offer. The offer's status is now ",(0,l.kt)("inlineCode",{parentName:"p"},"PENDING_CONFIRM"),".")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Create a CAT wallet (optional)")," -- The Taker's wallet creates a ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Chia-Network/chia-blockchain/blob/127342f2ed516537f7398dd1672c89b2fa3c2b59/chia/wallet/trade_manager.py#L322",title:"trade_manager.py maybe_create_wallets_for_offer method"},"new CAT wallet")," if there isn't one already.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"Push the spendbundle")," -- The Taker's wallet ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Chia-Network/chia-blockchain/blob/127342f2ed516537f7398dd1672c89b2fa3c2b59/chia/wallet/trade_manager.py#L344",title:"trade_manager.py respond_to_offer method"},"pushes the spendbundle")," to the blockchain. After the spendbundle succeeds, all of the relevant coins have been spent or created, and all assertions have been completed. At this point, the offer's status is ",(0,l.kt)("inlineCode",{parentName:"p"},"CONFIRMED"),"."))),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"market-makers"},"Market makers"),(0,l.kt)("p",null,"Offers in the ",(0,l.kt)("inlineCode",{parentName:"p"},"PENDING_CONFIRM"),' state have been added to the mempool. Farmers and third-party software can observe the current list of offers, and aggregate overlapping ones. This operation is known as a "market maker."'),(0,l.kt)("p",null,"Automated Market Makers (AMMs) are likely to appear in Chia's ecosystem. AMMs can create a single settlement puzzle for each type of asset (XCH or a specific type of CAT), and aggregate all of the notarized coin payments of that type in the puzzle."),(0,l.kt)("p",null,'A "Taker" is part offer-creator, part market-maker. A Taker finds an offer of interest and constructs the other side of that offer, using both of the ',(0,l.kt)("inlineCode",{parentName:"p"},"settlement_payments")," puzzles to resolve the cross-asset payments."),(0,l.kt)("h3",{id:"offer-aggregation"},"Offer aggregation"),(0,l.kt)("p",null,"A sophisticated AMM might aggregate multiple ",(0,l.kt)("inlineCode",{parentName:"p"},"settlement_payments")," into a single spend, which means it could combine an arbitrary number of offers, paying through one ",(0,l.kt)("inlineCode",{parentName:"p"},"settlement_payments")," ephemeral coin for each asset type."),(0,l.kt)("p",null,"For example, a whale wants to buy 10,000 XCH, and is currently sitting on a large stack of stablecoins. There aren't any individuals willing to sell such a large amount of XCH, but the whale doesn't need to create a bunch of small offers. Instead, they create a single offer: ",(0,l.kt)("em",{parentName:"p"},"X")," stablecoins (at the current market price) for 10,000 XCH. Several small XCH holders can aggregate their holdings to complete the offer."),(0,l.kt)("h3",{id:"oracles-and-arbitrage"},"Oracles and arbitrage"),(0,l.kt)("p",null,"As discussed previously, an offer in the ",(0,l.kt)("inlineCode",{parentName:"p"},"PENDING_ACCEPT")," state cannot be modified. If the price of any asset changes after the offer has been created, AMMs could take advantage of arbitrage by accepting stale offers and creating new ones. However, this also means that farmers could do the same, taking the arbitrage for themselves."),(0,l.kt)("p",null,"For example:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Alice offers 1 XCH for 251 CKC."),(0,l.kt)("li",{parentName:"ol"},"The spot price of XCH doubles to 502 CKC per XCH."),(0,l.kt)("li",{parentName:"ol"},"An AMM notices the price increase and decides to accept the offer. They could then sell the 1 XCH and profit 251 CKC, which would be worth 0.5 XCH."),(0,l.kt)("li",{parentName:"ol"},"However, Farmer Bob notices the AMM's attempt at arbitrage and also accepts the offer, adding his own acceptance (and not the AMM's) to the block. Bob has effectively taken the AMM's intended arbitrage."),(0,l.kt)("li",{parentName:"ol"},"The AMM's only option to taking the offer is to add a fee of at least 0.5 XCH, which would cost them more money than they stood to make in the first place. Bob has secured all of the financial incentive for himself.")),(0,l.kt)("p",null,"Additionally, price oracles could be used to reduce MEV, ensure fairness, and stabilize the offers markets. There are many potential business opportunities in this realm, which would have to be developed external to Chia Network Inc."),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"offer-file-quirks"},"Offer file quirks"),(0,l.kt)("p",null,"A few aspects of offer files might seem counter-intuitive at first."),(0,l.kt)("h3",{id:"on-chain-vs-off-chain"},"On-chain vs off-chain"),(0,l.kt)("p",null,"When a Maker creates an offer, it's moved to the ",(0,l.kt)("inlineCode",{parentName:"p"},"PENDING_ACCEPT"),' state. So far, nothing has been written to the blockchain. In fact, nobody else will even know of the offer\'s existence until the Maker shares the file. If the Maker changes their mind before sending the offer file to anyone else, the Maker can delete the file, and the offer will have been effectively "canceled."'),(0,l.kt)("p",null,"However, the Maker's wallet needs to keep track of any pending offers, in case the Maker decides to initiate any additional transactions before the offer has been accepted."),(0,l.kt)("p",null,"For example, let's say Alice has 1 XCH and wants to buy 251 CKC (thereby spending all of her XCH). When she creates her offer, her wallet will store the details locally in its database. All of her XCH coins (totaling 1 XCH) have been reserved for the offer, so she can't spend them while the offer is still pending."),(0,l.kt)("p",null,"If Alice's 1 XCH is only reserved locally, what's stopping her from using a third-party wallet to spend that money? Nothing! The third-party wallet will ascertain its balance by examining the blockchain, which does not know about the pending offer. Therefore, the third-party wallet hasn't reserved any coins for the offer. Alice absolutely could still send someone else her XCH, but then the offer would no longer be valid."),(0,l.kt)("p",null,"If Alice wants to be sure all of her wallets are in agreement, she must cancel her offer."),(0,l.kt)("h3",{id:"cancellation"},"Cancellation"),(0,l.kt)("p",null,"A Maker has two options to cancel an offer."),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Cancel on the blockchain. This is the default cancellation option. It should be used if the Maker has sent the offer file to anyone else."),(0,l.kt)("p",{parentName:"li"},"Continuing our previous example, if Alice uses this option, then her wallet will spend the coins being offered, and create new coins of the same type and value. Alice doesn't need to know about the underlying coins that have been spent -- she just sees her old balance return to her wallet. The offer is now complete and can't be used again."),(0,l.kt)("p",{parentName:"li"},"This option does come with two small downsides."),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Alice must wait for the blockchain to confirm that the cancellation transaction has completed."),(0,l.kt)("li",{parentName:"ul"},"Alice might have to pay a transaction fee.")),(0,l.kt)("p",{parentName:"li"},'These downsides will likely be acceptable in most cases, so "cancel on the blockchain" is the default option.')),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Cancel locally only. This option should only be used if the Maker has not sent the offer file to anyone else."),(0,l.kt)("p",{parentName:"li"},"This option will simply notify Alice's wallet that the transaction has been canceled, so the coins will no longer be reserved. There is no blockchain transaction, so the two disadvantages of \"Cancel on the blockchain\" don't apply here -- the cancellation happens instantly and there is no need for a transaction fee. The downside of this option is that if the offer file ever leaves Alice's computer, a Taker can still take the offer (as long as Alice's coins have not been spent)."),(0,l.kt)("blockquote",{parentName:"li"},(0,l.kt)("p",{parentName:"blockquote"},"NOTE: Double spends on the blockchain aren't possible for either of these options. In the coin set model, coins can only ever be spent once. If someone attempts to take Alice's offer at the same time she spends the coins, only one of those transactions will make it onto the blockchain. ",(0,l.kt)("a",{parentName:"p",href:"https://chialisp.com/docs/coin_lifecycle#the-coin-set-model",title:"Coin set model on chialisp.com"},"Chialisp.com")," has a detailed explanation of the coin set model.")))),(0,l.kt)("h3",{id:"coin-set-utxo"},"Coin set (UTXO)"),(0,l.kt)("p",null,"Chia uses the coin set model to keep track of state. This is similar to the UTXO model in Bitcoin. The coin set model ",(0,l.kt)("a",{parentName:"p",href:"https://docs.chia.net/docs/04coin-set-model/what-is-a-coin",title:"Coin set model"},"has many advantages")," over the account model, but it can create some situations that take time to understand."),(0,l.kt)("p",null,"In the coin set model, everything is a coin. There are no accounts, at least not at the blockchain level. Coins can only ever be spent once, and they can't be divided."),(0,l.kt)("p",null,"This is similar to how cash works. If Alice has a $20 bill and she wants to buy something for $1, she can't just rip out a piece of the bill and hand it to the cashier. She has to pay with the whole bill and wait for her change."),(0,l.kt)("p",null,"Chia works the same way. If someone sends Alice 20 XCH, her wallet is now tracking a single coin worth 20 XCH. If she makes an offer for 1 XCH, her wallet needs to reserve the entire coin for the offer. While the offer is pending, Alice can't spend any of her coin."),(0,l.kt)("p",null,"However, Alice can get around this issue by sending money to herself. Let's say she sends 10 XCH to her own wallet. Her 20-XCH coin has been spent and two new coins have been created, both worth 10 XCH. She can now make an offer for 1 XCH, thus reserving one of her coins, and she can spend the other coin in the usual manner while the offer is pending."),(0,l.kt)("p",null,"The ",(0,l.kt)("a",{parentName:"p",href:"/docs/tutorials/offers_gui_tutorial#whole-coins-must-be-reserved",title:"Offers GUI tutorial"},"GUI tutorial")," goes over an example of this process."),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"cli-usage"},"CLI Usage"),(0,l.kt)("p",null,"Chia's command line interface provides a set of commands to make, take, cancel, and list offers. To use offers on the command line, make sure you are using a virtual environment."),(0,l.kt)("p",null,"The relevant commands can all be found under the ",(0,l.kt)("inlineCode",{parentName:"p"},"chia wallet")," command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"(venv) $ chia wallet -h\n")),(0,l.kt)("h3",{id:"commands"},"Commands"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#make_offer"},(0,l.kt)("inlineCode",{parentName:"a"},"make_offer"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#take_offer"},(0,l.kt)("inlineCode",{parentName:"a"},"take_offer"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#cancel_offer"},(0,l.kt)("inlineCode",{parentName:"a"},"cancel_offer"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#get_offers"},(0,l.kt)("inlineCode",{parentName:"a"},"get_offers")))),(0,l.kt)("h3",{id:"reference"},"Reference"),(0,l.kt)("h3",{id:"make_offer"},(0,l.kt)("inlineCode",{parentName:"h3"},"make_offer")),(0,l.kt)("p",null,"Functionality: Create an offer of XCH/CATs for XCH/CATs."),(0,l.kt)("p",null,"Usage: ",(0,l.kt)("inlineCode",{parentName:"p"},"chia wallet make_offer [OPTIONS]")),(0,l.kt)("p",null,"Options:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"center"},"Short Command"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Long Command"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Type"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Required"),(0,l.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-wp"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--wallet-rpc-port"),(0,l.kt)("td",{parentName:"tr",align:"center"},"INTEGER"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Set the port where the Wallet is hosting the RPC interface. See the rpc_port under wallet in config.yaml")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-f"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--fingerprint"),(0,l.kt)("td",{parentName:"tr",align:"center"},"INTEGER"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Set the fingerprint to specify which wallet to use")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-o"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--offer"),(0,l.kt)("td",{parentName:"tr",align:"center"},"TEXT"),(0,l.kt)("td",{parentName:"tr",align:"center"},"True"),(0,l.kt)("td",{parentName:"tr",align:"left"},"A wallet id to offer and the amount to offer (formatted like wallet_id:amount)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-r"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--request"),(0,l.kt)("td",{parentName:"tr",align:"center"},"TEXT"),(0,l.kt)("td",{parentName:"tr",align:"center"},"True"),(0,l.kt)("td",{parentName:"tr",align:"left"},"A wallet id of an asset to receive and the amount you wish to receive (formatted like wallet_id:amount)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-p"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--filepath"),(0,l.kt)("td",{parentName:"tr",align:"center"},"TEXT"),(0,l.kt)("td",{parentName:"tr",align:"center"},"True"),(0,l.kt)("td",{parentName:"tr",align:"left"},"The path to write the generated offer file to")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-m"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--fee"),(0,l.kt)("td",{parentName:"tr",align:"center"},"TEXT"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"A fee to add to the offer when it gets taken")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-h"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--help"),(0,l.kt)("td",{parentName:"tr",align:"center"},"None"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Show a help message and exit")))),(0,l.kt)("hr",null),(0,l.kt)("h3",{id:"take_offer"},(0,l.kt)("strong",{parentName:"h3"},(0,l.kt)("inlineCode",{parentName:"strong"},"take_offer"))),(0,l.kt)("p",null,"Functionality: Examine or take an offer."),(0,l.kt)("p",null,"Usage: ",(0,l.kt)("inlineCode",{parentName:"p"},"chia wallet take_offer [OPTIONS] PATH_OR_HEX")),(0,l.kt)("p",null,"Options:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"center"},"Short Command"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Long Command"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Type"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Required"),(0,l.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-wp"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--wallet-rpc-port"),(0,l.kt)("td",{parentName:"tr",align:"center"},"INTEGER"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Set the port where the Wallet is hosting the RPC interface. See the rpc_port under wallet in config.yaml")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-f"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--fingerprint"),(0,l.kt)("td",{parentName:"tr",align:"center"},"INTEGER"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Set the fingerprint to specify which wallet to use")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-e"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--examine-only"),(0,l.kt)("td",{parentName:"tr",align:"center"},"None"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Print the summary of the offer file but do not take it")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-m"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--fee"),(0,l.kt)("td",{parentName:"tr",align:"center"},"TEXT"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"The fee to use when pushing the completed offer")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-h"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--help"),(0,l.kt)("td",{parentName:"tr",align:"center"},"None"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Show a help message and exit")))),(0,l.kt)("hr",null),(0,l.kt)("h3",{id:"cancel_offer"},(0,l.kt)("strong",{parentName:"h3"},(0,l.kt)("inlineCode",{parentName:"strong"},"cancel_offer"))),(0,l.kt)("p",null,"Functionality: Cancel an existing offer. Must be the offer's Maker."),(0,l.kt)("p",null,"Usage: ",(0,l.kt)("inlineCode",{parentName:"p"},"chia wallet cancel_offer [OPTIONS]")),(0,l.kt)("p",null,"Options:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"center"},"Short Command"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Long Command"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Type"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Required"),(0,l.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-wp"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--wallet-rpc-port"),(0,l.kt)("td",{parentName:"tr",align:"center"},"INTEGER"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Set the port where the Wallet is hosting the RPC interface. See the rpc_port under wallet in config.yaml")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-f"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--fingerprint"),(0,l.kt)("td",{parentName:"tr",align:"center"},"INTEGER"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Set the fingerprint to specify which wallet to use")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-id"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--id"),(0,l.kt)("td",{parentName:"tr",align:"center"},"TEXT"),(0,l.kt)("td",{parentName:"tr",align:"center"},"True"),(0,l.kt)("td",{parentName:"tr",align:"left"},"The offer ID that you wish to cancel")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"N/A"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--insecure"),(0,l.kt)("td",{parentName:"tr",align:"center"},"None"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Don't make an on-chain transaction, simply mark the offer as canceled")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-m"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--fee"),(0,l.kt)("td",{parentName:"tr",align:"center"},"TEXT"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"The fee to use when canceling the offer securely")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-h"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--help"),(0,l.kt)("td",{parentName:"tr",align:"center"},"None"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Show a help message and exit")))),(0,l.kt)("hr",null),(0,l.kt)("h3",{id:"get_offers"},(0,l.kt)("strong",{parentName:"h3"},(0,l.kt)("inlineCode",{parentName:"strong"},"get_offers"))),(0,l.kt)("p",null,"Functionality: Get the status of existing offers."),(0,l.kt)("p",null,"Usage: ",(0,l.kt)("inlineCode",{parentName:"p"},"chia wallet get_offers [OPTIONS]")),(0,l.kt)("p",null,"Options:"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"center"},"Short Command"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Long Command"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Type"),(0,l.kt)("th",{parentName:"tr",align:"center"},"Required"),(0,l.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-wp"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--wallet-rpc-port"),(0,l.kt)("td",{parentName:"tr",align:"center"},"INTEGER"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Set the port where the Wallet is hosting the RPC interface. See the rpc_port under wallet in config.yaml")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-f"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--fingerprint"),(0,l.kt)("td",{parentName:"tr",align:"center"},"INTEGER"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Set the fingerprint to specify which wallet to use")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-id"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--id"),(0,l.kt)("td",{parentName:"tr",align:"center"},"TEXT"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"The ID of the offer that you wish to examine")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-p"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--filepath"),(0,l.kt)("td",{parentName:"tr",align:"center"},"TEXT"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"The path to rewrite the offer file to (must be used in conjunction with --id)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-em"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--exclude-my-offers"),(0,l.kt)("td",{parentName:"tr",align:"center"},"None"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Exclude your own offers from the output")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-et"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--exclude-taken-offers"),(0,l.kt)("td",{parentName:"tr",align:"center"},"None"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Exclude offers that you've accepted from the output")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-ic"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--include-completed"),(0,l.kt)("td",{parentName:"tr",align:"center"},"None"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Include offers that have already been confirmed/canceled or failed")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-s"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--summaries"),(0,l.kt)("td",{parentName:"tr",align:"center"},"None"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Show the assets being offered and requested for each offer")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-r"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--reverse"),(0,l.kt)("td",{parentName:"tr",align:"center"},"None"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Reverse the order of the output")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"-h"),(0,l.kt)("td",{parentName:"tr",align:"center"},"--help"),(0,l.kt)("td",{parentName:"tr",align:"center"},"None"),(0,l.kt)("td",{parentName:"tr",align:"center"},"False"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Show a help message and exit")))),(0,l.kt)("hr",null),(0,l.kt)("h3",{id:"cli-examples"},"CLI examples"),(0,l.kt)("p",null,"For detailed examples of offers using the command line interface, see our ",(0,l.kt)("a",{parentName:"p",href:"/docs/tutorials/offers_cli_tutorial",title:"Offers CLI tutorial"},"CLI tutorial"),"."),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"rpcs"},"RPCs"),(0,l.kt)("p",null,"From ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/Chia-Network/chia-blockchain/blob/main/chia/rpc/wallet_rpc_client.py"},"wallet_rpc_client.py"),":"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#create_offer_for_ids"},(0,l.kt)("inlineCode",{parentName:"a"},"create_offer_for_ids"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#get_offer_summary"},(0,l.kt)("inlineCode",{parentName:"a"},"get_offer_summary"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#check_offer_validity"},(0,l.kt)("inlineCode",{parentName:"a"},"check_offer_validity"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#take_offer-1"},(0,l.kt)("inlineCode",{parentName:"a"},"take_offer"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#get_offer"},(0,l.kt)("inlineCode",{parentName:"a"},"get_offer"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#get_all_offers"},(0,l.kt)("inlineCode",{parentName:"a"},"get_all_offers"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#cancel_offer-1"},(0,l.kt)("inlineCode",{parentName:"a"},"cancel_offer")))),(0,l.kt)("h3",{id:"create_offer_for_ids"},"create_offer_for_ids"),(0,l.kt)("p",null,"Creates a new offer."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"offer_dict"),": A dictionary of the offer to create."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"fee:")," An optional fee to include with the offer. Defaults to 0."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"validate_only:")," Defaults to False. Set to True to verify the validity of a potential offer, rather than actually creating an offer.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'async def create_offer_for_ids(\n  self, offer_dict: Dict[uint32, int], fee=uint64(0), validate_only: bool = False\n) -> Tuple[Optional[Offer], TradeRecord]:\n  send_dict: Dict[str, int] = {}\n  for key in offer_dict:\n    send_dict[str(key)] = offer_dict[key]\n\n  res = await self.fetch("create_offer_for_ids", {"offer": send_dict, "validate_only": validate_only, "fee": fee})\n  offer: Optional[Offer] = None if validate_only else Offer.from_bytes(hexstr_to_bytes(res["offer"]))\n  return offer, TradeRecord.from_json_dict_convenience(res["trade_record"], res["offer"])\n')),(0,l.kt)("h3",{id:"get_offer_summary"},"get_offer_summary"),(0,l.kt)("p",null,"Returns the summary of a specific offer. Works for offers in any state."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"offer:")," The offer to summarize.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'async def get_offer_summary(self, offer: Offer) -> Dict[str, Dict[str, int]]:\n  res = await self.fetch("get_offer_summary", {"offer": bytes(offer).hex()})\n  return res["summary"]\n')),(0,l.kt)("h3",{id:"check_offer_validity"},"check_offer_validity"),(0,l.kt)("p",null,"Checks whether a specific offer is valid."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"offer:")," The offer to check. The offer is considered valid if it is in any of the following states:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"PENDING_ACCEPT"),(0,l.kt)("li",{parentName:"ul"},"PENDING_CONFIRM"),(0,l.kt)("li",{parentName:"ul"},"PENDING_CANCEL")),(0,l.kt)("p",{parentName:"li"},"The offer is no longer valid if it is in any of the following states:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"CANCELLED"),(0,l.kt)("li",{parentName:"ul"},"CONFIRMED"),(0,l.kt)("li",{parentName:"ul"},"FAILED")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'async def check_offer_validity(self, offer: Offer) -> bool:\n  res = await self.fetch("check_offer_validity", {"offer": bytes(offer).hex()})\n  return res["valid"]\n')),(0,l.kt)("h3",{id:"take_offer-1"},"take_offer"),(0,l.kt)("p",null,"Takes (accepts) a specific offer, with a given fee."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"offer:")," The offer to accept. Must be in the PENDING_ACCEPT state."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"fee:")," An optional fee to include with the offer. Defaults to 0.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'async def take_offer(self, offer: Offer, fee=uint64(0)) -> TradeRecord:\n  res = await self.fetch("take_offer", {"offer": bytes(offer).hex(), "fee": fee})\n  return TradeRecord.from_json_dict_convenience(res["trade_record"])\n')),(0,l.kt)("h3",{id:"get_offer"},"get_offer"),(0,l.kt)("p",null,"Given an offer's unique identifier, return that offer's details."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"trade_id:")," The ID of the offer to examine. Can be retrieved from an offer file by calling ",(0,l.kt)("inlineCode",{parentName:"li"},"cdv inspect spendbundles <offer_file>"),"."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"file_contents:")," Set to True to return a summary for the offer. Defaults to False, which only returns the offer's basic metadata.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'async def get_offer(self, trade_id: bytes32, file_contents: bool = False) -> TradeRecord:\n  res = await self.fetch("get_offer", {"trade_id": trade_id.hex(), "file_contents": file_contents})\n  offer_str = res["offer"] if file_contents else ""\n  return TradeRecord.from_json_dict_convenience(res["trade_record"], offer_str)\n')),(0,l.kt)("h3",{id:"get_all_offers"},"get_all_offers"),(0,l.kt)("p",null,"Gets all offers for the current wallet. Includes offers in every state."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"file_contents")," Set to True to return a summary for the offer. Defaults to False, which only returns the offer's basic metadata.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'async def get_all_offers(self, file_contents: bool = False) -> List[TradeRecord]:\n  res = await self.fetch("get_all_offers", {"file_contents": file_contents})\n\n  records = []\n  optional_offers = res["offers"] if file_contents else ([""] * len(res["trade_records"]))\n  for record, offer in zip(res["trade_records"], optional_offers):\n    records.append(TradeRecord.from_json_dict_convenience(record, offer))\n\n  return records\n')),(0,l.kt)("h3",{id:"cancel_offer-1"},"cancel_offer"),(0,l.kt)("p",null,"Cancel an offer with a specific identifier."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"trade_id:")," The ID of the offer to examine. Can be retrieved from an offer file by calling ",(0,l.kt)("inlineCode",{parentName:"li"},"cdv inspect spendbundles <offer_file>"),"."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"fee:")," An optional fee to include with the cancellation. Defaults to 0."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"secure:")," Defaults to True, which means \"cancel on blockchain,\" ie spend the coins being offered and create new coin's in the Maker's wallet. Set to False to cancel locally. See ",(0,l.kt)("a",{parentName:"li",href:"#cancellation",title:"Offer cancellation"},"cancellation")," for more info.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'async def cancel_offer(self, trade_id: bytes32, fee=uint64(0), secure: bool = True):\n  await self.fetch("cancel_offer", {"trade_id": trade_id.hex(), "secure": secure, "fee": fee})\n')),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"glossary-of-terms"},"Glossary of terms"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"AMM")," -- Automated Market Maker, a software protocol that uses liquidity pools to enable the permissionless trading of digital assets."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Asset")," -- In the context of offers, an ",(0,l.kt)("em",{parentName:"li"},"asset")," may refer to XCH, CATs, or even NFTs that live on Chia's blockchain."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Liquidity Pool")," -- A shared pot of a digital asset's coins or tokens. AMMs use these in lieu of middlemen to connect buyers and sellers."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Maker")," -- The party (human or computer) who creates the offer."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Nonce")," -- A ",(0,l.kt)("strong",{parentName:"li"},"N"),"umber ",(0,l.kt)("strong",{parentName:"li"},"ON"),"ly used on",(0,l.kt)("strong",{parentName:"li"},"CE"),", typically applied to prevent replay attacks. See ",(0,l.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Cryptographic_nonce",title:"Cryptographic Nonce on Wikipedia"},"Wikipedia")," for more info."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Notarized coin")," -- A coin the Maker wishes to receive upon an offer's acceptance."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"notarized_payments")," -- A list of notarized coins."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Offer")," -- A bid to exchange assets on Chia's ecosystem in a peer-to-peer manner."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Offer File")," -- A text file containing the details of an offer, stored in hexadecimal bytecode. Offer files don't contain any private keys, so they may be shared publicly."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Price oracle")," -- An automated software program that provides off-chain data to a blockchain's ecosystem."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Taker")," -- The party (human or computer) who accepts the offer. Multiple Takers can be aggregated to complete an offer."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"settlement_payments")," -- A Chialisp puzzle used in offers. It takes notarized_payments as its solution, and creates a coin and a puzzle announcement for each notarized coin.")))}h.isMDXComponent=!0}}]);