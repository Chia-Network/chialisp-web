"use strict";(self.webpackChunkchialisp_web=self.webpackChunkchialisp_web||[]).push([[325],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=u(n),d=o,c=h["".concat(s,".").concat(d)]||h[d]||m[d]||r;return n?a.createElement(c,i(i({ref:t},p),{},{components:n})):a.createElement(c,i({ref:t},p))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var u=2;u<r;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},9851:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return m}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],l={id:"debugging",title:"Debugging",slug:"/debugging"},s=void 0,u={unversionedId:"debugging",id:"debugging",title:"Debugging",description:"Debugging Chialisp at times can be frustrating. Due to the nature of how it handles data structures, programs will often continue on with incorrect values only to error out at a later spot that gives no clue to the initial breakage. For example, a variable typo will often result in the variable being evaluated as a string, and if that gets hashed into something it's impossible to tell.",source:"@site/docs/debugging.md",sourceDirName:".",slug:"/debugging",permalink:"/debugging",draft:!1,editUrl:"https://github.com/Chia-Network/{{ REPOSITORY_NAME }}/blob/main/docs/debugging.md",tags:[],version:"current",frontMatter:{id:"debugging",title:"Debugging",slug:"/debugging"},sidebar:"someSidebar",previous:{title:"Optimization",permalink:"/optimization"},next:{title:"Standard Transactions",permalink:"/standard-transactions"}},p={},m=[{value:"Raise Operator",id:"raise-operator",level:2},{value:"Verbose Output",id:"verbose-output",level:2},{value:"Symbol Table",id:"symbol-table",level:2},{value:"Common Errors",id:"common-errors",level:2},{value:"Path Into Atom",id:"path-into-atom",level:3},{value:"First or Rest of Non-Cons",id:"non-cons",level:3},{value:"Sha256 on List",id:"sha256tree",level:3},{value:"Deserialization",id:"deserialization",level:2}],h={toc:m};function d(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Debugging Chialisp at times can be frustrating. Due to the nature of how it handles data structures, programs will often continue on with incorrect values only to error out at a later spot that gives no clue to the initial breakage. For example, a variable typo will often result in the variable being evaluated as a string, and if that gets hashed into something it's impossible to tell."),(0,r.kt)("p",null,"However, there are some tricks you can use to more easily catch bugs in your code."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"It is recommended that you have a strong grasp of CLVM since it underlies all of the processes that happen in Chialisp. It will make it easier to build the picture in your head of the evaluations that are happening and why they may be happening unexpectedly."),(0,r.kt)("p",{parentName:"admonition"},"For example, topics as environment trees may not make sense until you read about it on the ",(0,r.kt)("a",{parentName:"p",href:"/clvm"},"CLVM page"),".")),(0,r.kt)("h2",{id:"raise-operator"},"Raise Operator"),(0,r.kt)("p",null,"You can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"x")," operator to debug your programs. This allows you to print the value of an expression at runtime, and terminate the program before it can go further."),(0,r.kt)("p",null,"Here is an example of a program you may want to debug:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-chialisp"},"(mod (something)\n    (defun some (something)\n        (sha256 something)\n    )\n\n    (some something)\n)\n")),(0,r.kt)("p",null,"This would throw an error if you try to use ",(0,r.kt)("inlineCode",{parentName:"p"},"sha256")," on a list (because it's the solution to the program)."),(0,r.kt)("p",null,"Here is how you would debug it by wrapping an expression in the ",(0,r.kt)("inlineCode",{parentName:"p"},"x")," operator:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-chialisp"},"(mod (something)\n    (defun some (something)\n        (sha256 (x something))\n    )\n\n    (some something)\n)\n")),(0,r.kt)("p",null,"As you can see, when it gets to that point, it would raise an error and print the value of ",(0,r.kt)("inlineCode",{parentName:"p"},"something")," rather than continuing and crashing."),(0,r.kt)("p",null,"This is a very powerful tool when debugging programs in Chialisp."),(0,r.kt)("h2",{id:"verbose-output"},"Verbose Output"),(0,r.kt)("p",null,"It may be a lot to digest, but if you execute your programs in verbose mode, it will show you the entire evaluation process from start to finish."),(0,r.kt)("p",null,"You can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"--verbose")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"-v")," flag with ",(0,r.kt)("inlineCode",{parentName:"p"},"brun")," (and ",(0,r.kt)("inlineCode",{parentName:"p"},"run"),", if you want to debug the compiler)."),(0,r.kt)("p",null,"Here is an example:"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Verbose Output"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-chialisp"},"brun '(c (sha256 0xdeadbeef) ())' '()' --verbose\n\nFAIL: path into atom ()\n\n(a 2 3) [((c (sha256 0xdeadbeef) ()))] => (didn't finish)\n\n3 [((c (sha256 0xdeadbeef) ()))] => ()\n\n2 [((c (sha256 0xdeadbeef) ()))] => (c (sha256 0xdeadbeef) ())\n\n(c (sha256 0xdeadbeef) ()) [()] => (didn't finish)\n\n() [()] => ()\n\n(sha256 0xdeadbeef) [()] => (didn't finish)\n\n0xdeadbeef [()] => (didn't finish)\n")),(0,r.kt)("p",null,"In this example, we see that it is trying to run ",(0,r.kt)("inlineCode",{parentName:"p"},"0xdeadbeef")," as a program to access a value in the environment. However, the environment is just ",(0,r.kt)("inlineCode",{parentName:"p"},"()")," which is obviously not deep enough, so it throws an error."),(0,r.kt)("p",null,"We should have quoted the atom before we passed it to ",(0,r.kt)("inlineCode",{parentName:"p"},"sha256"),". In Chialisp, you don't need to quote atoms, but we are executing CLVM.")),(0,r.kt)("p",null,"Every verbose output begins with ",(0,r.kt)("inlineCode",{parentName:"p"},"(a 2 3)")," which represents the whole program being run with its environment."),(0,r.kt)("p",null,"Follow each occurrence of ",(0,r.kt)("inlineCode",{parentName:"p"},"(didn't finish)")," down until you find the deepest failure, then work up from there. Hopefully this will help you figure out what is wrong."),(0,r.kt)("h2",{id:"symbol-table"},"Symbol Table"),(0,r.kt)("p",null,"When you use the ",(0,r.kt)("inlineCode",{parentName:"p"},"run")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"cdv clsp build")," commands, a symbol table file will be created named ",(0,r.kt)("inlineCode",{parentName:"p"},"main.sym"),". You can use this file to aid in debugging. It keeps track of constant and function names, so you can see them in errors or the verbose output at runtime."),(0,r.kt)("p",null,"You can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"--symbol-table")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"-y")," flag with the symbol table file to enable this behavior."),(0,r.kt)("p",null,"Here is an example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"brun compiled.clvm --verbose --symbol-table main.sym\n")),(0,r.kt)("p",null,"Keep in mind that this will not be able to identify inline functions or macros since they get replaced at compile time. However, you can change inline functions to normal functions while debugging so that they are tracked by the symbol table."),(0,r.kt)("h2",{id:"common-errors"},"Common Errors"),(0,r.kt)("h3",{id:"path-into-atom"},"Path Into Atom"),(0,r.kt)("p",null,"This is the most common error when running a program. It means that you are trying to access an environment value that is deeper than the tree."),(0,r.kt)("p",null,"Some common reasons for this are the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Called a function and didn't supply all of the parameters."),(0,r.kt)("li",{parentName:"ul"},"Used a list operator on an atom."),(0,r.kt)("li",{parentName:"ul"},"Used an atom as if it were a program.")),(0,r.kt)("h3",{id:"non-cons"},"First or Rest of Non-Cons"),(0,r.kt)("p",null,"This error means you are trying to use either the ",(0,r.kt)("inlineCode",{parentName:"p"},"f")," operator or ",(0,r.kt)("inlineCode",{parentName:"p"},"r")," operator on an atom rather than a cons pair."),(0,r.kt)("p",null,"Some common reasons for this are the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Parameters are misaligned or missing."),(0,r.kt)("li",{parentName:"ul"},"The type of a parameter is wrong."),(0,r.kt)("li",{parentName:"ul"},"Forgot to check if it's a list with ",(0,r.kt)("inlineCode",{parentName:"li"},"l")," before using list operators."),(0,r.kt)("li",{parentName:"ul"},"An empty list is technically an atom (nil), not a cons pair (use the ",(0,r.kt)("inlineCode",{parentName:"li"},"l")," operator to check)."),(0,r.kt)("li",{parentName:"ul"},"Forgot to quote a program and it evaluated too soon.")),(0,r.kt)("h3",{id:"sha256tree"},"Sha256 on List"),(0,r.kt)("p",null,"You can only use the ",(0,r.kt)("inlineCode",{parentName:"p"},"sha256")," operator on atoms."),(0,r.kt)("p",null,"What you are probably looking for instead is the ",(0,r.kt)("inlineCode",{parentName:"p"},"sha256tree")," function, which you can include inside a module like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-chialisp"},"(include sha256tree.clib)\n")),(0,r.kt)("p",null,"Of course, you will need to ensure it's in the include path first:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cdv clsp retrieve sha256tree\n")),(0,r.kt)("p",null,"Keep in mind that ",(0,r.kt)("inlineCode",{parentName:"p"},"sha256tree")," has a higher cost associated with it and will have a different result (due to prepending a ",(0,r.kt)("inlineCode",{parentName:"p"},"1")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"2")," based on type). If all you are hashing is one atom or multiple atoms of fixed length, you can use the simpler built-in ",(0,r.kt)("inlineCode",{parentName:"p"},"sha256")," operator."),(0,r.kt)("h2",{id:"deserialization"},"Deserialization"),(0,r.kt)("p",null,"If you have CLVM bytecode in hex format and need to be able to read it, you can convert it back into normal CLVM form. Even though it may not be super readable either way, it can help to find patterns and check things such as curried in arguments."),(0,r.kt)("p",null,"Run this command to deserialize CLVM bytecode:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'opd "<CLVM Bytecode>"\n')),(0,r.kt)("p",null,"As well as this, if you want to check the length of the serialized output of your CLVM, you can convert it in the other direction as well."),(0,r.kt)("p",null,"Run this command to serialize CLVM:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'opc "<CLVM>"\n')),(0,r.kt)("p",null,"You can find more commands in the ",(0,r.kt)("a",{parentName:"p",href:"/commands"},"Commands page"),"."))}d.isMDXComponent=!0}}]);