(self.webpackChunkchialisp_web=self.webpackChunkchialisp_web||[]).push([[600],{7053:(e,n,i)=>{"use strict";i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"optimization","title":"Optimization","description":"It is possible to optimize the cost of your programs by making certain changes and keeping things in mind as you write code using the language. Let\'s explore some of these methods now.","source":"@site/docs/optimization.md","sourceDirName":".","slug":"/optimization","permalink":"/optimization","draft":false,"unlisted":false,"editUrl":"https://github.com/Chia-Network/chialisp-web/blob/main/docs/optimization.md","tags":[],"version":"current","frontMatter":{"id":"optimization","title":"Optimization","slug":"/optimization"},"sidebar":"someSidebar","previous":{"title":"Conditions","permalink":"/conditions"},"next":{"title":"Common Issues","permalink":"/common_issues"}}');var o=i(4848),s=i(8453),r=i(3823);const a={id:"optimization",title:"Optimization",slug:"/optimization"},l=void 0,c={},h=[{value:"Conditions",id:"conditions",level:2},{value:"Utilize Operators",id:"utilize-operators",level:2},{value:"Functions",id:"functions",level:2},{value:"Minimize Parameters",id:"minimize-parameters",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"It is possible to optimize the cost of your programs by making certain changes and keeping things in mind as you write code using the language. Let's explore some of these methods now."}),"\n",(0,o.jsx)(n.h2,{id:"conditions",children:"Conditions"}),"\n",(0,o.jsxs)(n.p,{children:["Check out the ",(0,o.jsx)(n.a,{href:"/conditions/#list",children:"full conditions list"})," for detailed information on conditions and their use."]}),"\n",(0,o.jsxs)(n.p,{children:["If you are writing a puzzle for the Chia blockchain, minimize the number of spends and conditions used. Specifically, the ",(0,o.jsx)(n.code,{children:"CREATE_COIN"}),", ",(0,o.jsx)(n.code,{children:"AGG_SIG_ME"}),", and ",(0,o.jsx)(n.code,{children:"AGG_SIG_UNSAFE"})," conditions have a massive cost associated with them. This is because they are an expensive operation to perform on the node."]}),"\n",(0,o.jsx)(n.p,{children:"For example, instead of creating a coin in each spend, you can aggregate them all into a single coin created from one of the spends. The other coins just contribute to the overall value."}),"\n",(0,o.jsx)(n.h2,{id:"utilize-operators",children:"Utilize Operators"}),"\n",(0,o.jsxs)(n.p,{children:["Check out the ",(0,o.jsx)(n.a,{href:"/costs",children:"list of operator costs"})," to understand the implications of each, and how you can use them to more efficiently perform an operation."]}),"\n",(0,o.jsx)(n.p,{children:"For example, this costly method to check if a number is odd:"}),"\n",(0,o.jsx)(r.A,{flavor:"chialisp",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-chialisp",children:"(r (divmod 7 2))\n"})})}),"\n",(0,o.jsx)(n.p,{children:"Can be replaced with this simpler and more efficient method:"}),"\n",(0,o.jsx)(r.A,{flavor:"chialisp",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-chialisp",children:"(logand 7 1)\n"})})}),"\n",(0,o.jsx)(n.p,{children:"Sometimes it may not always be obvious, but optimizing these things can make a difference over time."}),"\n",(0,o.jsx)(n.h2,{id:"functions",children:"Functions"}),"\n",(0,o.jsx)(n.p,{children:"It may be tempting to break up all of your code into functions to make it cleaner and easier to read, but that's not always the best option. Functions are essentially a new program that has to be executed whenever called, which means creating a new environment and passing all of the parameters into it."}),"\n",(0,o.jsx)(n.p,{children:"Sometimes, functions can actually help you save on cost, by reusing the same parameter multiple times. Instead of repeating it, you are simply using the value from the environment."}),"\n",(0,o.jsx)(n.p,{children:"Here is an example of a good use of a function:"}),"\n",(0,o.jsx)(r.A,{flavor:"chialisp",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-chialisp",children:"(mod ()\n    (defun square (number)\n        (* number number) ; The number is reused twice here.\n    )\n    (square 8)\n)\n"})})}),"\n",(0,o.jsx)(n.p,{children:"However, when you only use the values once, you are just wasting cost on the function call. This is where inline functions come in."}),"\n",(0,o.jsx)(n.p,{children:"We can use an inline function to insert code at compile time:"}),"\n",(0,o.jsx)(r.A,{flavor:"chialisp",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-chialisp",children:"(mod ()\n    (defun-inline double (number)\n        (* number 2) ; This function will be replaced with its contents.\n    )\n    (double 8)\n)\n"})})}),"\n",(0,o.jsx)(n.p,{children:"This is a form of macro, and allows you to clean up your code without adding any additional overhead."}),"\n",(0,o.jsx)(n.p,{children:"However, if you used an inline function for the previous example, you can see what happens:"}),"\n",(0,o.jsx)(r.A,{flavor:"chialisp",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-chialisp",children:"(mod ()\n    (defun-inline square (number)\n        (* number number) ; The expression for number is reused twice here.\n    )\n\n    (square (* 2 3)) ; Inlines to (* (* 2 3) (* 2 3))\n)\n"})})}),"\n",(0,o.jsx)(n.p,{children:"The expression passed in as the parameter gets verbatim copied multiple times, which is very inefficient."}),"\n",(0,o.jsx)(n.p,{children:"When writing a function, decide whether it should be inline or not based on whether the parameters are reused or not."}),"\n",(0,o.jsx)(n.h2,{id:"minimize-parameters",children:"Minimize Parameters"}),"\n",(0,o.jsx)(n.p,{children:"Accessing values from the environment has a cost that grows the deeper the values are in the tree. Because of this, the more parameters a function or program has, the more cost will be paid."}),"\n",(0,o.jsx)(n.p,{children:"Try to keep the number of parameters relatively low if possible. This also has the added benefit of making your code more readable."}),"\n",(0,o.jsx)(n.p,{children:"This becomes especially important if you are passing many different values between inner puzzles or functions."})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},3823:(e,n,i)=>{"use strict";i.d(n,{A:()=>x});var t=i(5293),o=i(11),s=i(1765),r=i(6540),a=i(5604),l=i(6069),c=i.n(l),h=i(5871),d=i.n(h),u=i(9031),p=i.n(u);function m(e){return e instanceof Array||(0,r.isValidElement)(e)?r.Children.toArray(e).reduce(((e,n)=>{let i="";return i=(0,r.isValidElement)(n)&&f(n)?m(n.props.children):(0,r.isValidElement)(n)&&!f(n)?"":g(n),e.concat(i)}),""):g(e)}function g(e){return null==e||"boolean"==typeof e||"{}"===JSON.stringify(e)?"":e.toString()}function f(e){return(0,r.isValidElement)(e)&&Boolean(e.props.children)}var y=i(4848);function x(e){let{children:n,flavor:i,input:l,tests:c,reporter:h}=e;const{colorMode:u}=(0,t.G)(),g=(0,r.useMemo)((()=>m(n).trim()),[]),[f,x]=(0,r.useState)(g),[j,v]=(0,r.useState)(l??Object.keys(c??{})[0]?.trim()??""),[w,k]=(0,r.useState)(""),[z,C]=(0,r.useState)(0n),[S,T]=(0,r.useState)(null),F=e=>e.replace("Error: ",""),A=(e,n)=>{try{return e.run(n)}catch(i){return k(`While evaluating: ${F(""+i)}`),null}},N=()=>{const e=(()=>{try{return o.Program.fromSource(f)}catch(e){return k(`While parsing: ${F(""+e)}`),null}})();if(!e)return;const n="clvm"===i||e.isCons&&e.first.equals(o.Program.fromText("mod")),t=(e=>{if(i&&"chialisp"!==i)return e;try{return e.compile().value}catch(n){return k(`While compiling: ${F(""+n)}`),null}})(e);if(!t)return;const s=j?o.Program.fromSource(j):o.Program.nil,r=n?A(t,s):{value:t,cost:0n};r&&(k(r.value.toSource()),C(r.cost));let a=!0;for(const[i,l]of Object.entries(c??{})){const e=o.Program.fromSource(i),s=n?A(t,e)?.value:t;if(!s||s.toSource()!==l){a=!1;break}}h?.(a),T(a)},P=S?a.CMH:a.QCr,[E,I]=r.useState(!1);return(0,r.useEffect)((()=>I(!0)),[]),(0,y.jsx)(s.f4,{Prism:globalThis.Prism,theme:E&&("dark"===u?d():p()),code:f,language:"chialisp",children:e=>{let{className:n,style:t}=e;return(0,y.jsxs)("pre",{className:n,style:{...t,position:"relative"},children:[j?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(b,{code:j,setCode:v,language:"chialisp"}),(0,y.jsx)("hr",{style:{marginTop:"14px",marginBottom:"14px"}})]}):"",(0,y.jsx)(b,{code:f,setCode:x,language:"chialisp"}),(0,y.jsx)("div",{style:{position:"absolute",top:"16px",right:"16px"},children:(0,y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"14px"},children:[(0,y.jsx)("span",{style:{marginRight:"8px"},children:i&&"chialisp"!==i?"CLVM":"Chialisp"}),!j&&(0,y.jsx)(a.TlQ,{size:24,className:"icon-button",cursor:"pointer",onClick:()=>v("()")}),(0,y.jsx)(a.gSK,{size:24,className:"icon-button",cursor:"pointer",onClick:N})]})}),w?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("hr",{style:{marginTop:"14px",marginBottom:"14px"}}),(0,y.jsx)("div",{style:{display:"inline-block"},children:(0,y.jsx)(b,{code:w,language:"chialisp"})}),w&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{style:{display:"inline-block",position:"absolute",right:"60px"},children:(0,y.jsx)(b,{code:`Cost: ${z}`,language:"chialisp"})}),(0,y.jsx)(P,{size:24,color:S?"#77FF77":"#FF7777",style:{position:"absolute",bottom:"16px",right:"16px"}})]})]}):""]})}})}function b(e){let{code:n,setCode:i,language:o}=e;const{colorMode:a}=(0,t.G)(),[l,h]=r.useState(!1);return(0,r.useEffect)((()=>h(!0)),[]),(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(s.f4,{Prism:globalThis.Prism,theme:l&&("dark"===a?d():p()),code:n,language:o,children:e=>{let{tokens:t,getLineProps:o,getTokenProps:s}=e,r=t.map(((e,n)=>(0,y.jsx)("div",{...o({line:e}),children:e.map(((e,n)=>(0,y.jsx)("span",{...s({token:e})},n)))},n)));return i?(0,y.jsx)(c(),{value:n,onValueChange:e=>i(e),highlight:()=>r,padding:0}):r}})})}},5871:e=>{e.exports={plain:{color:"#F8F8F2",backgroundColor:"#282A36",fontWeight:"bold"},styles:[{types:["keyword"],style:{color:"rgb(189, 147, 249)"}},{types:["listop","class-name","quotes"],style:{color:"rgb(80, 250, 123)"}},{types:["builtin"],style:{color:"rgb(5, 227, 223)"}},{types:["number","hexadecimal","string","boolean"],style:{color:"rgb(255, 184, 108)",fontWeight:"normal"}},{types:["punctuation","symbol"],style:{color:"rgb(248, 248, 242)"}},{types:["variable"],style:{fontStyle:"italic"}},{types:["comment"],style:{color:"rgb(98, 114, 164)",fontWeight:"normal"}},{types:["function","car"],style:{color:"rgb(241, 250, 140)"}}]}},9031:e=>{e.exports={plain:{color:"#383a42",backgroundColor:"#fafafa",fontWeight:"bold"},styles:[{types:["keyword"],style:{color:"#990096"}},{types:["listop","class-name","quotes"],style:{color:"#006100"}},{types:["builtin"],style:{color:"#127EAF"}},{types:["number","hexadecimal","string","boolean"],style:{color:"#B35C00",fontWeight:"normal"}},{types:["punctuation","symbol"],style:{color:"#383a42"}},{types:["variable"],style:{fontStyle:"italic"}},{types:["comment"],style:{color:"#73737D",fontWeight:"normal"}},{types:["function","car"],style:{color:"#0045DB"}}]}}}]);